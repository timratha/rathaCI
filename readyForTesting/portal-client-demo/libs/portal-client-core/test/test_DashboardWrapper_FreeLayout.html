<!DOCTYPE html>
<html>
<head lang="en">
    <!--TODO write to a file with all layout ?-->
    <meta charset="UTF-8">
    <title></title>
    <style>
        html,body{
            width:100%;
            height: 100%;
        }
    </style>
    <script src="./dojoConfig.js"></script>
    <script type="text/javascript" src="../libs/dojo/dojo.js"></script>
    <script type="text/javascript">

        require([
            'dojo/on',
            'dojo/dom',
            'dojo/parser',
            'dijit/registry',
            'dojo/json',
            'test/data/dashboards',
            'portal/_base/store/PortalStore',
            'portal/_base/viewWrappers/DashboardWrapper',
            'yeti',
            'dojo/domReady!',
            'dijit/form/Textarea'
        ], function (on, dom, parser, registry, json, dashboards,PortalStore,DashboardWrapper) {
            parser.parse();
            PortalStore.setStore('memory');

            PortalStore.dashboards.installDashboard(dashboards.freeDash1).then(function(dash){
                console.debug('dashboard:',dash);
                var wrapper=new DashboardWrapper({
                    viewId:dash.id
                },'cp1');
                wrapper.startup();

                on(dom.byId('addNew'),'click',function(){
                    var widget = {
                        "key": "newOne",
                        "widgetType": "test/widgets/ContentWidget",
                        "label": "test widget",
                        "iconClass": "fa fa-users",
                        "config":{
                            "content": "added widget"
                        }
                    };
                    PortalStore.dashboards.addWidget2Dashboard(wrapper.model.id,widget)
                });

            });
            PortalStore.dashboards.on('update',function(e){
                registry.byId('json').set('value',json.stringify(e.target,null,'\t'));
            })

        });
    </script>
    <link rel="stylesheet" href="../libs/font-awesome/css/font-awesome.css"/>
</head>
<body  class="yeti"  style="margin: 0px;">
    <div style="display: block">
        <button id="addNew">addNew</button>
    </div>
    <div id="cp1" style="width: 50%;height:100%;display: inline-block;"></div>
    <div id="json" data-dojo-type="dijit/form/Textarea" style="width: 45%;height:100%;max-height:100%;display: inline-block;vertical-align: top;padding: 10px;"></div>
</body>
</html>