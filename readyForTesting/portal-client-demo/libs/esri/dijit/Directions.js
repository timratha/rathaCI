// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d,h,l){g=g(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,b,d,h,c,l,y){this._graphic=
a;this._map=b;this._toolbar=d;this._scale=h;this._rotate=c;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=l;a=d._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=q.hitch(this,this._moveStartHandler);this._firstMoveHandler=q.hitch(this,this._firstMoveHandler);this._moveStopHandler=q.hitch(this,this._moveStopHandler);this._moveHandler=q.hitch(this,this._moveHandler);this._isTextPoint=y;this._init()},
destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){e.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){e.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&e.forEach(this._connects,r.disconnect);var a=this._toolbar._scratchGL;this._anchors&&e.forEach(this._anchors,function(b){a.remove(b.graphic);
(b=b.moveable)&&b.destroy()});this._box&&a.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var a=this._map,d=this._toolbar._scratchGL,h=this._getBoxCoords(),c=new k(a.spatialReference),f=q.clone(e.filter(h,function(a,b){return 8!==b&&0===b%2}));f[0]&&f.push([f[0][0],f[0][1]]);c.addPath(f);this._rotate&&c.addPath([h[1],h[8]]);this._box?this._box.setGeometry(c):(this._box=new l(c,this._lineSymbol),d.add(this._box));this._anchors?e.forEach(this._anchors,
function(d,c){this._scale||(c=8);var l=new b(h[c],a.spatialReference);d.graphic.setGeometry(l);var l=d.moveable,f=d.graphic.getDojoShape();f&&(l?f!==l.shape&&(l.destroy(),d.moveable=this._getMoveable(d.graphic,c)):d.moveable=this._getMoveable(d.graphic,c))},this):(this._anchors=[],this._connects=[],e.forEach(h,function(h,c){if(this._scale||!(8>c)){h=new b(h,a.spatialReference);var f=new l(h,this._markerSymbol);this._isTextPoint&&1===c%2&&f.hide();d.add(f);this._anchors.push({graphic:f,moveable:this._getMoveable(f,
c)})}},this))}else this._cleanUp()},_getBoxCoords:function(a){var b=this._map,d,h=[],c,l,f;if(this._isTextPoint){d=this._graphic.getNode().getBoundingClientRect();var k=b.__container.getBoundingClientRect();d=[{x:d.left-k.left,y:d.top-k.top},{x:d.right-k.left,y:d.top-k.top},{x:d.right-k.left,y:d.bottom-k.top},{x:d.left-k.left,y:d.bottom-k.top}]}else d=this._getTransformedBoundingBox(this._graphic);e.forEach(d,function(d,e,k){c=d;(l=k[e+1])||(l=k[0]);f={x:(c.x+l.x)/2,y:(c.y+l.y)/2};a||(c=b.toMap(c),
f=b.toMap(f));h.push([c.x,c.y]);h.push([f.x,f.y])});this._rotate&&(d=q.clone(h[1]),d=a?{x:d[0],y:d[1]}:b.toScreen({x:d[0],y:d[1],spatialReference:b.spatialReference}),d.y-=this._toolbar._options.rotateHandleOffset,a||(d=b.toMap(d)),h.push([d.x,d.y]));return h},_getTransformedBoundingBox:function(a){var d=this._map,h=a.geometry.getExtent(),c=a.geometry.spatialReference;a=new b(h.xmin,h.ymax,c);h=new b(h.xmax,h.ymin,c);a=d.toScreen(a);h=d.toScreen(h);return[{x:a.x,y:a.y},{x:h.x,y:a.y},{x:h.x,y:h.y},
{x:a.x,y:h.y}]},_getAllGraphics:function(){var a=[this._box];this._anchors&&e.forEach(this._anchors,function(b){a.push(b.graphic)});return a=e.filter(a,n.isDefined)},_getMoveable:function(a,b){var d=a.getDojoShape();if(d){var h=new m(d);h._index=b;this._connects.push(r.connect(h,"onMoveStart",this._moveStartHandler));this._connects.push(r.connect(h,"onFirstMove",this._firstMoveHandler));this._connects.push(r.connect(h,"onMoveStop",this._moveStopHandler));h.onMove=this._moveHandler;(d=d.getEventSource())&&
v.set(d,"cursor",this._toolbar._cursors["box"+b]);return h}},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(a){var b=a.host._index,d=this._wrapOffset=a.host.shape._wrapOffsets[0]||0,h=this._graphic.getLayer()._div.getTransform(),c;a=e.map(this._getBoxCoords(!0),function(a){return{x:a[0]+d,y:a[1]}});c=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:a[1].x,y:a[3].y};this._centerCoord=
f.multiplyPoint(f.invert(h),c);if(8===b)c=f.multiplyPoint(f.invert(h),a[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,c)),this._startLine=[this._centerCoord,c],this._moveLine=q.clone(this._startLine);else if(c=f.multiplyPoint(f.invert(h),a[b]),h=f.multiplyPoint(f.invert(h),a[(b+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,c)),this._firstMoverToAnchor=Math.sqrt((c.x-this._centerCoord.x)*(c.x-this._centerCoord.x)+(c.y-this._centerCoord.y)*
(c.y-this._centerCoord.y)),this._startBox=h,this._startBox.width=a[4].x-a[0].x,this._startBox.height=a[4].y-a[0].y,this._moveBox=q.clone(this._startBox),this._xfactor=c.x>h.x?1:-1,this._yfactor=c.y>h.y?1:-1,1===b||5===b)this._xfactor=0;else if(3===b||7===b)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===b?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(a,b){var d=a.host._index,h=this._defaultEventArgs,c,l,y,e;h.angle=0;h.scaleX=1;
h.scaleY=1;if(8===d)c=this._startLine,l=this._moveLine,y=l[1],y.x+=b.dx,y.y+=b.dy,y=this._getAngle(c,l),this._isTextPoint&&(y+=this._graphic.symbol.angle),l=f.rotategAt(y,c[0]),this._graphic.getDojoShape().setTransform(l),h.transform=l,h.angle=y,h.around=c[0];else{c=this._startBox;l=this._moveBox;l.width+=b.dx*this._xfactor;l.height+=b.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(c=l.x+this._xfactor*l.width,l=l.y+this._yfactor*l.height,c=Math.sqrt((c-this._centerCoord.x)*(c-this._centerCoord.x)+
(l-this._centerCoord.y)*(l-this._centerCoord.y)),this._scaleRatio=y=e=c/this._firstMoverToAnchor,c=this._centerCoord):(y=l.width/c.width,e=l.height/c.height,c={x:c.x,y:c.y});if(isNaN(y)||Infinity===y||-Infinity===y)y=1;if(isNaN(e)||Infinity===e||-Infinity===e)e=1;l=f.scaleAt(y,e,c);if(this._isTextPoint){var k=f.rotategAt(this._graphic.symbol.angle,c);this._graphic.getDojoShape().setTransform([k,l])}else this._graphic.getDojoShape().setTransform(l);h.transform=l;h.scaleX=y;h.scaleY=e;h.around=c}this._toolbar["on"+
(8===d?this._rotateEvent:this._scaleEvent)](this._graphic,h)},_moveStopHandler:function(a){var b=this._graphic,c=this._toolbar,l=c._geo?d.geographicToWebMercator(b.geometry):b.geometry,f=l.spatialReference,e=b.getDojoShape(),y=e.getTransform(),k=b.getLayer()._div.getTransform();this._isTextPoint?(b=this._graphic.symbol,8===a.host._index?b.angle+=this._getAngle(this._startLine,this._moveLine):b.font.setSize(Math.round(100*b.font.size*this._scaleRatio)/100),this._graphic.setSymbol(b)):(l=l.toJson(),
this._updateSegments(l.paths||l.rings,y,k,f),e.setTransform(null),l=h.fromJson(l),b.setGeometry(c._geo?d.webMercatorToGeographic(l,!0):l));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;c._endOperation("BOX");this._defaultEventArgs.transform=y;c["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(a,b,h,d){var c=this._map,l=this._wrapOffset||0;e.forEach(a,function(a){e.forEach(a,
function(a){this._updatePoint(a,d,l,f,c,h,b)},this)},this)},_updatePoint:function(a,b,h,d,c,l,f){b=c.toScreen({x:a[0],y:a[1],spatialReference:b},!0);b.x+=h;b=d.multiplyPoint([l,f,d.invert(l)],b);b.x-=h;h=c.toMap(b);a[0]=h.x;a[1]=h.y},_getAngle:function(a,b){var h=180*Math.atan2(a[0].y-a[1].y,a[0].x-a[1].x)/Math.PI;return 180*Math.atan2(b[0].y-b[1].y,b[0].x-b[1].x)/Math.PI-h},_deNormalizePoint:function(a,b){var h=this._map._getFrameWidth();if(-1===h)return a;for(var d={x:a.x,y:a.y};Math.abs(d.x-b.x)>=
h;)d.x=d.x<b.x?d.x+h:d.x-h;var c=Math.abs(d.x-b.x);Math.abs(d.x-b.x+h)<c?d.x+=h:Math.abs(d.x-b.x-h)<c&&(d.x-=h);return d}});s("extend-esri")&&q.setObject("toolbars._Box",g,c);return g})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,
showAttribution:null});e("extend-esri")&&q.setObject("tasks.PrintTemplate",g,r);return g})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(g,q,e){function r(c){var f=Math.cos(c);c=Math.sin(c);var b={x:f+4/3*(1-f),y:c-4/3*f*(1-f)/c};return{s:{x:f,y:-c},c1:{x:b.x,y:-b.y},c2:b,e:{x:f,y:c}}}var t=2*Math.PI,s=Math.PI/4,v=Math.PI/8,m=s+v,f=r(v);return g.arc={unitArcAsBezier:r,curvePI4:f,arcAsBezier:function(c,n,b,k,a,d,h,l){a=Boolean(a);d=Boolean(d);var u=e._degToRad(k);
k=n*n;var w=b*b,g=e.multiplyPoint(e.rotate(-u),{x:(c.x-h)/2,y:(c.y-l)/2}),q=g.x*g.x,z=g.y*g.y;k=Math.sqrt((k*w-k*z-w*q)/(k*z+w*q));isNaN(k)&&(k=0);k={x:k*n*g.y/b,y:-k*b*g.x/n};a==d&&(k={x:-k.x,y:-k.y});k=e.multiplyPoint([e.translate((c.x+h)/2,(c.y+l)/2),e.rotate(u)],k);n=e.normalize([e.translate(k.x,k.y),e.rotate(u),e.scale(n,b)]);k=e.invert(n);c=e.multiplyPoint(k,c);l=e.multiplyPoint(k,h,l);h=Math.atan2(c.y,c.x);l=Math.atan2(l.y,l.x);k=h-l;d&&(k=-k);0>k?k+=t:k>t&&(k-=t);b=v;l=f;b=d?b:-b;c=[];for(a=
k;0<a;a-=s)a<m&&(b=a/2,l=r(b),b=d?b:-b,a=0),g=e.normalize([n,e.rotate(h+b)]),d?(k=e.multiplyPoint(g,l.c1),u=e.multiplyPoint(g,l.c2),g=e.multiplyPoint(g,l.e)):(k=e.multiplyPoint(g,l.c2),u=e.multiplyPoint(g,l.c1),g=e.multiplyPoint(g,l.s)),c.push([k.x,k.y,u.x,u.y,g.x,g.y]),h+=2*b;return c}}})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(g,q,e,r,t,s,v){g=
g(v,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(e,f){f&&(f.imageParameters&&f.imageParameters.extent)&&(this.initialExtent=this.fullExtent=f.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=q.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(g,f,c,n){var b=g.spatialReference.wkid;n(this._url.path+"?"+t.objectToQuery(q.mixin(this._params,{f:"image",bbox:e.toJson(g.toJson()),bboxSR:b,imageSR:b,
size:f+","+c})))}});r("extend-esri")&&q.setObject("tasks._GPResultImageLayer",g,s);return g})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(g,q,e){var r={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},t={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},
s={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},v={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},m={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},f={LengthUnit:r,OutputLine:t,UTurn:s,OutputPolygon:v,TravelDirection:m};q("extend-esri")&&(g.setObject("tasks._NALengthUnit",
r,e),g.setObject("tasks.NAOutputLine",t,e),g.setObject("tasks.NAUTurn",s,e),g.setObject("tasks.NAOutputPolygon",v,e),g.setObject("tasks.NATravelDirection",m,e));return f})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d,h){n("dijit-legacy-requires")&&h(0,function(){g(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return e("dijit.Menu",d,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):q.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return k.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=r.byId(a,this.ownerDocument);var h;if("iframe"==a.tagName.toLowerCase()){var d=a;h=this._iframeContentWindow(d);h=b.body(h.document)}else h=a==b.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var e={node:a,iframe:d};t.set(a,"_dijitMenu"+this.id,
this._bindings.push(e));var k=f.hitch(this,function(a){var b=this.selector,h=b?function(a){return c.selector(b,a)}:function(a){return a},l=this;return[c(a,h(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<this._lastKeyDown+500||l._scheduleOpen(this,d,{x:a.pageX,y:a.pageY},a.target)}),c(a,h("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==m.F10||this.leftClickToOpen&&a.keyCode==m.SPACE)a.stopPropagation(),a.preventDefault(),
l._scheduleOpen(this,d,null,a.target),this._lastKeyDown=(new Date).getTime()})]});e.connects=h?k(h):[];d&&(e.onloadHandler=f.hitch(this,function(){var a=this._iframeContentWindow(d),a=b.body(a.document);e.connects=k(a)}),d.addEventListener?d.addEventListener("load",e.onloadHandler,!1):d.attachEvent("onload",e.onloadHandler))},unBindDomNode:function(a){var b;try{b=r.byId(a,this.ownerDocument)}catch(h){return}a="_dijitMenu"+this.id;if(b&&t.has(b,a)){for(var d=t.get(b,a)-1,c=this._bindings[d],f;f=c.connects.pop();)f.remove();
(f=c.iframe)&&(f.removeEventListener?f.removeEventListener("load",c.onloadHandler,!1):f.detachEvent("onload",c.onloadHandler));t.remove(b,a);delete this._bindings[d]}},_scheduleOpen:function(a,b,d,h){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:h,delegatedTarget:a,iframe:b,coords:d})},1))},_openMyself:function(b){function d(){m.refocus&&q&&q.focus();a.close(m)}var h=b.target,c=b.iframe,f=b.coords,e=!f;this.currentTarget=b.delegatedTarget;
if(f){if(c){b=s.position(c,!0);var h=this._iframeContentWindow(c),h=s.docScroll(h.document),k=v.getComputedStyle(c),y=v.toPixelValue,g=(n("ie")&&n("quirks")?0:y(c,k.paddingLeft))+(n("ie")&&n("quirks")?y(c,k.borderLeftWidth):0),c=(n("ie")&&n("quirks")?0:y(c,k.paddingTop))+(n("ie")&&n("quirks")?y(c,k.borderTopWidth):0);f.x+=b.x+g-h.x;f.y+=b.y+c-h.y}}else f=s.position(h,!0),f.x+=10,f.y+=10;var m=this,c=this._focusManager.get("prevNode");b=this._focusManager.get("curNode");var q=!b||r.isDescendant(b,
this.domNode)?c:b;a.open({popup:this,x:f.x,y:f.y,onExecute:d,onCancel:d,orient:this.isLeftToRight()?"L":"R"});this.focus();e||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);a.close(this)}},destroy:function(){q.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ./Task ../geometry/Polygon ../renderers/SimpleRenderer ../geometry/scaleUtils ./Geoprocessor ./PrintTemplate dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d,h,l,u,w,C,B){g=g(b,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,b){this.url=a;this.printGp=new h(this.url);this._handler=q.hitch(this,this._handler);b&&b.async&&(this.async=b.async);this._colorEvaluator=B("$..color")},_handler:function(a,b,h,d,c){try{var f;this.async?"esriJobSucceeded"===a.jobStatus&&this.printGp.getResultData(a.jobId,"Output_File",q.hitch(this,function(a){f=a.value;this._successHandler([f],"onComplete",h,c)})):(f=a[0].value,
this._successHandler([f],"onComplete",h,c))}catch(l){this._errorHandler(l,d,c)}},execute:function(a,b,h){var d=this._handler,f=this._errorHandler,k=a.template||new l,u=k.exportOptions,n;u&&(n={outputSize:[u.width,u.height],dpi:u.dpi});this._outScale=k.outScale;this._preserveScale=!1!==k.preserveScale;var u=k.layoutOptions,x,g=[];if(u){this.legendAll=!1;u.legendLayers?e.forEach(u.legendLayers,function(a){var b={};b.id=a.layerId;a.subLayerIds&&(b.subLayerIds=a.subLayerIds);g.push(b)}):this.legendAll=
!0;var w,s;if("Miles"===u.scalebarUnit||"Kilometers"===u.scalebarUnit)w="esriKilometers",s="esriMiles";else if("Meters"===u.scalebarUnit||"Feet"===u.scalebarUnit)w="esriMeters",s="esriFeet";x={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};x={titleText:u.titleText,authorText:u.authorText,copyrightText:u.copyrightText,customTextElements:u.customTextElements,scaleBarOptions:{metricUnit:w,metricLabel:x[w],nonMetricUnit:s,nonMetricLabel:x[s]},legendOptions:{operationalLayers:g}}}w=this._getPrintDefinition(a.map);
a.outSpatialReference&&(w.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&m.isDefined(a.template.showAttribution)&&(w.mapOptions.showAttribution=a.template.showAttribution);q.mixin(w,{exportOptions:n,layoutOptions:x});this.allLayerslegend&&q.mixin(w.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});k={Web_Map_as_JSON:r.toJson(m.fixJson(w)),Format:k.format,Layout_Template:k.layout};a.extraParameters&&(k=q.mixin(k,a.extraParameters));var L=new t(c._dfdCanceller);
a=function(a,c){d(a,c,b,h,L)};n=function(a){f(a,h,L)};L._pendingDfd=this.async?this.printGp.submitJob(k,a,null,n):this.printGp.execute(k,a,n);return L},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},
featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=s("ie"))&&
a.path){this._canvasHolder||(this._canvasHolder=u.create("div"),this._canSurface=C.createSurface(this._canvasHolder,200,200));var b=this._canSurface.createObject(C.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in this._canSurface&&this._canSurface._render(!0);var h=this._canSurface.rawNode.getContext("2d"),d=Math.ceil(b.getBoundingBox().width+b.getBoundingBox().x),c=Math.ceil(b.getBoundingBox().height+b.getBoundingBox().y),f=h.getImageData(b.getBoundingBox().x,b.getBoundingBox().y,
d,c);h.canvas.width=d;h.canvas.height=c;h.putImageData(f,0,0);h=h.canvas.toDataURL("image/png");return{type:"esriPMS",imageData:h.substr(22,h.length),angle:-a.angle,contentType:"image/png",height:a.size?a.size:c-b.getBoundingBox().y,width:a.size?a.size:d-b.getBoundingBox().x,xoffset:a.xoffset,yoffset:a.yoffset}}},_convertSvgRenderer:function(a){"simple"===a.type&&a.symbol&&a.symbol.path?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===a.type?(a.defaultSymbol&&a.defaultSymbol.path&&(a.defaultSymbol=
this._convertSvgSymbol(a.defaultSymbol)),a.uniqueValueInfos&&e.forEach(a.uniqueValueInfos,function(a){a.symbol.path&&(a.symbol=this._convertSvgSymbol(a.symbol))},this)):"classBreaks"===a.type&&(a.defaultSymbol&&a.defaultSymbol.path&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&e.forEach(a.classBreakInfos,function(a){a.symbol.path&&(a.symbol=this._convertSvgSymbol(a.symbol))},this))},_createFeatureCollection:function(a,b,h){var d=this._createPolygonLayer(),c=this._createPolylineLayer(),
f=this._createPointLayer(),l=this._createMultipointLayer(),u=this._createPointLayer();u.layerDefinition.name="textLayer";delete u.layerDefinition.drawingInfo;"esri.layers.FeatureLayer"===a.declaredClass&&(d.layerDefinition.name=c.layerDefinition.name=f.layerDefinition.name=l.layerDefinition.name=a.name||a.id);a.renderer&&!q.isFunction(a.renderer.attributeField)?(d.layerDefinition.drawingInfo.renderer=a.renderer.toJson(),c.layerDefinition.drawingInfo.renderer=a.renderer.toJson(),f.layerDefinition.drawingInfo.renderer=
a.renderer.toJson(),l.layerDefinition.drawingInfo.renderer=a.renderer.toJson()):(delete d.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete f.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo);var x=a.fields;!x&&(a.renderer&&!q.isFunction(a.renderer.attributeField))&&("esri.renderer.ClassBreaksRenderer"===a.renderer.declaredClass?(x=[{name:a.renderer.attributeField,type:"esriFieldTypeDouble"}],a.renderer.normalizationField&&x.push({name:a.renderer.normalizationField,
type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&(x=[{name:a.renderer.attributeField,type:"esriFieldTypeString"}],a.renderer.attributeField2&&x.push({name:a.renderer.attributeField2,type:"esriFieldTypeString"}),a.renderer.attributeField3&&x.push({name:a.renderer.attributeField3,type:"esriFieldTypeString"})));x&&(d.layerDefinition.fields=x,c.layerDefinition.fields=x,f.layerDefinition.fields=x,l.layerDefinition.fields=x);var n;for(n=0;n<a.graphics.length;n++){var w=
a.graphics[n];if(!1!==w.visible&&w.geometry&&(x=w.toJson(),!x.symbol||!(x.symbol.outline&&"esriCLS"===x.symbol.outline.type))){x.symbol&&(x.symbol.outline&&x.symbol.outline.color&&x.symbol.outline.color[3])&&(x.symbol.outline.color[3]=255);if(a.renderer&&!x.symbol&&(q.isFunction(a.renderer.attributeField)||this._hasVisualVariables(a.renderer)||"esri.renderer.DotDensityRenderer"===a.renderer.declaredClass||h)){h=h||a.renderer;var g=h.getSymbol(w);if(!g)continue;x.symbol=g.toJson();this._hasVisualVariables(h)&&
this._applyVisualVariables(x.symbol,{renderer:h,graphic:w,symbol:g,mapResolution:b&&b.getResolutionInMeters()})}x.symbol&&(x.symbol.path?x.symbol=this._convertSvgSymbol(x.symbol):x.symbol.text&&delete x.attributes);switch(w.geometry.type){case "polygon":d.featureSet.features.push(x);break;case "polyline":c.featureSet.features.push(x);break;case "point":x.symbol&&x.symbol.text?u.featureSet.features.push(x):f.featureSet.features.push(x);break;case "multipoint":l.featureSet.features.push(x);break;case "extent":x.geometry=
k.fromExtent(w.geometry).toJson(),d.featureSet.features.push(x)}}}b=[];0<d.featureSet.features.length&&b.push(d);0<c.featureSet.features.length&&b.push(c);0<l.featureSet.features.length&&b.push(l);0<f.featureSet.features.length&&b.push(f);0<u.featureSet.features.length&&b.push(u);e.forEach(b,function(a){a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(a.layerDefinition.drawingInfo.renderer)},this);return{id:a.id,opacity:a.opacity,minScale:a.minScale||
0,maxScale:a.maxScale||0,featureCollection:{layers:b}}},_getPrintDefinition:function(a){var b={operationalLayers:this._createOperationalLayers(a)},h=a.extent,c=a.spatialReference;a.spatialReference._isWrappable()&&(h=h._normalize(!0),c=h.spatialReference);h={mapOptions:{showAttribution:a.showAttribution,extent:h.toJson(),spatialReference:c.toJson()}};this._preserveScale&&q.mixin(h.mapOptions,{scale:this._outScale||d.getScale(a)});a.timeExtent&&q.mixin(h.mapOptions,{time:[a.timeExtent.startTime.getTime(),
a.timeExtent.endTime.getTime()]});a={};q.mixin(a,h,b);return a},_createOperationalLayers:function(b){var h,d,c,l,u=[],k=[];this.allLayerslegend=this.legendAll?[]:null;for(h=0;h<b.layerIds.length;h++)if(d=b.getLayer(b.layerIds[h]),d.loaded&&d.visible&&-1===e.indexOf(u,d.id))switch(c=d.declaredClass,l={id:d.id,title:d.id,opacity:d.opacity,minScale:d.minScale||0,maxScale:d.maxScale||0},l=q.mixin(l,this._getUrlAndToken(d)),c){case "esri.layers.ArcGISDynamicMapServiceLayer":var n=[];c=!!d._params.layers;
if(d._params.dynamicLayers)c=r.fromJson(d._params.dynamicLayers),e.forEach(c,function(a){n.push({id:a.id,name:a.name,layerDefinition:a});delete a.id;delete a.name;delete a.maxScale;delete a.minScale});else if(d.supportsDynamicLayers){if(c||d.layerDefinitions||d.layerTimeOptions){var x=d.createDynamicLayerInfosFromLayerInfos(),w=null;c&&(w=d.visibleLayers);var w=f._getVisibleLayers(x,w),g=f._getLayersForScale(this._outScale||b.getScale(),x);e.forEach(x,function(a){if(!a.subLayerIds){var b=a.id;-1<
e.indexOf(w,b)&&-1<e.indexOf(g,b)&&(a={source:a.source.toJson()},d.layerDefinitions&&d.layerDefinitions[b]&&(a.definitionExpression=d.layerDefinitions[b]),d.layerTimeOptions&&d.layerTimeOptions[b]&&(a.layerTimeOptions=d.layerTimeOptions[b].toJson()),n.push({id:b,layerDefinition:a}))}});0===n.length&&(l.visibleLayers=[-1])}}else e.forEach(d.layerInfos,function(a){var b={id:a.id,layerDefinition:{}};d.layerDefinitions&&d.layerDefinitions[a.id]&&(b.layerDefinition.definitionExpression=d.layerDefinitions[a.id]);
d.layerTimeOptions&&d.layerTimeOptions[a.id]&&(b.layerDefinition.layerTimeOptions=d.layerTimeOptions[a.id].toJson());(b.layerDefinition.definitionExpression||b.layerDefinition.layerTimeOptions)&&n.push(b)}),c&&(l.visibleLayers=d.visibleLayers);n.length&&(l.layers=n);k.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:d.id,subLayerIds:d.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":l=q.mixin(l,{url:d.url,bandIds:d.bandIds,compressionQuality:d.compressionQuality,format:d.format,
interpolation:d.interpolation});d.mosaicRule&&q.mixin(l,{mosaicRule:d.mosaicRule.toJson()});d.renderingRule&&q.mixin(l,{renderingRule:d.renderingRule.toJson()});k.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:d.id});break;case "esri.layers.WMSLayer":l=q.mixin(l,{url:d.url,title:d.title,type:"wms",version:d.version,transparentBackground:d.imageTransparency,visibleLayers:d.visibleLayers});k.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:d.id,subLayerIds:d.visibleLayers});
break;case "esri.virtualearth.VETiledLayer":c=d.mapStyle;"aerialWithLabels"===c&&(c="Hybrid");l=q.mixin(l,{visibility:d.visible,type:"BingMaps"+c,culture:d.culture,key:d.bingMapsKey});k.push(l);break;case "esri.layers.OpenStreetMapLayer":l=q.mixin(l,{type:"OpenStreetMap",url:d.tileServers[0]});k.push(l);break;case "esri.layers.WMTSLayer":l=q.mixin(l,{url:d.url,type:"wmts",layer:d._identifier,style:d._style,format:d.format,tileMatrixSet:d._tileMatrixSetId});k.push(l);break;case "esri.layers.MapImageLayer":c=
d.getImages();e.forEach(c,function(a,b){a.href&&(l={id:d.id+"_image"+b,type:"image",title:d.id,minScale:d.minScale||0,maxScale:d.maxScale||0,opacity:d.opacity,extent:a.extent.toJson(),url:a.href},k.push(l))});break;case "esri.layers.WebTiledLayer":c=d.url.replace(/\$\{/g,"{");l=q.mixin(l,{type:"WebTiledLayer",urlTemplate:c,credits:d.copyright});d.subDomains&&0<d.subDomains.length&&(l.subDomains=d.subDomains);k.push(l);break;default:if(d.getTileUrl||d.getImageUrl)l=q.mixin(l,{url:d.url}),k.push(l)}for(h=
0;h<b.graphicsLayerIds.length;h++)if(d=b.getLayer(b.graphicsLayerIds[h]),d.loaded&&d.visible&&-1===e.indexOf(u,d.id))switch(c=d.declaredClass,c){case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.CSVLayer":c=null;d.url&&d.renderer&&("esri.renderer.ScaleDependentRenderer"===d.renderer.declaredClass?"scale"===d.renderer.rangeType?c=d.renderer.getRendererInfoByScale(b.getScale())&&d.renderer.getRendererInfoByScale(b.getScale()).renderer:"zoom"===d.renderer.rangeType&&(c=
d.renderer.getRendererInfoByZoom(b.getZoom())&&d.renderer.getRendererInfoByZoom(b.getZoom()).renderer):c=d.renderer);if(c&&("esri.renderer.SimpleRenderer"===c.declaredClass||"esri.renderer.TemporalRenderer"===c.declaredClass||q.isString(c.attributeField)&&d._getField(c.attributeField,!0))&&!this._hasVisualVariables(c)&&"esri.renderer.DotDensityRenderer"!==c.declaredClass&&"esri.layers.CSVLayer"!==d.declaredClass)if(l={id:d.id,title:d.id,opacity:d.opacity,minScale:d.minScale||0,maxScale:d.maxScale||
0,layerDefinition:{drawingInfo:{renderer:c.toJson()}}},l=q.mixin(l,this._getUrlAndToken(d)),"esri.renderer.TemporalRenderer"===c.declaredClass&&(x=l.layerDefinition.drawingInfo,x.latestObservationRenderer=x.renderer.latestObservationRenderer,x.trackLinesRenderer=x.renderer.trackRenderer,x.observationAger=x.renderer.observationAger,x.renderer=x.renderer.observationRenderer,d._trackIdField&&(l.layerDefinition.timeInfo={trackIdField:d._trackIdField})),this._convertSvgRenderer(l.layerDefinition.drawingInfo.renderer),
1>d.opacity||"esri.renderer.TemporalRenderer"===c.declaredClass||this._updateLayerOpacity(l))if(d._params.source&&(c=d._params.source.toJson(),q.mixin(l.layerDefinition,{source:c})),d.getDefinitionExpression()&&q.mixin(l.layerDefinition,{definitionExpression:d.getDefinitionExpression()}),2!==d.mode)0<d.getSelectedFeatures().length&&(c=e.map(d.getSelectedFeatures(),function(a){return a.attributes[d.objectIdField]}),0<c.length&&d.getSelectionSymbol()&&q.mixin(l,{selectionObjectIds:c,selectionSymbol:d.getSelectionSymbol().toJson()}));
else{c=e.map(d.getSelectedFeatures(),function(a){return a.attributes[d.objectIdField]});if(0===c.length||!d._params.drawMode)break;q.mixin(l.layerDefinition,{objectIds:c});c=null;d.getSelectionSymbol()&&(c=new a(d.getSelectionSymbol()));q.mixin(l.layerDefinition.drawingInfo,{renderer:c&&c.toJson()})}else l=this._createFeatureCollection(d);else l=c&&(this._hasVisualVariables(c)||"esri.renderer.DotDensityRenderer"===c.declaredClass)?this._createFeatureCollection(d,b,c):this._createFeatureCollection(d);
k.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:d.id});break;case "esri.layers.GraphicsLayer":l=this._createFeatureCollection(d),k.push(l),this.allLayerslegend&&this.allLayerslegend.push({id:d.id})}b.graphics&&0<b.graphics.graphics.length&&(l=this._createFeatureCollection(b.graphics),k.push(l));b._labels&&(l=this._createFeatureCollection(b._labels),k.push(l));return k},_getUrlAndToken:function(a){return{token:a._getToken(),url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var d=
this._colorEvaluator(a),d=e.filter(d,function(a){return q.isArray(a)&&4===a.length}),b=!0;if(d.length){var h=d[0][3],c;for(c=1;c<d.length;c++)if(h!==d[c][3]){b=!1;break}if(b){a.opacity=h/255;for(c=0;c<d.length;c++)d[c][3]=255}}return b},_hasVisualVariables:function(a){return this._getVariable(a,"sizeInfo")||this._getVariable(a,"colorInfo")||this._getVariable(a,"opacityInfo")},_getVariable:function(a,d){return a?a[d]||e.filter(a.visualVariables,function(a){return a.type===d})[0]:null},_applyVisualVariables:function(a,
d){var b=d.renderer,h=d.graphic,c=d.symbol,l=d.mapResolution,f=c.type;if(!("textsymbol"===f||"shieldlabelsymbol"===f)){var k=this._getVariable(b,"sizeInfo"),u=this._getVariable(b,"colorInfo"),e=this._getVariable(b,"opacityInfo");k&&(c=b.getSize(h,{sizeInfo:k,shape:"simplemarkersymbol"===f?c.style:null,resolution:l}),null!=c&&("simplemarkersymbol"===f?a.size=w.px2pt(c):"picturemarkersymbol"===f?(a.width=w.px2pt(c),a.height=w.px2pt(c)):"simplelinesymbol"===f?a.width=w.px2pt(c):a.outline&&(a.outline.width=
w.px2pt(c))));if(u&&(u=b.getColor(h,{colorInfo:u}))&&("simplemarkersymbol"===f||"simplelinesymbol"===f||"simplefillsymbol"===f))a.color=n.toJsonColor(u);e&&(b=b.getOpacity(h,{opacityInfo:e}),null!=b&&a.color&&(a.color[3]=Math.round(255*b)))}}});s("extend-esri")&&q.setObject("tasks.PrintTask",g,v);return g})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d){return q("dijit._MenuBase",[b,d,a,k],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){t.toggle(this.domNode,"dijitMenuActive",a);t.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var d=n.byNode(a);return a.parentNode==this.containerNode&&d&&d.focus},postCreate:function(){var a=this,d="string"==typeof this.childSelector?this.childSelector:s.hitch(this,"childSelector");this.own(m(this.containerNode,m.selector(d,v.enter),function(){a.onItemHover(n.byNode(this))}),m(this.containerNode,m.selector(d,v.leave),function(){a.onItemUnhover(n.byNode(this))}),m(this.containerNode,m.selector(d,c),function(d){a.onItemClick(n.byNode(this),d);d.stopPropagation()}),
m(this.containerNode,m.selector(d,"focusin"),function(){a._onItemFocus(n.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,d,b,c){this.inherited(arguments);if(a&&(-1==c||a.popup&&1==c))this.onItemClick(a,d)},_keyboardSearchCompare:function(a,d){return a.shortcutKey?d==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,d){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var b=/^key/.test(d._origType||
d.type)||0==d.clientX&&0==d.clientY;this._openItemPopup(a,b)}else this.onExecute(),a._onClick?a._onClick(d):a.onClick(d)},_openItemPopup:function(a,d){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var b=a.popup;b.parentMenu=this;this.own(this._mouseoverHandle=m.once(b.domNode,"mouseover",s.hitch(this,"_onPopupHover")));var c=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){d&&
c.focusChild(a);c._cleanUp()},onExecute:s.hitch(this,"_cleanUp",!0),onClose:function(){c._mouseoverHandle&&(c._mouseoverHandle.remove(),delete c._mouseoverHandle)}},d);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(r.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k){function a(a,d,b,c,h,l,f,k,e,u){var n,x,w=d.length,g=0;u?(x=u.l/h,g=u.i):x=d[0]/h;for(;l<f;)l+x>f&&(n={l:(l+x-f)*h,i:g},x=f-l),g%2||(a.beginPath(),a.arc(b,c,h,l,l+x,k),e&&a.stroke()),l+=x,++g,x=d[g%w]/h;return n}function d(a,d,b,c){var h=0,l=0,f,e=0;c?(f=c.l,e=c.i):f=d[0];for(;1>l;)l=k.tAtLength(a,f),1==l&&(h=k.computeLength(a),h={l:f-h,i:e}),a=k.splitBezierAtT(a,l),e%2||b.push(a[0]),a=a[1],++e,f=d[e%d.length];return h}function h(a,b,c,h){var l=[b.last.x,b.last.y].concat(c),
f=!(a instanceof Array);c=4===c.length?"quadraticCurveTo":"bezierCurveTo";var k=[];b=d(l,b.canvasDash,k,h);for(h=0;h<k.length;++h)l=k[h],f?(a.moveTo(l[0],l[1]),a[c].apply(a,l.slice(2))):(a.push("moveTo",[l[0],l[1]]),a.push(c,l.slice(2)));return b}function l(a,d,b,c,h,l,f){var e=0,u=0,n=0,x=k.distance(b,c,h,l),w=0;d=d.canvasDash;var g=b,m=c,s,v=!(a instanceof Array);f?(n=f.l,w=f.i):n+=d[0];for(;0.01<Math.abs(1-u);)n>x&&(e={l:n-x,i:w},n=x),u=n/x,f=b+(h-b)*u,s=c+(l-c)*u,w++%2||(v?(a.moveTo(g,m),a.lineTo(f,
s)):(a.push("moveTo",[g,m]),a.push("lineTo",[f,s]))),g=f,m=s,n+=d[w%d.length];return e}var u=g.canvas={},w=null,C=n.multiplyPoint,B=Math.PI,z=2*B,E=B/2;b=q.extend;if(t.global.CanvasRenderingContext2D){t=t.doc.createElement("canvas").getContext("2d");var y="function"==typeof t.setLineDash,F="function"==typeof t.fillText}var H={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],
longdashdotdot:[8,3,1,3,1,3]};u.Shape=r("dojox.gfx.canvas.Shape",m.Shape,{_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);this._renderShape(a);this._renderFill(a,!0);this._renderStroke(a,!0);a.restore()},_renderClip:function(a){this.canvasClip&&(this.canvasClip.render(a),a.clip())},_renderTransform:function(a){if("canvasTransform"in this){var d=this.canvasTransform;a.translate(d.dx,d.dy);a.rotate(d.angle2);a.scale(d.sx,d.sy);a.rotate(d.angle1)}},_renderShape:function(a){},
_renderFill:function(a,d){if("canvasFill"in this){var b=this.fillStyle;if("canvasFillImage"in this){var c=b.width,h=b.height,l=this.canvasFillImage.width,f=this.canvasFillImage.height,k=Math.min(c==l?1:c/l,h==f?1:h/f),e=(c-k*l)/2,u=(h-k*f)/2;w.width=c;w.height=h;var n=w.getContext("2d");n.clearRect(0,0,c,h);n.drawImage(this.canvasFillImage,0,0,l,f,e,u,k*l,k*f);this.canvasFill=a.createPattern(w,"repeat");delete this.canvasFillImage}a.fillStyle=this.canvasFill;d&&("pattern"===b.type&&(0!==b.x||0!==
b.y)&&a.translate(b.x,b.y),a.fill())}else a.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(a,d){var b=this.strokeStyle;b?(a.strokeStyle=b.color.toString(),a.lineWidth=b.width,a.lineCap=b.cap,"number"==typeof b.join?(a.lineJoin="miter",a.miterLimit=b.join):a.lineJoin=b.join,this.canvasDash?y?(a.setLineDash(this.canvasDash),d&&a.stroke()):this._renderDashedStroke(a,d):d&&a.stroke()):d||(a.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(a,d){},getEventSource:function(){return null},
on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(a){this.inherited(arguments);var d=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!d)return this;this.canvasClip=a?D(d,a):null;this.parent&&this.parent._makeDirty();return this}});var D=function(a,d){switch(a){case "ellipse":return{canvasEllipse:J({shape:d}),render:function(a){return u.Ellipse.prototype._renderShape.call(this,a)}};case "rect":return{shape:q.delegate(d,
{r:0}),render:function(a){return u.Rect.prototype._renderShape.call(this,a)}};case "path":return{canvasPath:A(d),render:function(a){this.canvasPath._renderShape(a)}};case "polyline":return{canvasPolyline:d.points,render:function(a){return u.Polyline.prototype._renderShape.call(this,a)}}}return null},A=function(a){var d=new dojox.gfx.canvas.Path;d.canvasPath=[];d._setPath(a.d);return d},G=function(a,d,b){var c=a.prototype[d];a.prototype[d]=b?function(){this.parent&&this.parent._makeDirty();c.apply(this,
arguments);b.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return c.apply(this,arguments)}};G(u.Shape,"setTransform",function(){this.matrix?this.canvasTransform=g.decompose(this.matrix):delete this.canvasTransform});G(u.Shape,"setFill",function(){var a=this.fillStyle,d;if(a){if("object"==typeof a&&"type"in a){var b=this.surface.rawNode.getContext("2d");switch(a.type){case "linear":case "radial":d="linear"==a.type?b.createLinearGradient(a.x1,a.y1,a.x2,a.y2):b.createRadialGradient(a.cx,
a.cy,0,a.cx,a.cy,a.r);e.forEach(a.colors,function(a){d.addColorStop(a.offset,g.normalizeColor(a.color).toString())});break;case "pattern":w||(w=document.createElement("canvas")),b=new Image,this.surface.downloadImage(b,a.src),this.canvasFillImage=b}}else d=a.toString();this.canvasFill=d}else delete this.canvasFill});G(u.Shape,"setStroke",function(){var a=this.strokeStyle;if(a){var d=this.strokeStyle.style.toLowerCase();d in H&&(d=H[d]);if(d instanceof Array){this.canvasDash=d=d.slice();var b;for(b=
0;b<d.length;++b)d[b]*=a.width;if("butt"!=a.cap){for(b=0;b<d.length;b+=2)d[b]-=a.width,1>d[b]&&(d[b]=1);for(b=1;b<d.length;b+=2)d[b]+=a.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!y&&!!this.canvasDash});G(u.Shape,"setShape");u.Group=r("dojox.gfx.canvas.Group",u.Shape,{constructor:function(){m.Container._init.call(this)},_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);for(var d=0;d<this.children.length;++d)this.children[d]._render(a);a.restore()},
destroy:function(){m.Container.clear.call(this,!0);u.Shape.prototype.destroy.apply(this,arguments)}});u.Rect=r("dojox.gfx.canvas.Rect",[u.Shape,m.Rect],{_renderShape:function(a){var d=this.shape,b=Math.min(d.r,d.height/2,d.width/2),c=d.x,h=c+d.width,l=d.y,d=l+d.height,f=c+b,k=h-b,e=l+b,u=d-b;a.beginPath();a.moveTo(f,l);b?(a.arc(k,e,b,-E,0,!1),a.arc(k,u,b,0,E,!1),a.arc(f,u,b,E,B,!1),a.arc(f,e,b,B,B+E,!1)):(a.lineTo(k,l),a.lineTo(h,u),a.lineTo(f,d),a.lineTo(c,e));a.closePath()},_renderDashedStroke:function(d,
b){var c=this.shape,h=Math.min(c.r,c.height/2,c.width/2),f=c.x,k=f+c.width,e=c.y,u=e+c.height,n=f+h,x=k-h,w=e+h,g=u-h;h?(d.beginPath(),c=l(d,this,n,e,x,e),b&&d.stroke(),c=a(d,this.canvasDash,x,w,h,-E,0,!1,b,c),d.beginPath(),c=l(d,this,k,w,k,g,c),b&&d.stroke(),c=a(d,this.canvasDash,x,g,h,0,E,!1,b,c),d.beginPath(),c=l(d,this,x,u,n,u,c),b&&d.stroke(),c=a(d,this.canvasDash,n,g,h,E,B,!1,b,c),d.beginPath(),c=l(d,this,f,g,f,w,c),b&&d.stroke(),a(d,this.canvasDash,n,w,h,B,B+E,!1,b,c)):(d.beginPath(),c=l(d,
this,n,e,x,e),c=l(d,this,x,e,k,g,c),c=l(d,this,k,g,n,u,c),l(d,this,n,u,f,w,c),b&&d.stroke())}});var x=[];(function(){var a=c.curvePI4;x.push(a.s,a.c1,a.c2,a.e);for(var d=45;360>d;d+=45){var b=n.rotateg(d);x.push(C(b,a.c1),C(b,a.c2),C(b,a.e))}})();var J=function(a){var b,c,h,l=[],f=a.shape,k=n.normalize([n.translate(f.cx,f.cy),n.scale(f.rx,f.ry)]);b=C(k,x[0]);l.push([b.x,b.y]);for(f=1;f<x.length;f+=3)c=C(k,x[f]),h=C(k,x[f+1]),b=C(k,x[f+2]),l.push([c.x,c.y,h.x,h.y,b.x,b.y]);if(a._needsDash){b=[];c=
l[0];for(f=1;f<l.length;++f)h=[],d(c.concat(l[f]),a.canvasDash,h),c=[l[f][4],l[f][5]],b.push(h);a._dashedPoints=b}return l};u.Ellipse=r("dojox.gfx.canvas.Ellipse",[u.Shape,m.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=J(this);return this},setStroke:function(){this.inherited(arguments);y||(this.canvasEllipse=J(this));return this},_renderShape:function(a){var d=this.canvasEllipse,b;a.beginPath();a.moveTo.apply(a,d[0]);for(b=1;b<d.length;++b)a.bezierCurveTo.apply(a,d[b]);
a.closePath()},_renderDashedStroke:function(a,d){var b=this._dashedPoints;a.beginPath();for(var c=0;c<b.length;++c)for(var h=b[c],f=0;f<h.length;++f){var l=h[f];a.moveTo(l[0],l[1]);a.bezierCurveTo(l[2],l[3],l[4],l[5],l[6],l[7])}d&&a.stroke()}});u.Circle=r("dojox.gfx.canvas.Circle",[u.Shape,m.Circle],{_renderShape:function(a){var d=this.shape;a.beginPath();a.arc(d.cx,d.cy,d.r,0,z,1)},_renderDashedStroke:function(a,d){var b=this.shape,c=0,h,l=this.canvasDash.length;for(i=0;c<z;)h=this.canvasDash[i%
l]/b.r,i%2||(a.beginPath(),a.arc(b.cx,b.cy,b.r,c,c+h,0),d&&a.stroke()),c+=h,++i}});u.Line=r("dojox.gfx.canvas.Line",[u.Shape,m.Line],{_renderShape:function(a){var d=this.shape;a.beginPath();a.moveTo(d.x1,d.y1);a.lineTo(d.x2,d.y2)},_renderDashedStroke:function(a,d){var b=this.shape;a.beginPath();l(a,this,b.x1,b.y1,b.x2,b.y2);d&&a.stroke()}});u.Polyline=r("dojox.gfx.canvas.Polyline",[u.Shape,m.Polyline],{setShape:function(){this.inherited(arguments);var a=this.shape.points,d=a[0],b,c;this.bbox=null;
this._normalizePoints();if(a.length)if("number"==typeof d)d=a;else{d=[];for(c=0;c<a.length;++c)b=a[c],d.push(b.x,b.y)}else d=[];this.canvasPolyline=d;return this},_renderShape:function(a){var d=this.canvasPolyline;if(d.length){a.beginPath();a.moveTo(d[0],d[1]);for(var b=2;b<d.length;b+=2)a.lineTo(d[b],d[b+1])}},_renderDashedStroke:function(a,d){var b=this.canvasPolyline,c=0;a.beginPath();for(var h=0;h<b.length;h+=2)c=l(a,this,b[h],b[h+1],b[h+2],b[h+3],c);d&&a.stroke()}});u.Image=r("dojox.gfx.canvas.Image",
[u.Shape,m.Image],{setShape:function(){this.inherited(arguments);var a=new Image;this.surface.downloadImage(a,this.shape.src);this.canvasImage=a;return this},_renderShape:function(a){var d=this.shape;a.drawImage(this.canvasImage,d.x,d.y,d.width,d.height)}});u.Text=r("dojox.gfx.canvas.Text",[u.Shape,m.Text],{_setFont:function(){this.fontStyle?this.canvasFont=g.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var a=this.shape,d=0,b;a.text&&(b=this.surface.rawNode.getContext("2d"),
b.save(),this._renderTransform(b),this._renderFill(b,!1),this._renderStroke(b,!1),this.canvasFont&&(b.font=this.canvasFont),d=b.measureText(a.text).width,b.restore());return d},_render:function(a){a.save();this._renderTransform(a);this._renderFill(a,!1);this._renderStroke(a,!1);this._renderShape(a);a.restore()},_renderShape:function(a){var d,b=this.shape;b.text&&(d="middle"===b.align?"center":b.align,a.textAlign=d,this.canvasFont&&(a.font=this.canvasFont),this.canvasFill&&a.fillText(b.text,b.x,b.y),
this.strokeStyle&&(a.beginPath(),a.strokeText(b.text,b.x,b.y),a.closePath()))}});G(u.Text,"setFont");F||u.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var M={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",
z:"_closePath"};u.Path=r("dojox.gfx.canvas.Path",[u.Shape,f.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);y||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(a){var d=q.clone(this.last);this[M[a.action]](this.canvasPath,a.action,a.args,this._needsDash?
this._dashedPath:null);this.last=d;this.inherited(arguments)},_renderShape:function(a){var d=this.canvasPath;a.beginPath();for(var b=0;b<d.length;b+=2)a[d[b]].apply(a,d[b+1])},_renderDashedStroke:y?function(){}:function(a,d){var b=this._dashedPath;a.beginPath();for(var c=0;c<b.length;c+=2)a[b[c]].apply(a,b[c+1]);d&&a.stroke()},_moveToA:function(a,d,b,c){a.push("moveTo",[b[0],b[1]]);c&&c.push("moveTo",[b[0],b[1]]);for(d=2;d<b.length;d+=2)a.push("lineTo",[b[d],b[d+1]]),c&&(this._dashResidue=l(c,this,
b[d-2],b[d-1],b[d],b[d+1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl={}},_moveToR:function(a,d,b,c){d="x"in this.last?[this.last.x+=b[0],this.last.y+=b[1]]:[this.last.x=b[0],this.last.y=b[1]];a.push("moveTo",d);c&&c.push("moveTo",d);for(d=2;d<b.length;d+=2)a.push("lineTo",[this.last.x+=b[d],this.last.y+=b[d+1]]),c&&(this._dashResidue=l(c,this,c[c.length-1][0],c[c.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(a,
d,b,c){for(d=0;d<b.length;d+=2)c&&(this._dashResidue=l(c,this,this.last.x,this.last.y,b[d],b[d+1],this._dashResidue)),a.push("lineTo",[b[d],b[d+1]]);this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl={}},_lineToR:function(a,d,b,c){for(d=0;d<b.length;d+=2)a.push("lineTo",[this.last.x+=b[d],this.last.y+=b[d+1]]),c&&(this._dashResidue=l(c,this,c[c.length-1][0],c[c.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(a,d,b,c){for(d=0;d<b.length;++d)a.push("lineTo",
[b[d],this.last.y]),c&&(this._dashResidue=l(c,this,c[c.length-1][0],c[c.length-1][1],b[d],this.last.y,this._dashResidue));this.last.x=b[b.length-1];this.lastControl={}},_hLineToR:function(a,d,b,c){for(d=0;d<b.length;++d)a.push("lineTo",[this.last.x+=b[d],this.last.y]),c&&(this._dashResidue=l(c,this,c[c.length-1][0],c[c.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(a,d,b,c){for(d=0;d<b.length;++d)a.push("lineTo",[this.last.x,b[d]]),c&&(this._dashResidue=
l(c,this,c[c.length-1][0],c[c.length-1][1],this.last.x,b[d],this._dashResidue));this.last.y=b[b.length-1];this.lastControl={}},_vLineToR:function(a,d,b,c){for(d=0;d<b.length;++d)a.push("lineTo",[this.last.x,this.last.y+=b[d]]),c&&(this._dashResidue=l(c,this,c[c.length-1][0],c[c.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(a,d,b,c){for(d=0;d<b.length;d+=6)a.push("bezierCurveTo",b.slice(d,d+6)),c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue));
this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl.x=b[b.length-4];this.lastControl.y=b[b.length-3];this.lastControl.type="C"},_curveToR:function(a,d,b,c){for(d=0;d<b.length;d+=6)a.push("bezierCurveTo",[this.last.x+b[d],this.last.y+b[d+1],this.lastControl.x=this.last.x+b[d+2],this.lastControl.y=this.last.y+b[d+3],this.last.x+b[d+4],this.last.y+b[d+5]]),c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue)),this.last.x+=b[d+4],this.last.y+=b[d+5];this.lastControl.type="C"},
_smoothCurveToA:function(a,d,b,c){for(d=0;d<b.length;d+=4){var l="C"==this.lastControl.type;a.push("bezierCurveTo",[l?2*this.last.x-this.lastControl.x:this.last.x,l?2*this.last.y-this.lastControl.y:this.last.y,b[d],b[d+1],b[d+2],b[d+3]]);c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue));this.lastControl.x=b[d];this.lastControl.y=b[d+1];this.lastControl.type="C"}this.last.x=b[b.length-2];this.last.y=b[b.length-1]},_smoothCurveToR:function(a,d,b,c){for(d=0;d<b.length;d+=4){var l="C"==
this.lastControl.type;a.push("bezierCurveTo",[l?2*this.last.x-this.lastControl.x:this.last.x,l?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+b[d],this.last.y+b[d+1],this.last.x+b[d+2],this.last.y+b[d+3]]);c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue));this.lastControl.x=this.last.x+b[d];this.lastControl.y=this.last.y+b[d+1];this.lastControl.type="C";this.last.x+=b[d+2];this.last.y+=b[d+3]}},_qCurveToA:function(a,d,b,c){for(d=0;d<b.length;d+=4)a.push("quadraticCurveTo",
b.slice(d,d+4));c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl.x=b[b.length-4];this.lastControl.y=b[b.length-3];this.lastControl.type="Q"},_qCurveToR:function(a,d,b,c){for(d=0;d<b.length;d+=4)a.push("quadraticCurveTo",[this.lastControl.x=this.last.x+b[d],this.lastControl.y=this.last.y+b[d+1],this.last.x+b[d+2],this.last.y+b[d+3]]),c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue)),this.last.x+=b[d+
2],this.last.y+=b[d+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(a,d,b,c){for(d=0;d<b.length;d+=2){var l="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=l?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=l?2*this.last.y-this.lastControl.y:this.last.y,b[d],b[d+1]]);c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=b[b.length-2];this.last.y=b[b.length-1]},_qSmoothCurveToR:function(a,d,b,c){for(d=
0;d<b.length;d+=2){var l="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=l?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=l?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+b[d],this.last.y+b[d+1]]);c&&(this._dashResidue=h(c,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=b[d];this.last.y+=b[d+1]}},_arcTo:function(a,d,b,l){d="a"==d;for(var f=0;f<b.length;f+=7){var k=b[f+5],u=b[f+6];d&&(k+=this.last.x,u+=this.last.y);var n=
c.arcAsBezier(this.last,b[f],b[f+1],b[f+2],b[f+3]?1:0,b[f+4]?1:0,k,u);e.forEach(n,function(d){a.push("bezierCurveTo",d)});l&&(this._dashResidue=h(l,this,p,this._dashResidue));this.last.x=k;this.last.y=u}this.lastControl={}},_closePath:function(a,d,b,c){a.push("closePath",[]);c&&(this._dashResidue=l(c,this,this.last.x,this.last.y,c[1][0],c[1][1],this._dashResidue));this.lastControl={}}});e.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(a){G(u.Path,a)});u.TextPath=r("dojox.gfx.canvas.TextPath",[u.Shape,f.TextPath],{_renderShape:function(a){},_setText:function(){},_setFont:function(){}});u.Surface=r("dojox.gfx.canvas.Surface",m.Surface,{constructor:function(){m.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){m.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(a,d){this.width=g.normalizedLength(a);this.height=g.normalizedLength(d);if(!this.rawNode)return this;
var b=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,b=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,b=!0);b&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(a){if(this.rawNode&&(a||!this.pendingImageCount))a=this.rawNode.getContext("2d"),a.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(a),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender)},render:function(a){a.save();for(var d=0;d<this.children.length;++d)this.children[d]._render(a);a.restore()},makeDirty:function(){!this.pendingImagesCount&&(!("pendingRender"in this)&&!this._batch)&&(this.pendingRender=setTimeout(q.hitch(this,this._render),0))},downloadImage:function(a,d){var b=q.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);a.onload=b;a.onerror=b;a.onabort=b;
a.src=d},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});u.createSurface=function(a,d,b){if(!d&&!b){var c=s.position(a);d=d||c.w;b=b||c.h}"number"==typeof d&&(d+="px");"number"==typeof b&&(b+="px");c=new u.Surface;a=v.byId(a);var h=a.ownerDocument.createElement("canvas");h.width=g.normalizedLength(d);h.height=g.normalizedLength(b);
a.appendChild(h);c.rawNode=h;c._parent=a;return c.surface=c};var I=m.Container;r={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(a){this._makeDirty();return I.add.apply(this,arguments)},remove:function(a,d){this._makeDirty();return I.remove.apply(this,arguments)},clear:function(){this._makeDirty();return I.clear.apply(this,arguments)},
getBoundingBox:I.getBoundingBox,_moveChildToFront:function(a){this._makeDirty();return I._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(a){this._makeDirty();return I._moveChildToBack.apply(this,arguments)}};f={createObject:function(a,d){var b=new a;b.surface=this.surface;b.setShape(d);this.add(b);return b}};b(u.Group,r);b(u.Group,m.Creator);b(u.Group,f);b(u.Surface,r);b(u.Surface,m.Creator);b(u.Surface,f);u.fixTarget=function(a,d){return!0};return u})},"dojox/main":function(){define(["dojo/_base/kernel"],
function(g){return g.dojox})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(g,q,e,r,t,s,v,m,f,c){g=g(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(c,b,f){this._graphic=c;this._map=b;this._toolbar=f;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},
_enable:function(c){this._editBox?(e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=e.connect(c.getLayer(),"onDblClick",this,function(b){this._map.navigationManager.setImmediateClick(!1);b.graphic==c&&(r.stop(b),e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(c))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=
null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(c,b){if(!this._editBox){var k;c.symbol.text||(c.symbol.text="Tempt text",c.setSymbol(c.symbol),k="");var a=this._createInputTextStyle(c,this._map);""!==k&&(k=b||c.symbol.text);this._editBox=s.create("input",{type:"text",value:k});m.set(this._editBox,a);v.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=
e.connect(this._editBox,"onkeyup",q.hitch(this,function(a){(a.keyCode==f.ENTER||a.keyCode===f.TAB)&&this._disable()}));this._editBoxBlurHandler=e.connect(this._editBox,"onblur",q.hitch(this,function(a){this._disable()}));c.symbol.text="";c.setSymbol(c.symbol);c.hide();var d=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",q.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){m.set(d,{left:this._editBoxLeft+a.delta.x+
"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(m.get(d,"left"));this._editBoxTop=parseFloat(m.get(d,"top"))});this.onEditStart(c,this._editBox);this._toolbar.onTextEditStart(c,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(e.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&
(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(e.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(c,b){var f=c.getDojoShape().getTransformedBoundingBox(),a=Math.abs(f[0].x-f[1].x)/Math.cos(c.symbol.angle/180*Math.PI),d=c.symbol.font;return{"font-family":d.family,
"font-size":d.size+"px","font-style":d.style,"font-variant":d.variant,"font-weight":d.weight,left:f[0].x+"px",top:f[0].y+"px",width:a+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var c=this._graphic.symbol;c.text=this._editBox.value;this._graphic.setSymbol(c)}else this._graphic.getLayer().remove(this._graphic)}});t("extend-esri")&&q.setObject("toolbars.TextEditor",g,c);return g})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(e){q.mixin(this,e)}});e("extend-esri")&&q.setObject("tasks.ParameterValue",g,r);return g})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d,h,l,u,w,C,B,z,E){g=g(b,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=q.hitch(this,this._jobUpdateHandler);this._getJobStatus=q.hitch(this,this._getJobStatus);this._getResultDataHandler=
q.hitch(this,this._getResultDataHandler);this._getResultImageHandler=q.hitch(this,this._getResultImageHandler);this._executeHandler=q.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,d,b){for(var c in a){var h=a[c];q.isArray(h)?a[c]=t.toJson(e.map(h,function(a){return this._gpEncode({item:a},!0).item},this)):h instanceof Date&&(a[c]=h.getTime())}return this._encode(a,d,b)},_decode:function(a){var d=a.dataType,
b=new C(a);if(-1!==e.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],d))return b;if("GPLinearUnit"===d)b.value=new h(b.value);else if("GPFeatureRecordSetLayer"===d||"GPRecordSet"===d)b.value=new k(b.value);else if("GPDataFile"===d)b.value=new l(b.value);else if("GPDate"===d)a=b.value,q.isString(a)?b.value=new w({date:a}):b.value=new Date(a);else if("GPRasterData"===d||"GPRasterDataLayer"===d)a=a.value.mapImage,b.value=a?new E(a):new u(b.value);else if(-1!==d.indexOf("GPMultiValue:")){var c=d.split(":")[1];
a=b.value;b.value=e.map(a,function(a){return this._decode({paramName:"_name",dataType:c,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+b.dataType),b=null;return b},submitJob:function(a,d,b,c,h){var l=this._getOutSR(),k=h.assembly;a=this._gpEncode(q.mixin({},this._url.query,{f:"json","env:outSR":l?l.wkid||t.toJson(l.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||t.toJson(this.processSpatialReference.toJson()):
null},a),null,k&&k[0]);var e=this._jobUpdateHandler,u=this._errorHandler;return f({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,c){e(a,c,!1,d,b,h.dfd)},error:function(a){u(a,c,h.dfd)}})},_jobUpdateHandler:function(d,b,c,h,l,f){var k=d.jobId;b=new a(d);this._successHandler([b],"onStatusUpdate",l,c&&f);if(!c)switch(clearTimeout(this._updateTimers[k]),this._updateTimers[k]=null,f&&f.progress(b),d.jobStatus){case a.STATUS_SUBMITTED:case a.STATUS_EXECUTING:case a.STATUS_WAITING:case a.STATUS_NEW:var e=
this._getJobStatus;this._updateTimers[k]=setTimeout(function(){e(k,c,h,l,f)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",h,f)}},_getJobStatus:function(a,d,b,c,h){var l=this._jobUpdateHandler;f({url:this._url.path+"/jobs/"+a,content:q.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,f){l(a,f,d,b,c,h)},error:this._errorHandler})},_getResultDataHandler:function(a,d,b,c,h){try{var l=this._decode(a);this._successHandler([l],"onGetResultDataComplete",
b,h)}catch(f){this._errorHandler(f,c,h)}},getResultData:function(a,d,b,h){var l=this._getResultDataHandler,k=this._errorHandler,e=new r(c._dfdCanceller);e._pendingDfd=f({url:this._url.path+"/jobs/"+a+"/results/"+d,content:q.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,d){l(a,d,b,h,e)},error:function(a){k(a,h,e)}});return e},checkJobStatus:function(a,d,b){var h=this._jobUpdateHandler,l=this._errorHandler,k=new r(c._dfdCanceller);k._pendingDfd=
f({url:this._url.path+"/jobs/"+a,content:q.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,b){h(a,b,!0,null,d,k)},error:function(a){l(a,b,k)}});return k},cancelJob:function(a,d,b){var h=this._errorHandler,l=new r(c._dfdCanceller);l._pendingDfd=f({url:this._url.path+"/jobs/"+a+"/cancel",content:q.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:q.hitch(this,function(a,b){this._successHandler([a],"onJobCancel",d,l)}),error:function(a){h(a,b,l)}});
return l},execute:function(a,d,b,c){var h=this._getOutSR(),l=c.assembly;a=this._gpEncode(q.mixin({},this._url.query,{f:"json","env:outSR":h?h.wkid||t.toJson(h.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||t.toJson(this.processSpatialReference.toJson()):null},a),null,l&&l[0]);var k=this._executeHandler,e=this._errorHandler;return f({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,h){k(a,h,d,b,c.dfd)},error:function(a){e(a,
b,c.dfd)}})},_executeHandler:function(a,b,c,h,l){try{var f=a.results,k,e,u=a.messages;k=0;for(e=f.length;k<e;k++)f[k]=this._decode(f[k]);k=0;for(e=u.length;k<e;k++)u[k]=new d(u[k]);this._successHandler([f,u],"onExecuteComplete",c,l)}catch(n){this._errorHandler(n,h,l)}},_getResultImageHandler:function(a,d,b,c,h){try{var l=this._decode(a);this._successHandler([l],"onGetResultImageComplete",b,h)}catch(f){this._errorHandler(f,c,h)}},getResultImage:function(a,d,b,h,l){var k=this._getResultImageHandler,
e=this._errorHandler;b=this._gpEncode(q.mixin({},this._url.query,{f:"json"},b.toJson()));var u=new r(c._dfdCanceller);u._pendingDfd=f({url:this._url.path+"/jobs/"+a+"/results/"+d,content:b,callbackParamName:"callback",load:function(a,d){k(a,d,h,l,u)},error:function(a){e(a,l,u)}});return u},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,d,b,c){if(null==d){var h=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
h)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+d;this._url.query&&(a+="?"+v.objectToQuery(this._url.query));d=null==d?new z(a,{imageParameters:b}):new B(a,{imageParameters:b},!0);this.onGetResultImageLayerComplete(d);c&&c(d);return d},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});n._createWrappers(g);
s("extend-esri")&&q.setObject("tasks.Geoprocessor",g,m);return g})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(g,q,e,r,t,s,v,m,f,c,n,b){var k=g(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,d,b){this.graphic=a;this.map=d;this.toolbar=b;a=b._options;
this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;d=a.ghostLineSymbol;this._lineStroke={style:d.style,width:d.width,color:d.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),this._addControllers()):(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=
!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=e.connect(f,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=e.connect(f,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=
e.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=e.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new s({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new v({label:b.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=e.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){e.disconnect(this._firstMoveHandle);
e.disconnect(this._moveStopHandle);e.disconnect(this._mouseOverHandle);e.disconnect(this._mouseOutHandle);e.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=null},_add:function(a,d,b){var c,k,e=this.graphic,n=[];for(c=0;c<a.length;c++){var g=a[c],m=[];for(k=0;k<g.length;k++)m.push(new f(g[k],d,e,c,k,g.length,this,b));
n.push(m)}return n},_remove:function(a){a&&r.forEach(a,function(a){r.forEach(a,function(a){a.destroy()})})},_refresh:function(a){a&&r.forEach(a,function(a){r.forEach(a,function(a){a.refresh()})})},_isNew:function(a){return-1===r.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&
this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var d=this._findMover(a);d&&(this.toolbar.onVertexMouseOver(this.graphic,d._getInfo()),d._placeholder||(this._selectedMover=d,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",
this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var d,b=[];d=this._mpVertexMovers;r.forEach(this._vertexMovers,function(a){b=b.concat(a)});d&&r.forEach(d,function(a){b=b.concat(a)});for(d=0;d<b.length;d++){var c=b[d];if(c.graphic===a)return c}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},
_moveStopHandler:function(a,d){var b=this._isNew(a);!d||!d.dx&&!d.dy?!b&&this._canAdd&&this._showRelatedMidpoints(a):(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,b),this._canAdd&&(b?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES"))},_showRelatedMidpoints:function(a){var d=this._getAdjacentMidpoints(a.ptIndex,a.segLength),b=this._mpVertexMovers[a.segIndex];for(a=0;a<
d.length;a++){var c=b[d[a]];c.graphic.show();c.refresh()}},_hideRelatedMidpoints:function(a){var d=this._getAdjacentMidpoints(a.ptIndex,a.segLength),b=this._mpVertexMovers[a.segIndex];for(a=0;a<d.length;a++)b[d[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var d,b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),l=this._mpVertexMovers[a.segIndex];for(d=0;d<b.length;d++){var f=this._getAdjacentVertices(b[d],a.segLength),k=a.relatedGraphic.geometry.getPoint(a.segIndex,f[0]),f=a.relatedGraphic.geometry.getPoint(a.segIndex,
f[1]),k=new c({x:(k.x+f.x)/2,y:(k.y+f.y)/2,spatialReference:k.spatialReference.toJson()});l[b[d]].graphic.setGeometry(k)}},_addMidpoints:function(a){var d=a.segIndex,b=a.ptIndex,l=a.segLength,k=b+1,e,n=l+1;this._mpVertexMovers[d].splice(b,1);var g=this._vertexMovers[d];for(e=0;e<k;e++)g[e].segLength+=1;for(e=k;e<g.length;e++)g[e].ptIndex+=1,g[e].segLength+=1;a.ptIndex=k;a.segLength=g.length+1;g.splice(k,0,a);a.graphic.setSymbol(this._symbol1);g=this._mpVertexMovers[d];for(e=0;e<b;e++)g[e].segLength+=
1;for(e=b;e<l-1;e++)g[e].ptIndex+=1,g[e].segLength+=1;k=this._getAdjacentVertices(b,n);d=this._getAdjacentVertices(b+1,n);l=a.relatedGraphic.geometry.getPoint(a.segIndex,k[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,k[1]);k=new c({x:(l.x+e.x)/2,y:(l.y+e.y)/2,spatialReference:l.spatialReference.toJson()});l=a.relatedGraphic.geometry.getPoint(a.segIndex,d[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,d[1]);d=new c({x:(l.x+e.x)/2,y:(l.y+e.y)/2,spatialReference:l.spatialReference.toJson()});
l=new f(k,this._symbol2,this.graphic,a.segIndex,b,n,this,!0);a=new f(d,this._symbol2,this.graphic,a.segIndex,b+1,n,this,!0);g.splice(b,0,l,a)},_deleteVertex:function(a){var d,b=a.ptIndex,c=this._vertexMovers[a.segIndex];for(d=0;d<b;d++)c[d].segLength-=1;for(d=b+1;d<c.length;d++){var f=c[d];f.ptIndex-=1;f.segLength-=1}c.splice(b,1);d=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,d)}});q.mixin(k,{create:function(a,d,b){switch(a.geometry.type){case "multipoint":return new k.MultipointVertexEditor(a,
d,b);case "polyline":return new k.PolylineVertexEditor(a,d,b);case "polygon":return new k.PolygonVertexEditor(a,d,b)}}});k.MultipointVertexEditor=g(k,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=e.connect(f,"onMoveStart",this,this._moveStartHandler);e.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);e.disconnect(this._moveStartHandle)},_getSegments:function(a){var d=a.points,b=[],f=a.spatialReference;
for(a=0;a<d.length;a++){var k=d[a];b.push(new c({x:k[0],y:k[1],spatialReference:f.toJson()}))}return[b]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,d,b,c,f){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var d=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(d,a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var d=
a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(d,a._getInfo())},_findMover:function(a){var d=[].concat(this._vertexMovers[0]),b=a.target;for(a=0;a<d.length;a++){var c=d[a];if(c.graphic.getDojoShape().getNode()===b)return c}},_moveStartHandler:function(a){var d=a.ptIndex,b=a.segLength-1,c=a.relatedGraphic.geometry.points;a=c.splice(d,1);c.push(a[0]);c=this._vertexMovers[0];for(a=b;a>d;a--)c[a].ptIndex-=1;a=c.splice(d,1);c.push(a[0]);a[0].ptIndex=b},_moveStopHandler:function(a){this._updateRelatedGraphic(a,
a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,d,b,c,f,k,e,n){a=d.geometry;n?a.removePoint(f):a.setPoint(f,b);d.setGeometry(a)},_deleteMidpoints:function(a){}});k.PolylineVertexEditor=g(k,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,_getSegments:function(a){var d,b,c=a.paths,f=[];for(d=0;d<c.length;d++){var k=c[d],e=[];for(b=0;b<k.length;b++)e.push(a.getPoint(d,b));f.push(e)}return f},
_getMidpointSegments:function(a){var b,h,f=a.paths,k=[],e=a.spatialReference;for(b=0;b<f.length;b++){var n=f[b],g=[];for(h=0;h<n.length-1;h++){var m=a.getPoint(b,h),s=a.getPoint(b,h+1),m=new c({x:(m.x+s.x)/2,y:(m.y+s.y)/2,spatialReference:e.toJson()});g.push(m)}k.push(g)}return k},_getControlPoints:function(a,b,c,f,k){var e=this.map,n,g;this._isNew(a)?(a=f,f+=1,0<=a&&(n=e.toScreen(b.getPoint(c,a))),f<=k&&(g=e.toScreen(b.getPoint(c,f)))):(a=f-1,f+=1,0<=a&&(n=e.toScreen(b.getPoint(c,a))),f<k&&(g=e.toScreen(b.getPoint(c,
f))));return[n,g]},_getAdjacentMidpoints:function(a,b){var c=[],f=a-1;0<=f&&c.push(f);a<b-1&&c.push(a);return c},_getAdjacentVertices:function(a,b){return[a,a+1]},_deleteMidpoints:function(a){var b=this._mpVertexMovers[a.segIndex],h=b.length-1,l=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),k,e=l[0];for(k=0;k<e;k++)b[k].segLength-=1;for(k=e+1;k<b.length;k++){var n=b[k];n.ptIndex-=1;n.segLength-=1}if(1===l.length)b.splice(e,1)[0].destroy();else{n=this._getAdjacentVertices(e,h);k=a.relatedGraphic.geometry.getPoint(a.segIndex,
n[0]);n=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);k=new c({x:(k.x+n.x)/2,y:(k.y+n.y)/2,spatialReference:k.spatialReference.toJson()});a=new f(k,this._symbol2,this.graphic,a.segIndex,e,h,this,!0);b=b.splice(e,l.length,a);for(k=0;k<b.length;k++)b[k].destroy()}},_updateRelatedGraphic:function(a,b,c,f,k,e,g,m){a=b.geometry;g?a.insertPoint(f,k+1,n.fromJson(c.toJson())):m?a.removePoint(f,k):a.setPoint(f,k,n.fromJson(c.toJson()));b.setGeometry(a)}});k.PolygonVertexEditor=g(k,{declaredClass:"esri.toolbars._PolygonVertexEditor",
minLength:3,_getSegments:function(a){var b,c,f=a.rings,k=[];for(b=0;b<f.length;b++){var e=f[b],n=[];for(c=0;c<e.length-1;c++)n.push(a.getPoint(b,c));k.push(n)}return k},_getMidpointSegments:function(a){var b,h,f=a.rings,k=[],e=a.spatialReference;for(b=0;b<f.length;b++){var n=f[b],g=[];for(h=0;h<n.length-1;h++){var m=a.getPoint(b,h),s=a.getPoint(b,h+1),m=new c({x:(m.x+s.x)/2,y:(m.y+s.y)/2,spatialReference:e.toJson()});g.push(m)}k.push(g)}return k},_getControlPoints:function(a,b,c,f,k){var e=this.map;
this._isNew(a)?a=f:(a=f-1,a=0>a?(k+a)%k:a);f=(f+1)%k;k=e.toScreen(b.getPoint(c,a));b=e.toScreen(b.getPoint(c,f));return[k,b]},_getAdjacentMidpoints:function(a,b){var c=a-1;return[0>c?(b+c)%b:c,a]},_getAdjacentVertices:function(a,b){return[a,(a+1)%b]},_deleteMidpoints:function(a){var b=a.ptIndex,h=this._mpVertexMovers[a.segIndex],k=h.length-1,e=this._getAdjacentMidpoints(b,a.segLength).sort(),n,g;g=e[0];var m=e[e.length-1];if(0===b){n=this._getAdjacentVertices(k-1,k);b=a.relatedGraphic.geometry.getPoint(a.segIndex,
n[0]);n=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);b=new c({x:(b.x+n.x)/2,y:(b.y+n.y)/2,spatialReference:b.spatialReference.toJson()});a=new f(b,this._symbol2,this.graphic,a.segIndex,k-1,k,this,!0);h.splice(m,1,a)[0].destroy();h.splice(g,1)[0].destroy();for(e=0;e<h.length-1;e++)g=h[e],g.ptIndex-=1,g.segLength-=1}else{n=this._getAdjacentVertices(g,k);b=a.relatedGraphic.geometry.getPoint(a.segIndex,n[0]);n=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);b=new c({x:(b.x+n.x)/2,y:(b.y+n.y)/
2,spatialReference:b.spatialReference.toJson()});a=new f(b,this._symbol2,this.graphic,a.segIndex,g,k,this,!0);m=h.splice(g,e.length,a);for(e=0;e<m.length;e++)m[e].destroy();for(e=0;e<g;e++)h[e].segLength-=1;for(e=g+1;e<h.length;e++)g=h[e],g.ptIndex-=1,g.segLength-=1}},_updateRelatedGraphic:function(a,b,c,f,k,e,g,m){a=b.geometry;g?a.insertPoint(f,k+1,n.fromJson(c.toJson())):m?(a.removePoint(f,k),0===k&&a.setPoint(f,e-1,n.fromJson(a.getPoint(f,0).toJson()))):(a.setPoint(f,k,n.fromJson(c.toJson())),
0===k&&a.setPoint(f,e,n.fromJson(c.toJson())));b.setGeometry(a)}});t("extend-esri")&&(q.setObject("toolbars._GraphicVertexEditor",k,m),q.setObject("toolbars._MultipointVertexEditor",k.MultipointVertexEditor,m),q.setObject("toolbars._PolylineVertexEditor",k.PolylineVertexEditor,m),q.setObject("toolbars._PolygonVertexEditor",k.PolygonVertexEditor,m));return k})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.LinearUnit",
constructor:function(e){e&&q.mixin(this,e)},distance:0,units:null,toJson:function(){var e={};this.distance&&(e.distance=this.distance);this.units&&(e.units=this.units);return e}});e("extend-esri")&&q.setObject("tasks.LinearUnit",g,r);return g})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage".split(" "),function(g,q,e,r,t,s,v,m,f,c,n){g=g(f,{declaredClass:"esri.tasks.RouteTask",
_eventMap:{"solve-complete":["result"]},constructor:function(b){this._url.path+="/solve";this._handler=q.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(b,f,a,d,h){try{var l=[],g=[],m=b.routes?b.routes.features:[],v=b.stops?b.stops.features:[],r=b.barriers?b.barriers.features:[],q=b.polygonBarriers?b.polygonBarriers.features:[],t=b.polylineBarriers?
b.polylineBarriers.features:[],y=b.messages,F=e.forEach,H=e.indexOf,D=!0,A,G,x=b.routes&&b.routes.spatialReference||b.stops&&b.stops.spatialReference||b.barriers&&b.barriers.spatialReference||b.polygonBarriers&&b.polygonBarriers.spatialReference||b.polylineBarriers&&b.polylineBarriers.spatialReference;F(b.directions||[],function(a){l.push(A=a.routeName);g[A]={directions:a}});F(m,function(a){if(-1===H(l,A=a.attributes.Name))l.push(A),g[A]={};g[A].route=a});F(v,function(a){G=a.attributes;if(-1===H(l,
A=G.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME"))l.push(A),g[A]={};"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==A&&(D=!1);void 0===g[A].stops&&(g[A].stops=[]);g[A].stops.push(a)});0<v.length&&!0===D&&(g[l[0]].stops=g["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete g["esri.tasks.RouteTask.NULL_ROUTE_NAME"],l.splice(e.indexOf(l,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var J=[];F(l,function(a,b){g[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;g[a].spatialReference=x;J.push(new c(g[a]))});
b=function(a){F(a,function(b,d){b.geometry&&(b.geometry.spatialReference=x);a[d]=new s(b)});return a};F(y,function(a,b){y[b]=new n(a)});var M={routeResults:J,barriers:b(r),polygonBarriers:b(q),polylineBarriers:b(t),messages:y};this._successHandler([M],"onSolveComplete",a,h)}catch(I){this._errorHandler(I,d,h)}},solve:function(b,c,a,d){var h=b.stops;if(h&&"esri.tasks.FeatureSet"===h.declaredClass){var f=[],n=!1,g;e.forEach(h.features,function(a){g=a.attributes;if((!g||!g.RouteName)&&!n)n=!0;else if(-1===
e.indexOf(f,g?g.RouteName:""))f.push(g?g.RouteName:"")});if(1<f.length&&n)throw n=Error("'RouteName' not specified for at least 1 stop in stops FeatureSet."),this.onError(n),a&&a(n),n;}h=d.assembly;b=this._encode(q.mixin({},this._url.query,{f:"json"},b.toJson(h&&h[0])));var m=this._handler,s=this._errorHandler;return v({url:this._url.path,content:b,callbackParamName:"callback",load:function(b,f){m(b,f,c,a,d.dfd)},error:function(b){s(b,a,d.dfd)}})},onSolveComplete:function(){}});m._createWrappers(g);
r("extend-esri")&&q.setObject("tasks.RouteTask",g,t);return g})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(g,q,e,r,t,s,v,m){return q("dijit._KeyNavMixin",m,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);e.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var f=this._keyNavCodes={};f[r.HOME]=t.hitch(this,"focusFirstChild");
f[r.END]=t.hitch(this,"focusLastChild");f[this.isLeftToRight()?r.LEFT_ARROW:r.RIGHT_ARROW]=t.hitch(this,"_onLeftArrow");f[this.isLeftToRight()?r.RIGHT_ARROW:r.LEFT_ARROW]=t.hitch(this,"_onRightArrow");f[r.UP_ARROW]=t.hitch(this,"_onUpArrow");f[r.DOWN_ARROW]=t.hitch(this,"_onDownArrow")}var c=this,f="string"==typeof this.childSelector?this.childSelector:t.hitch(this,"childSelector");this.own(s(this.domNode,"keypress",t.hitch(this,"_onContainerKeypress")),s(this.domNode,"keydown",t.hitch(this,"_onContainerKeydown")),
s(this.domNode,"focus",t.hitch(this,"_onContainerFocus")),s(this.containerNode,s.selector(f,"focusin"),function(f){c._onChildFocus(v.getEnclosingWidget(this),f)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(f,c){f&&(this.focusedChild&&f!==this.focusedChild&&this._onChildBlur(this.focusedChild),f.set("tabIndex",this.tabIndex),f.focus(c?"end":"start"))},_onContainerFocus:function(f){f.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){e.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(f){e.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(f){f&&f!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),f.set("tabIndex",this.tabIndex),this.lastFocused=f,this._set("focusedChild",f))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(f,c,e,b){f&&this.focusChild(f)},_keyboardSearchCompare:function(f,c){var e=f.domNode,e=(f.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,c.length).toLowerCase();return c.length&&e==c?-1:0},_isFormElement:function(f){return"INPUT"===f.tagName||"TEXTAREA"===f.tagName||"SELECT"===f.tagName||"BUTTON"===f.tagName},_onContainerKeydown:function(f){if(!this._isFormElement(document.activeElement)){var c=this._keyNavCodes[f.keyCode];c?(c(f,this.focusedChild),f.stopPropagation(),f.preventDefault(),this._searchString=""):f.keyCode==r.SPACE&&(this._searchTimer&&
!f.ctrlKey&&!f.altKey&&!f.metaKey)&&(f.stopImmediatePropagation(),f.preventDefault(),this._keyboardSearch(f," "))}},_onContainerKeypress:function(f){if(!this._isFormElement(document.activeElement)&&!(f.charCode<=r.SPACE||f.ctrlKey||f.altKey||f.metaKey))f.preventDefault(),f.stopPropagation(),this._keyboardSearch(f,String.fromCharCode(f.charCode).toLowerCase())},_keyboardSearch:function(f,c){var e=null,b,k=0;t.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=c;
var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;b=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var d=this.focusedChild||null;if(1==a||!d)if(d=this._getNextFocusableChild(d,1),!d)return;a=d;do{var f=this._keyboardSearchCompare(d,b);f&&0==k++&&(e=d);if(-1==f){k=-1;break}d=this._getNextFocusableChild(d,1)}while(d!=a)})();this.onKeyboardSearch(e,f,b,k)},_onChildBlur:function(){},
_getNextFocusableChild:function(f,c){var e=f;do{if(f)f=this._getNext(f,c);else if(f=this[0<c?"_getFirst":"_getLast"](),!f)break;if(null!=f&&f!=e&&f.isFocusable())return f}while(f!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(f,c){if(f)for(f=f.domNode;f;)if((f=f[0>c?"previousSibling":"nextSibling"])&&"getAttribute"in f){var e=v.byNode(f);if(e)return e}return null}})})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dijit/a11yclick dijit/_TemplatedMixin dijit/focus ../kernel ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d,h,l,u,w,C,B,z,E,y,F,H,D,A,G){q=q("esri.dijit.Geocoder",[E,l],{templateString:a,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(a,b){this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",
GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",
clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",
activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new z(g.toUrl(".")+"/images/sdk_gps_location.png",28,28),graphicsLayer:null};var d=e.mixin({},this.options,a);this.set("autoComplete",d.autoComplete);this.set("arcgisGeocoder",d.arcgisGeocoder);this.set("value",d.value);this.set("theme",d.theme);this.set("activeGeocoderIndex",d.activeGeocoderIndex);
this.set("maxLocations",d.maxLocations);this.set("minCharacters",d.minCharacters);this.set("searchDelay",d.searchDelay);this.set("geocoderMenu",d.geocoderMenu);this.set("autoNavigate",d.autoNavigate);this.set("showResults",d.showResults);this.set("map",d.map);this.set("activeGeocoder",d.activeGeocoder);this.set("geocoders",d.geocoders);this.set("zoomScale",d.zoomScale);this.set("highlightLocation",d.highlightLocation);this.set("symbol",d.symbol);this.set("graphicsLayer",d.graphicsLayer);this.set("results",
[]);this._i18n=k;this._deferreds=[];this._defaultSR=new C(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);this.domNode=b},startup:function(){if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();
else n.once(this.get("map"),"load",e.hitch(this,function(){this._init()}));else this._init();else console.log("Geocoder:: domNode is undefined."),this.destroy();else console.log("Geocoder:: No geocoders defined."),this.destroy()},postCreate:function(){this.inherited(arguments);this.own(n(this.submitNode,h,e.hitch(this,this._findThenSelect)));this.own(n(this.geocoderMenuArrowNode,h,e.hitch(this,this._toggleGeolocatorMenu)));this.own(n(this.inputNode,h,e.hitch(this,this._inputClick)));this.own(n(this.clearNode,
h,e.hitch(this,this.clear)));this.own(n(this.geocoderMenuCloseNode,h,e.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();f.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var a=this.get("highlightGraphic"),b=this.get("graphicsLayer");a&&(b?b.remove(a):this.get("map").graphics.remove(a),this.set("highlightGraphic",null));s.set(this.inputNode,
"value","");this.set("value","");this.set("results",[]);v.remove(this.containerNode,this._css.hasValueClass);s.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){m.set(this.domNode,"display","block")},hide:function(){m.set(this.domNode,"display","none")},find:function(a){var b=new r;if(a)if("string"===typeof a)this._findQuery(a).then(function(a){b.resolve(a)});else if("object"===typeof a&&a.hasOwnProperty("geometry")){var d;switch(a.geometry.type){case "extent":d=
a.geometry.getCenter();break;case "multipoint":d=a.geometry.getExtent().getCenter();break;case "point":d=a.geometry;break;case "polygon":d=a.geometry.getExtent().getCenter();break;case "polyline":d=a.geometry.getExtent().getCenter()}d&&this._reverseGeocodePoint(d,a.geometry).then(function(d){d.results[0]&&(a.hasOwnProperty("attributes")&&d.results[0].feature.setAttributes(e.mixin(d.results[0].feature.attributes,a.attributes)),a.hasOwnProperty("infoTemplate")&&d.results[0].feature.setInfoTemplate(a.infoTemplate),
a.hasOwnProperty("symbol")&&d.results[0].feature.setSymbol(a.symbol));b.resolve(d)},function(a){b.reject(a)})}else"object"===typeof a&&"point"===a.type?this._reverseGeocodePoint(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}):a instanceof Array&&2===a.length?(d=new y(a,new C({wkid:4326})),this._reverseGeocodePoint(d).then(function(a){b.resolve(a)},function(a){b.reject(a)})):b.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(a){b.resolve(a)});
return b.promise},focus:function(){u.focus(this.inputNode)},blur:function(){u.curNode&&u.curNode.blur();this.inputNode.blur();this._hideMenus();var a=this.get("map");a&&a.enableKeyboardNavigation()},select:function(a){this.onSelect(a);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&(a&&a.hasOwnProperty("extent")&&this.get("map"))&&this.get("map").setExtent(a.extent);if(a.feature){var b=this.get("highlightGraphic"),d=this.get("graphicsLayer"),c=this.get("symbol")||a.feature.symbol;
b?(b.setGeometry(a.feature.geometry),b.setAttributes(a.feature.attributes),b.setInfoTemplate(a.feature.infoTemplate),b.setSymbol(c)):(b=a.feature,this.get("highlightLocation")&&(b.setSymbol(c),d?d.add(b):this.get("map").graphics.add(b)));this.set("highlightGraphic",b)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_autoComplete:function(){var a=this.get("activeGeocoder"),
b=this.reHostedFS.test(a.url);("query"!==a.type||b)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(e.hitch(this,function(a){this.onAutoComplete(a);this.get("showResults")&&this._showResults(a)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},_findQuery:function(a){var b=new r;this._query({delay:0,search:a}).then(e.hitch(this,function(a){this.onFindResults(a);
b.resolve(a)}),e.hitch(this,function(a){this.onFindResults(a);b.reject(a)}));return b.promise},_reverseGeocodePoint:function(a,b){var d=new r;if(a&&this.get("activeGeocoder")){var c=b||a,f=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);this._task.locationToAddress(a,f,e.hitch(this,function(a){a={results:[this._hydrateResult(a)],geometry:c};this.onFindResults(a);d.resolve(a)}),
e.hitch(this,function(a){d.reject(a)}))}else d.reject("Geocoder:: no point or active geocoder defined");return d.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||
(this._arcgisGeocoder.url=("file:"===location.protocol?"http:":location.protocol)+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=k.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",
this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new A(this.get("activeGeocoder").url):new H(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var a=[];this.get("arcgisGeocoder")&&(a=a.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(a=a.concat(this.get("geocoders")));this._geocoders=a},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();
this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);s.set(this.inputNode,"placeholder",this._placeholder);s.set(this.submitNode,"title",this._placeholder)},_updateValue:function(a,b,d){this._ignoreUpdateValue||(s.set(this.inputNode,"value",d),this._checkStatus())},_updateTheme:function(a,b,d){v.remove(this.domNode,
b);v.add(this.domNode,d)},_setActiveGeocoderIndex:function(a,b,d){this.set("activeGeocoderIndex",d);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();a={attr:this.get("activeGeocoder"),oldVal:b,newVal:d};this.onGeocoderSelect(a)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(a){a||(a={delay:0});a.search||(a.search=this.get("value"));var b=new r;this._deferreds.push(b);a.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(e.hitch(this,
function(){this._performTask(b,a)}),a.delay)):this._performTask(b,a);return b.promise},_performTask:function(a,b){if(b.search){this._hideGeolocatorMenu();this._showLoading();var d="";this.get("activeGeocoder").prefix&&(d+=this.get("activeGeocoder").prefix);d+=b.search;this.get("activeGeocoder").suffix&&(d+=this.get("activeGeocoder").suffix);var c=this.get("activeGeocoder").outFields;c&&(c instanceof Array||(c=[c]));var f=this.get("maxLocations")||6,h=this.get("activeGeocoder").searchExtent,k=this._defaultSR;
this.get("map")&&(k=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var l=new D;l.outSpatialReference=k;l.returnGeometry=!0;l.num=f;h&&(l.geometry=h);f=this.get("activeGeocoder").exactMatch;h=this.get("activeGeocoder").field;k="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(d)&&(k="N");l.where=f?h+" \x3d "+k+"'"+d+"'":"UPPER("+h+") LIKE "+k+"'%"+d.toUpperCase()+"%'";c&&(l.outFields=c);this._task.execute(l,e.hitch(this,function(d){this._receivedResults(d.features,
a,b)}),e.hitch(this,function(d){this._receivedResults([],a,b)}))}else{l={};this.get("activeGeocoder").categories&&(l.categories=this.get("activeGeocoder").categories);this._task.outSpatialReference=k;if(this.get("map")&&(this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale"))&&(k=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||
k&&k<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale)))l.location=this.get("map").extent.getCenter(),l.distance=this.get("activeGeocoder").localSearchOptions.distance;this.get("activeGeocoder").suggest&&b.autoComplete?(l.text=d,h&&(l.searchExtent=h),this._task.suggestLocations(l).then(e.hitch(this,function(d){this._receivedResults(d,a,b)}),e.hitch(this,function(d){this._receivedResults(d,a,b)}))):(l.address={},l.maxLocations=f,h&&(l.searchExtent=h),this.get("activeGeocoder").sourceCountry&&
(l.countryCode=this.get("activeGeocoder").sourceCountry),b.magicKey&&(l.magicKey=b.magicKey),this.get("activeGeocoder").singleLineFieldName?l.address[this.get("activeGeocoder").singleLineFieldName]=d:l.address["Single Line Input"]=d,c&&(l.outFields=c),this._task.addressToLocations(l,e.hitch(this,function(d){this._receivedResults(d,a,b)}),e.hitch(this,function(d){this._receivedResults(d,a,b)})))}}else this._hideLoading(),a.reject("Geocoder:: no search to perform");(d=this.get("map"))&&d.enableKeyboardNavigation()},
_showResults:function(){this._hideGeolocatorMenu();var a="";if(this.get("results")&&this.get("results").length&&this.resultsNode){for(var b=this.get("value"),d=RegExp("("+b+")","gi"),a=a+'\x3cul role\x3d"presentation"\x3e',b=0;b<this.get("results").length&&5>b;++b){var c=this.get("results")[b].text||this.get("results")[b].name,f=this._css.resultsItemClass+" ",f=0===b%2?f+this._css.resultsItemOddClass:f+this._css.resultsItemEvenClass;0===b?f+=" "+this._css.resultsItemFirstClass:b===this.get("results").length-
1&&(f+=" "+this._css.resultsItemLastClass);a+='\x3cli title\x3d"'+c+'" data-text\x3d"'+c+'" data-item\x3d"true" data-index\x3d"'+b+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+f+'"\x3e'+c.replace(d,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}a+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=a);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=a),this._hideResultsMenu()},_receivedResults:function(a,
b){this._hideLoading();var d=this._hydrateResults(a);this.set("results",d);d={results:d,value:this.get("value")};b.resolve(d)},_showLoading:function(){v.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){v.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){v.add(this.containerNode,this._css.activeMenuClass);v.add(this.domNode,this._css.GeocoderMenuOpenClass);m.set(this.geocoderMenuNode,"display","block");s.set(this.geocoderMenuInsertNode,"aria-hidden",
"false");s.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){v.remove(this.containerNode,this._css.activeMenuClass);v.remove(this.domNode,this._css.GeocoderMenuOpenClass);m.set(this.geocoderMenuNode,"display","none");s.set(this.geocoderMenuInsertNode,"aria-hidden","true");s.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===m.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():
this._showGeolocatorMenu()},_showResultsMenu:function(){v.add(this.containerNode,this._css.GeocoderActiveClass);v.add(this.domNode,this._css.GeocoderResultsOpenClass);m.set(this.resultsNode,"display","block");s.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){m.set(this.resultsNode,"display","none");v.remove(this.containerNode,this._css.GeocoderActiveClass);v.remove(this.domNode,this._css.GeocoderResultsOpenClass);s.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();
this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var a,b="",d;a='\x3cul role\x3d"presentation"\x3e';for(d=0;d<this._geocoders.length;d++){b=this._css.resultsItemClass+" ";b=0===d%2?b+this._css.resultsItemOddClass:b+this._css.resultsItemEvenClass;d===this.get("activeGeocoderIndex")&&(b+=" "+this._css.geocoderSelectedClass);0===d?b+=" "+this._css.resultsItemFirstClass:d===this._geocoders.length-1&&(b+=" "+this._css.resultsItemLastClass);
var c=this._geocoders[d].name||k.widgets.Geocoder.main.untitledGeocoder;a+='\x3cli data-index\x3d"'+d+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+b+'"\x3e';a+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';a+=c;a+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';a+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=a+"\x3c/ul\x3e";this._geocoderMenuEvent();m.set(this.geocoderMenuNode,"display","none");m.set(this.geocoderMenuArrowNode,
"display","block");v.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",m.set(this.geocoderMenuNode,"display","none"),m.set(this.geocoderMenuArrowNode,"display","none"),v.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(v.add(this.containerNode,this._css.hasValueClass),s.set(this.clearNode,"title",k.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var a=b('[data-item\x3d"true"]',
this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=n(a,"click, keydown",e.hitch(this,function(b){this._clearQueryTimeout();var d=parseInt(s.get(b.currentTarget,"data-index"),10),f=s.get(b.currentTarget,"data-text");"click"===b.type||"keydown"===b.type&&b.keyCode===c.ENTER?(s.set(this.inputNode,"value",f),this.set("value",f),this.get("results")&&this.get("results")[d]&&(b=this.get("results")[d],b.name?this.select(b):this._query({delay:0,search:b.text,magicKey:b.magicKey||null}).then(e.hitch(this,
function(a){this.select(a.results[0])})))):"keydown"===b.type&&(b.keyCode===c.BACKSPACE||b.keyCode===c.DELETE)?(t.stop(b),this.inputNode.focus(),b=this.inputNode.value.slice(0,-1),s.set(this.inputNode,"value",b),this.set("value",b)):"keydown"===b.type&&b.keyCode===c.UP_ARROW?(t.stop(b),b=d-1,0>b?this.inputNode.focus():a[b].focus()):"keydown"===b.type&&b.keyCode===c.DOWN_ARROW?(t.stop(b),b=d+1,b>=a.length?this.inputNode.focus():a[b].focus()):b.keyCode===c.ESCAPE&&this._hideMenus()}))},_geocoderMenuEvent:function(){var a=
b('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=n(a,"click, keydown",e.hitch(this,function(b){var d=parseInt(s.get(b.currentTarget,"data-index"),10);"click"===b.type||"keydown"===b.type&&b.keyCode===c.ENTER?(this._setActiveGeocoderIndex(null,null,d),this._hideGeolocatorMenu()):"keydown"===b.type&&b.keyCode===c.UP_ARROW?(t.stop(b),b=d-1,0>b?this.geocoderMenuArrowNode.focus():a[b].focus()):"keydown"===b.type&&b.keyCode===c.DOWN_ARROW?(t.stop(b),
b=d+1,b>=a.length?this.geocoderMenuArrowNode.focus():a[b].focus()):b.keyCode===c.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var a;if(this._events&&this._events.length)for(a=0;a<this._events.length;a++)this._events[a].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var a=n(document,"click",e.hitch(this,function(a){this._hideResultsMenu(a)}));this._events.push(a);a=n(this.inputNode,
"keyup",e.hitch(this,function(a){this._inputKeyUp(a)}));this._events.push(a);a=n(this.inputNode,"keydown",e.hitch(this,function(a){this._inputKeyDown(a)}));this._events.push(a);a=n(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(a);this.get("map")&&(a=n(this.get("map"),"click",e.hitch(this,function(){this.blur()})),this._events.push(a));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(e.hitch(this,function(a){a.results&&
a.results.length&&(this.select(a.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(a){if(a){this._clearQueryTimeout();var b=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",b);this._ignoreUpdateValue=!1;var d=0;b&&(d=b.length);if(a.ctrlKey||a.shiftKey||a.metaKey||a.altKey||a.keyCode===c.copyKey||a.keyCode===c.ALT||a.keyCode===c.CTRL||a.keyCode===c.META||a.keyCode===c.SHIFT||a.keyCode===c.UP_ARROW||a.keyCode===c.DOWN_ARROW||a.keyCode===c.LEFT_ARROW||a.keyCode===c.RIGHT_ARROW)return a;
a&&a.keyCode===c.ENTER?(this._cancelDeferreds(),this._findThenSelect()):a&&a.keyCode===c.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===c.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&d>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var a=0;a<this._deferreds.length;a++)this._deferreds[a].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(a){var d=
b('[data-item\x3d"true"]',this.resultsNode);a&&a.keyCode===c.TAB?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===c.UP_ARROW?(t.stop(a),(a=d.length)&&d[a-1].focus()):a&&a.keyCode===c.DOWN_ARROW&&(t.stop(a),d[0]&&d[0].focus())},_geocoderMenuButtonKeyDown:function(a){var d=b('[data-item\x3d"true"]',this.geocoderMenuInsertNode);a&&a.keyCode===c.UP_ARROW?(t.stop(a),this._showGeolocatorMenu(),(a=d.length)&&d[a-1].focus()):a&&a.keyCode===c.DOWN_ARROW&&(t.stop(a),this._showGeolocatorMenu(),d[0]&&
d[0].focus())},_inputClick:function(){this._hideGeolocatorMenu();this.get("value")||(this.clear(),this._hideMenus());this._checkStatus();var a=this.get("map");a&&a.disableKeyboardNavigation()},_hydrateResult:function(a){var b={},d=this._defaultSR,c;this.get("map")&&(d=this.get("map").spatialReference);if(a.hasOwnProperty("text")&&a.hasOwnProperty("magicKey"))return a;if(a.hasOwnProperty("feature"))b.feature=new B(a.feature),(c=b.feature.geometry)&&c.setSpatialReference(d);else if(a.hasOwnProperty("geometry")){var f=
a.symbol||null;c=a.attributes||{};b.feature=new B(a.geometry,f,c,a.infoTemplate||null);(c=b.feature.geometry)&&c.setSpatialReference(d)}else a.hasOwnProperty("location")?(f=new y(a.location.x,a.location.y,d),c={},a.hasOwnProperty("attributes")&&(c=a.attributes),a.hasOwnProperty("score")&&(c.score=a.score),b.feature=new B(f,null,c,null)):b.feature=null;if(a.hasOwnProperty("extent"))b.extent=new F(a.extent),b.extent.setSpatialReference(new C(d));else if(b.feature&&b.feature.geometry)switch(b.feature.geometry.type){case "extent":b.extent=
b.feature.geometry;break;case "multipoint":b.extent=b.feature.geometry.getExtent();break;case "polygon":b.extent=b.feature.geometry.getExtent();break;case "polyline":b.extent=b.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?b.extent=G.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(b.feature.geometry):b.extent=this.get("map").extent.centerAt(b.feature.geometry):b.extent=new F({xmin:b.feature.geometry.x-0.25,ymin:b.feature.geometry.y-
0.25,xmax:b.feature.geometry.x+0.25,ymax:b.feature.geometry.y+0.25,spatialReference:{wkid:4326}})}else b.extent=null;a.hasOwnProperty("name")?b.name=a.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&a.hasOwnProperty("attributes")&&a.attributes.hasOwnProperty(this.activeGeocoder.field)?b.name=a.attributes[this.activeGeocoder.field]:a.hasOwnProperty("Match_addr")&&"string"===typeof a.Match_addr?b.name=a.Match_addr:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Match_addr")?
b.name=a.address.Match_addr:a.hasOwnProperty("address")&&"string"===typeof a.address?b.name=a.address:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Address")?b.name=a.address.Address:b.name=b.feature&&b.feature.geometry?b.feature.geometry.x+","+b.feature.geometry.y:"";return b},_hydrateResults:function(a){var b=[],d=0;if(a&&a.length)for(d;d<a.length;d++){var c=this._hydrateResult(a[d]);b.push(c)}return b}});d("extend-esri")&&e.setObject("dijit.Geocoder",q,w);
return q})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(g,q,e,r,t){g=g(null,{declaredClass:"esri.tasks.Date",constructor:function(g){g&&(g.format&&(this.format=g.format),this.date=e.parse(g.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:e.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});r("extend-esri")&&
q.setObject("tasks.Date",g,t);return g})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(g,q,e,r,t,s,v,m,f,c,n,b){var k=q("dojo.dnd.Selector",b,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(f(this.node,c.press,r.hitch(this,
"onMouseDown")),f(this.node,c.release,r.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new m,b=n._empty,c;for(c in this.selection)c in b||a.push(t.byId(c));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(t.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=n._empty,b;for(b in this.selection)if(!(b in a)){var c=
t.byId(b);this.delItem(b);s.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||e.global;var c=this.selection,f=n._empty,k;for(k in c)k in f||a.call(b,this.getItem(k),k,this)},sync:function(){k.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=n._empty,c;for(c in this.selection)c in b||this.getItem(c)||a.push(c);g.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,
b,c,f){var e=this._normalizedCreator;this._normalizedCreator=function(b,d){var c=e.call(this,b,d);a?(this.anchor?this.anchor!=c.node&&(this._removeItemClass(c.node,"Anchor"),this._addItemClass(c.node,"Selected")):(this.anchor=c.node,this._removeItemClass(c.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[c.node.id]=1):(this._removeItemClass(c.node,"Selected"),this._removeItemClass(c.node,"Anchor"));return c};k.superclass.insertNodes.call(this,b,c,f);this._normalizedCreator=
e;return this},destroy:function(){k.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!n.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,v.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){n.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,f;c<b.length&&!(f=b[c],f==this.anchor||f==this.current);++c);for(++c;c<b.length;++c){f=b[c];if(f==this.anchor||f==this.current)break;this._addItemClass(f,"Selected");this.selection[f.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?n.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):n.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=f(this.node,c.move,r.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=n._empty,b;for(b in this.selection)if(!(b in a)){var c=t.byId(b);c&&this._removeItemClass(c,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return k})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],
function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(e){q.mixin(this,e)}});q.mixin(g,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});e("extend-esri")&&
q.setObject("tasks.GPMessage",g,r);return g})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(g,q,e,r,t){g=g([t],{declaredClass:"esri.toolbars._Toolbar",constructor:function(e){this.map=e},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(e,
g,m,f){var c=this.map;e&&(this._mapNavState={isDoubleClickZoom:c.isDoubleClickZoom,isClickRecenter:c.isClickRecenter,isPan:c.isPan,isRubberBandZoom:c.isRubberBandZoom,isKeyboardNavigation:c.isKeyboardNavigation,isScrollWheelZoom:c.isScrollWheelZoom},c.disableDoubleClickZoom(),c.disableClickRecenter(),c.disablePan(),c.disableRubberBandZoom(),c.disableKeyboardNavigation());g&&c.hideZoomSlider();m&&c.hidePanArrows();f&&c.graphics.disableMouseEvents()},_activateMapTools:function(e,g,m,f){var c=this.map,
n=this._mapNavState;e&&n&&(n.isDoubleClickZoom&&c.enableDoubleClickZoom(),n.isClickRecenter&&c.enableClickRecenter(),n.isPan&&c.enablePan(),n.isRubberBandZoom&&c.enableRubberBandZoom(),n.isKeyboardNavigation&&c.enableKeyboardNavigation(),n.isScrollWheelZoom&&c.enableScrollWheelZoom());g&&c.showZoomSlider();m&&c.showPanArrows();f&&c.graphics.enableMouseEvents()}});e("extend-esri")&&q.setObject("toolbars._Toolbar",g,r);return g})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k){var a=g(null,{declaredClass:"esri.toolbars._GraphicMover",constructor:function(a,b,c,f){this.graphic=a;this.map=b;this.toolbar=c;this.tempPt=f;this._enableGraphicMover();this._moved=!1},refresh:function(a){var b=this.graphic.getDojoShape();if(b&&(a||!b._hostGraphic))this._disableGraphicMover(),this._enableGraphicMover()},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var b=this.graphic,c=b.getDojoShape();
c&&(c._hostGraphic=b,this._moveable=new v(c,{mover:a.Mover}),this._moveStartHandle=e.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=e.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=e.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=e.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(b=c.getEventSource())&&s.set(b,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=
this._moveable;if(a){e.disconnect(this._moveStartHandle);e.disconnect(this._firstMoveHandle);e.disconnect(this._movingHandle);e.disconnect(this._moveStopHandle);var b=a.shape;b&&(b._hostGraphic=null,(b=b.getEventSource())&&s.set(b,"cursor",null));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,b=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&b.snappingManager&&b.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},
_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},_movingHandler:function(a){a=a.shape.getTransform();this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(a){var c=this.graphic,e=this.toolbar,g=this.map,m=e._geo?n.geographicToWebMercator(c.geometry):c.geometry,s=m.type,v=c.getDojoShape(),q=v.getTransform();if(r.toJson(q)!==r.toJson(this._startTx)){this._moved=!0;
switch(s){case "point":var s=[q,f.invert(this._startTx)],t;g.snappingManager&&(t=g.snappingManager._snappingPoint);m=t||g.toMap(f.multiplyPoint(s,g.toScreen(m,!0)));g.snappingManager&&g.snappingManager._killOffSnapping();break;case "polyline":m=this._updatePolyGeometry(m,m.paths,q);break;case "polygon":m=this._updatePolyGeometry(m,m.rings,q)}v.setTransform(null);c.setGeometry(e._geo?n.webMercatorToGeographic(m,!0):m);this.tempPt&&this.tempPt.setGeometry(new k(c.geometry.toJson()))}else this._moved=
!1;e._endOperation("MOVE");e.onGraphicMoveStop(c,q);this._moved||(a=a.__e,g=this.map.position,a=new b(a.pageX-g.x,a.pageY-g.y),e.onGraphicClick(c,{screenPoint:a,mapPoint:this.map.toMap(a)}))},_updatePolyGeometry:function(a,b,c){var f=this.map,e=a.getPoint(0,0),f=f.toMap(f.toScreen(e).offset(c.dx,c.dy));c=f.x-e.x;for(var e=f.y-e.y,k,g,n,f=0;f<b.length;f++){g=b[f];for(k=0;k<g.length;k++)n=a.getPoint(f,k),a.setPoint(f,k,n.offset(c,e))}return a}});a.Mover=g(m,{declaredClass:"esri.toolbars._Mover",constructor:function(a,
b,c){this.__e=b}});t("extend-esri")&&(q.setObject("toolbars._GraphicMover",a,c),q.setObject("toolbars._Mover",a.Mover,c));return a})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.DataFile",constructor:function(e){e&&q.mixin(this,e)},url:null,itemID:null,toJson:function(){var e={};this.url&&(e.url=this.url);this.itemID&&(e.itemID=this.itemID);return e}});e("extend-esri")&&q.setObject("tasks.DataFile",
g,r);return g})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(g,q,e,r,t,s,v,m,f,c){return q("dijit._KeyNavContainer",[f,c,m],{connectKeyNavHandlers:function(c,b){var f=this._keyNavCodes={},a=s.hitch(this,"focusPrev"),d=s.hitch(this,"focusNext");g.forEach(c,function(b){f[b]=a});g.forEach(b,function(a){f[a]=d});f[t.HOME]=s.hitch(this,
"focusFirstChild");f[t.END]=s.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){r.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);g.forEach(this.getChildren(),s.hitch(this,"_startupChild"))},addChild:function(c,b){this.inherited(arguments);this._startupChild(c)},_startupChild:function(c){c.set("tabIndex","-1")},_getFirst:function(){var c=this.getChildren();return c.length?c[0]:null},_getLast:function(){var c=this.getChildren();
return c.length?c[c.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(c){return(c=v.byNode(c))&&c.getParent()==this}})})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b,k,a,d,h,l,u,w,C,B){var z=q(k,{declaredClass:"esri.toolbars.Edit",constructor:function(a,b){this._map=a;this._tool=0;if(this._map.loaded)this._scratchGL=a.graphics;else var d=r.connect(this._map,"onLoad",this,function(){r.disconnect(d);d=null;this._scratchGL=this._map.graphics});var c=v("esri-touch")||v("esri-pointer");this._defaultOptions=e.mixin({vertexSymbol:new u(u.STYLE_CIRCLE,c?20:12,new w(w.STYLE_SOLID,new s([0,0,0,0.5]),1),new s([128,128,128])),ghostVertexSymbol:new u(u.STYLE_CIRCLE,
c?18:10,new w(w.STYLE_SOLID,new s([0,0,0,0.5]),1),new s([255,255,255,0.75])),ghostLineSymbol:new w(w.STYLE_DOT,new s([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:c?24:16,boxLineSymbol:new w(w.STYLE_DASH,new s([64,64,64]),1),boxHandleSymbol:new u(u.STYLE_SQUARE,c?16:9,new w(w.STYLE_SOLID,new s([0,0,0,0.5]),1),new s([255,255,255,0.75])),textAnchorSymbol:new u(u.STYLE_CIRCLE,10,null,new s([255,0,0]))},b||{})},activate:function(a,b,d){this.deactivate();this._graphic=
b;this._options=e.mixin(e.mixin({},this._defaultOptions),d||{});var c=z.MOVE;d=z.EDIT_VERTICES;var f=z.SCALE,h=z.ROTATE,k=z.EDIT_TEXT,l=!1,g=!1,n=!1,m=this._map,s=m.spatialReference,u=b.geometry.spatialReference;this._geo=!(!s||!u||s.equals(u)||!(s.isWebMercator()&&4326===u.wkid));this._isTextPoint=this._prepareTextSymbolEditing(b,a);(a&c)===c&&(l=this._enableMove(b));c=(a&f)===f;h=(a&h)===h;if(c||h)n=this._enableBoxEditing(b,c,h);(a&d)===d&&(g=this._enableVertexEditing(b));(a&k)===k&&this._enableTextEditing(b);
if(!l&&!g&&!n)throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=a)this._mapPanEndHandle=r.connect(m,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=r.connect(m,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,b);m.snappingManager&&(l||g)&&m.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,b=this._graphic;
if(a){var d=!!this._modified;this._clear();r.disconnect(this._mapPanEndHandle);r.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(a,b,{isModified:d});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(a,b){},onDeactivate:function(a,
b,d){},onGraphicMoveStart:function(a){},onGraphicFirstMove:function(a){this._modified=!0},onGraphicMove:function(a,b){},onGraphicMoveStop:function(a,b){},onGraphicClick:function(a,b){},onVertexMoveStart:function(a,b){},onVertexFirstMove:function(a,b){this._modified=!0},onVertexMove:function(a,b,d){},onVertexMoveStop:function(a,b,d){},onVertexAdd:function(a,b){this._modified=!0},onVertexClick:function(a,b){},onVertexMouseOver:function(a,b){},onVertexMouseOut:function(a,b){},onVertexDelete:function(a,
b){this._modified=!0},onTextEditStart:function(a,b){},onTextEditEnd:function(a){},onScaleStart:function(a){},onScaleFirstMove:function(a){this._modified=!0},onScale:function(a,b){},onScaleStop:function(a,b){},onRotateStart:function(a){},onRotateFirstMove:function(a){this._modified=!0},onRotate:function(a,b){},onRotateStop:function(a,b){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var d=a.symbol||a.getLayer()._getSymbol(a);if("textsymbol"===d.type){if((b&z.SCALE)===z.SCALE||(b&z.ROTATE)===z.ROTATE||(b&z.EDIT_TEXT)===z.EDIT_TEXT){a.setSymbol(new C(d.toJson()));var c=this;
if(this._textSymbolEditor)this._textSymbolEditor.createForm(a),this._textSymbolEditor.show();else if(this._options&&this._options.textSymbolEditor)this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){c._boxEditor&&c._boxEditor.refresh()});else{var e;e=this._options.textSymbolEditorHolder?m.create("div",null,this._options.textSymbolEditorHolder):m.create("div",null,this._map.root);g(["../dijit/SymbolEditor"],function(b){c._textSymbolEditor=new b({graphic:a},
e);b=c._textSymbolEditor.domNode.parentNode.id;f.set(c._textSymbolEditor.domNode,{position:"map_root"===b?"absolute":"relative",left:"map_root"===b?c._map.width/2-100+"px":"5px",top:"20px","z-index":50});c._textSymbolEditor.startup();c._textSymbolEditor.createForm(a);c._textSymbolEditor.show();c._textSymbolEditor.on("symbol-change",function(){c._boxEditor&&c._boxEditor.refresh()})})}}if((b&z.MOVE)===z.MOVE||(b&z.ROTATE)===z.ROTATE||(b&z.SCALE)===z.SCALE)this._textAnchor=new B(a.geometry,this._options.textAnchorSymbol),
this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(a){var b=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new d(a,b,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var b=this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=h.create(a,b,this),!0}return!1},_enableBoxEditing:function(b,d,c){var f=this._map,e=b.geometry.type;return"polyline"===
e||"polygon"===e||this._isTextPoint?(this._boxEditor=new a(b,f,this,d,c,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(a){return this._isTextPoint?(this._textEditor=new l(a,this._map,this),r.connect(this._textEditor,"onEditStart",e.hitch(this,function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),
this._graphicMover=null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&(this._textEditor.destroy(),this._textEditor=null)},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();
this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},_mapExtentChangeHandler:function(a,b,d){d&&this._refreshMoveables()},_refreshMoveables:function(a){var b=t.filter([this._graphicMover,this._vertexEditor,this._boxEditor],n.isDefined);t.forEach(b,function(b){b.refresh(a)})},_beginOperation:function(a){t.forEach(this._getAffectedTools(a),function(a){a.suspend()})},
_endOperation:function(a){t.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var b=[];switch(a){case "MOVE":b=[this._vertexEditor,this._boxEditor];break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return b=t.filter(b,n.isDefined)}});e.mixin(z,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});v("extend-esri")&&e.setObject("toolbars.Edit",z,c);return z})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),
function(g,q,e,r,t,s){return e("dojox.gfx.Mover",null,{constructor:function(e,m,f){this.shape=e;this.lastX=m.clientX;this.lastY=m.clientY;e=this.host=f;m=document;f=r(m,t.move,g.hitch(this,"onFirstMove"));this.events=[r(m,t.move,g.hitch(this,"onMouseMove")),r(m,t.release,g.hitch(this,"destroy")),r(m,"dragstart",g.hitch(s,"stop")),r(m,"selectstart",g.hitch(s,"stop")),f];if(e&&e.onMoveStart)e.onMoveStart(this)},onMouseMove:function(e){var g=e.clientX,f=e.clientY;this.host.onMove(this,{dx:g-this.lastX,
dy:f-this.lastY});this.lastX=g;this.lastY=f;s.stop(e)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){q.forEach(this.events,function(e){e.remove()});var e=this.host;if(e&&e.onMoveStop)e.onMoveStop(this);this.events=this.shape=null}})})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Extent ../geometry/Polyline ./FeatureSet".split(" "),function(g,q,e,r,t,s,v,m){g=
g(m,{declaredClass:"esri.tasks.DirectionsFeatureSet",constructor:function(f,c){this.routeId=f.routeId;this.routeName=f.routeName;q.mixin(this,f.summary);this.extent=new s(this.envelope);var g=this._fromCompressedGeometry,b=this.features,k=this.extent.spatialReference,a=[];e.forEach(c,function(d,c){b[c].setGeometry(a[c]=g(d,k))});this.strings=f.strings;this.mergedGeometry=this._mergePolylinesToSinglePath(a,k);this.geometryType="esriGeometryPolyline";delete this.envelope},_fromCompressedGeometry:function(f,
c){var e=0,b=0,k=[],a,d,h,l;h=f.match(/((\+|\-)[^\+\-]+)/g);l=parseInt(h[0],32);for(var g=1;g<h.length;g+=2)e=a=parseInt(h[g],32)+e,b=d=parseInt(h[g+1],32)+b,k.push([a/l,d/l]);e=new v({paths:[k]});e.setSpatialReference(c);return e},_mergePolylinesToSinglePath:function(f,c){var g=[];e.forEach(f,function(a){e.forEach(a.paths,function(a){g=g.concat(a)})});var b=[],k=[0,0];e.forEach(g,function(a){if(a[0]!==k[0]||a[1]!==k[1])b.push(a),k=a});return(new v({paths:[b]})).setSpatialReference(c)}});r("extend-esri")&&
q.setObject("tasks.DirectionsFeatureSet",g,t);return g})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(g,q,e,r,t){t=e("dojox.gfx.path.Path",t.Shape,{constructor:function(e){this.shape=q.clone(g.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=e;this.segmented=!1},setAbsoluteMode:function(e){this._confirmSegmented();this.absolute="string"==typeof e?"absolute"==e:e;return this},getAbsoluteMode:function(){this._confirmSegmented();
return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var e=this.bbox,g=this._getRealMatrix();this.bbox=null;for(var m=0,f=this.segments.length;m<f;++m)this._updateWithSegment(this.segments[m],g);g=this.bbox;this.bbox=e;return this.tbbox=g?[{x:g.l,y:g.t},{x:g.r,y:g.t},{x:g.r,
y:g.b},{x:g.l,y:g.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(e,g,m){m&&(g=r.multiplyPoint(m,e,g),e=g.x,g=g.y);this.bbox&&"l"in this.bbox?(this.bbox.l>e&&(this.bbox.l=e),this.bbox.r<e&&(this.bbox.r=e),this.bbox.t>g&&(this.bbox.t=g),this.bbox.b<g&&(this.bbox.b=g)):this.bbox={l:e,b:g,r:e,t:g}},_updateWithSegment:function(e,r){var m=e.args,f=m.length,
c;switch(e.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(c=0;c<f;c+=2)this._updateBBox(m[c],m[c+1],r);this.last.x=m[f-2];this.last.y=m[f-1];this.absolute=!0;break;case "H":for(c=0;c<f;++c)this._updateBBox(m[c],this.last.y,r);this.last.x=m[f-1];this.absolute=!0;break;case "V":for(c=0;c<f;++c)this._updateBBox(this.last.x,m[c],r);this.last.y=m[f-1];this.absolute=!0;break;case "m":c=0;"x"in this.last||(this._updateBBox(this.last.x=m[0],this.last.y=m[1],r),c=2);for(;c<f;c+=2)this._updateBBox(this.last.x+=
m[c],this.last.y+=m[c+1],r);this.absolute=!1;break;case "l":case "t":for(c=0;c<f;c+=2)this._updateBBox(this.last.x+=m[c],this.last.y+=m[c+1],r);this.absolute=!1;break;case "h":for(c=0;c<f;++c)this._updateBBox(this.last.x+=m[c],this.last.y,r);this.absolute=!1;break;case "v":for(c=0;c<f;++c)this._updateBBox(this.last.x,this.last.y+=m[c],r);this.absolute=!1;break;case "c":for(c=0;c<f;c+=6)this._updateBBox(this.last.x+m[c],this.last.y+m[c+1],r),this._updateBBox(this.last.x+m[c+2],this.last.y+m[c+3],r),
this._updateBBox(this.last.x+=m[c+4],this.last.y+=m[c+5],r);this.absolute=!1;break;case "s":case "q":for(c=0;c<f;c+=4)this._updateBBox(this.last.x+m[c],this.last.y+m[c+1],r),this._updateBBox(this.last.x+=m[c+2],this.last.y+=m[c+3],r);this.absolute=!1;break;case "A":for(c=0;c<f;c+=7)this._updateBBox(m[c+5],m[c+6],r);this.last.x=m[f-2];this.last.y=m[f-1];this.absolute=!0;break;case "a":for(c=0;c<f;c+=7)this._updateBBox(this.last.x+=m[c+5],this.last.y+=m[c+6],r);this.absolute=!1}var n=[e.action];for(c=
0;c<f;++c)n.push(g.formatNumber(m[c],!0));if("string"==typeof this.shape.path)this.shape.path+=n.join("");else{c=0;for(f=n.length;c<f;++c)this.shape.path.push(n[c])}},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(e,g){this.tbbox=null;var m=this._validSegments[e.toLowerCase()];"number"==typeof m&&(m?g.length>=m&&(m={action:e,args:g.slice(0,g.length-g.length%m)},this.segments.push(m),this._updateWithSegment(m)):(m={action:e,args:[]},this.segments.push(m),this._updateWithSegment(m)))},
_collectArgs:function(e,g){for(var m=0;m<g.length;++m){var f=g[m];"boolean"==typeof f?e.push(f?1:0):"number"==typeof f?e.push(f):f instanceof Array?this._collectArgs(e,f):"x"in f&&"y"in f&&e.push(f.x,f.y)}},moveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"M":"m",e);return this},lineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"L":"l",e);return this},hLineTo:function(){this._confirmSegmented();
var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"H":"h",e);return this},vLineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"V":"v",e);return this},curveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"C":"c",e);return this},smoothCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"S":
"s",e);return this},qCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"Q":"q",e);return this},qSmoothCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"T":"t",e);return this},arcTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"A":"a",e);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",
[]);return this},_confirmSegmented:function(){if(!this.segmented){var e=this.shape.path;this.shape.path=[];this._setPath(e);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(e){e=q.isArray(e)?e:e.match(g.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(e){for(var r="",m=[],f=e.length,c=0;c<f;++c){var n=e[c],b=parseFloat(n);isNaN(b)?(r&&this._pushSegment(r,m),m=[],r=n):m.push(b)}this._pushSegment(r,m)}},setShape:function(e){this.inherited(arguments,
["string"==typeof e?{path:e}:e]);this.segmented=!1;this.segments=[];g.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});e=e("dojox.gfx.path.TextPath",t,{constructor:function(e){"text"in this||(this.text=q.clone(g.defaultTextPath));"fontStyle"in this||(this.fontStyle=q.clone(g.defaultFont))},getText:function(){return this.text},setText:function(e){this.text=g.makeParameters(this.text,"string"==typeof e?{text:e}:e);this._setText();return this},getFont:function(){return this.fontStyle},
setFont:function(e){this.fontStyle="string"==typeof e?g.splitFontString(e):g.makeParameters(g.defaultFont,e);this._setFont();return this}});return g.path={Path:t,TextPath:e}})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(g,q,e){q.getObject("json",!0,e);e.json._slice=function(e,g,q,v){var m=e.length,f=[];q=q||m;g=0>g?Math.max(0,g+m):Math.min(m,g);for(q=0>q?Math.max(0,q+m):Math.min(m,q);g<q;g+=v)f.push(e[g]);return f};e.json._find=
function(e,g){function q(f){g&&(!0===g&&!(f instanceof Array)?v.push(f):f[g]&&v.push(f[g]));for(var c in f){var e=f[c];g?e&&"object"==typeof e&&q(e):v.push(e)}}var v=[];if(g instanceof Array){if(1==g.length)return e[g[0]];for(var m=0;m<g.length;m++)v.push(e[g[m]])}else q(e);return v};e.json._distinctFilter=function(e,g){for(var q=[],v={},m=0,f=e.length;m<f;++m){var c=e[m];g(c,m,e)&&("object"==typeof c&&c?c.__included||(c.__included=!0,q.push(c)):v[c+typeof c]||(v[c+typeof c]=!0,q.push(c)))}m=0;for(f=
q.length;m<f;++m)q[m]&&delete q[m].__included;return q};return e.json.query=function(e,g){function q(b){c=b+"("+c}function v(b,a,d,c,e,g,n,m){return f[m].match(/[\*\?]/)||"~"==n?"/^"+f[m].substring(1,f[m].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==n?"$/i":"$/")+".test("+a+")":b}var m=0,f=[];e=e.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(b){m+="["==b?1:"]"==b?-1:0;return"]"==b&&0<m?"`]":'"'==b.charAt(0)||"'"==b.charAt(0)?"`"+(f.push(b)-
1):b});var c="";e.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});e=e.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(b){return"."==b.charAt(0)?b:"@"==b?"$obj":(b.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+b}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(b,a,d){return(a=b.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(d="",b.match(/^\./)&&(q("dojox.json._find"),
d=",true)"),q(a[1].match(/\=/)?"dojo.map":a[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter"),d+",function($obj){return "+a[2]+"})"):(a=b.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+a[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(a,b,d){return"var av\x3d "+d.replace(/\$obj/,"a")+",bv\x3d "+d.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==b?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==b?-1:1)+";}\n"})+"return 0;})":(a=b.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?
(q("dojox.json._slice"),","+(a[1]||0)+","+(a[2]||0)+","+(a[3]||1)+")"):b.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(q("dojox.json._find"),("."==b.charAt(1)?",'"+d+"'":b.match(/,/)?","+b:"")+")"):b}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,v).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(b,a,d,c,e,f,g,n){return v(b,c,e,f,g,n,d,a)});e=c+("$"==e.charAt(0)?"":"$")+e.replace(/`([0-9]+|\])/g,function(b,a){return"]"==a?"]":
f[a]});for(var n=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+e+"}"),b=0;b<arguments.length-1;b++)arguments[b]=arguments[b+1];return g?n.apply(this,arguments):n}})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(e){q.mixin(this,e)}});q.mixin(g,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,
TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});e("extend-esri")&&q.setObject("tasks.NAMessage",g,r);return g})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/has dojo/sniff dojo/dom-style dojox/gfx/Moveable ../kernel ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(g,q,e,r,t,s,v,m,f,c,n){g=g(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(b,c,a,d,e,f,g,n){this.point=b;this.symbol=
c;this.relatedGraphic=a;this.segIndex=d;this.ptIndex=e;this.segLength=f;this.editor=g;this.map=g.map;this._scratchGL=g.toolbar._scratchGL;this._placeholder=n||!1;this._type=a.geometry.type;this._init();this._enable()},refresh:function(b){if(b||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=
this._scratchGL=null},_init:function(){var b=new f(this.point.toJson()),b=new c(b,this.symbol);switch(this._type){case "multipoint":b._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(b)}this.graphic=b},_enable:function(){var b=this.graphic.getDojoShape();b&&(b._hasMover=!0,this._moveable=this._getMoveable(b),(b=b.getEventSource())&&s.set(b,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var b=
this._moveable;if(b){e.disconnect(this._startHandle);e.disconnect(this._firstHandle);e.disconnect(this._movingHandle);e.disconnect(this._stopHandle);var c=b.shape;c&&(c=c.getEventSource())&&s.set(c,"cursor",null);b.destroy();this._moveable=null}},_needRefresh:function(){var b=this.graphic.getDojoShape(),c=!1;if(b)switch(this._type){case "multipoint":var a=this.relatedGraphic.getDojoShape();a&&(a=a.children[this.ptIndex],b!==a&&(this.graphic._shape=a,c=!0));break;case "polyline":case "polygon":c=!b._hasMover}return c},
_getMoveable:function(b){b=new v(b,t("mac")&&t("ff")&&!r("esri-touch")&&{leftButtonOnly:!0});this._startHandle=e.connect(b,"onMoveStart",this,this._moveStartHandler);this._firstHandle=e.connect(b,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=e.connect(b,"onMoving",this,this._movingHandler);this._stopHandle=e.connect(b,"onMoveStop",this,this._moveStopHandler);return b},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,
isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(b){var c=this.map;c.snappingManager&&c.snappingManager._setUpSnapping();b.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(b){var c=b.shape,a=this._getControlEdges(),d=this._scratchGL._div,e,f=[],g=b.host.shape._wrapOffsets[0]||0;for(e=0;e<a.length;e++){var n=a[e];n.x1+=g;n.x2+=g;
f.push([d.createLine({x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2}).setStroke(this.editor._lineStroke),n.x1,n.y1,n.x2,n.y2])}c._lines=f;b.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(b){var c=b.shape;b=c.getTransform();for(var a=c._lines,c=0;c<a.length;c++){var d=a[c];d[0].setShape({x1:d[1]+b.dx,y1:d[2]+b.dy,x2:d[3],y2:d[4]})}this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),b)},_moveStopHandler:function(b){b=
b.shape;var c=this.editor.toolbar,a=b.getTransform(),d=this.map,e=this.graphic,f=c._geo?n.geographicToWebMercator(e.geometry):e.geometry,g,m=b._lines;if(m){for(g=0;g<m.length;g++)m[g][0].removeShape();b._lines=null}g=!1;var m=!0,q=this._getInfo();a&&(a.dx||a.dy)?this._placeholder&&(this._placeholder=!1,g=!0):m=!1;var r;d.snappingManager&&(r=d.snappingManager._snappingPoint);r=r||d.toMap(d.toScreen(f).offset(a.dx,a.dy));d.snappingManager&&d.snappingManager._killOffSnapping();b.setTransform(null);e.setGeometry(c._geo?
n.webMercatorToGeographic(r,!0):r);this.constructor.onMoveStop(this,a);c.onVertexMoveStop(this.relatedGraphic,q,a);if(!m)c.onVertexClick(this.relatedGraphic,q);if(g)c.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var b=this.map,c=this.relatedGraphic.geometry,a=this.segIndex,d=this.ptIndex,e=this.segLength,f=this._scratchGL._div.getTransform(),g=f.dx,f=f.dy,n=b.toScreen(this.graphic.geometry),b=n.x-g,n=n.y-f,m=[],c=this.editor._getControlPoints(this,c,a,d,e);c[0]&&m.push({x1:b,
y1:n,x2:c[0].x-g,y2:c[0].y-f});c[1]&&m.push({x1:b,y1:n,x2:c[1].x-g,y2:c[1].y-f});return m}});r("extend-esri")&&q.setObject("toolbars.VertexMover",g,m);q.mixin(g,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return g})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(g,q,e,r,t,s,v,m){g=g(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,
attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,
restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,startTime:null,startTimeIsUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(f){var c={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&
e.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||e.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):
null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:m.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,
directionsStyleName:this.directionsStyleName,travelMode:this.travelMode},g=this.stops;"esri.tasks.FeatureSet"===g.declaredClass&&0<g.features.length?c.stops=e.toJson({type:"features",features:v._encodeGraphics(g.features,f&&f["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===g.declaredClass?c.stops=g:"esri.tasks.DataFile"===g.declaredClass&&(c.stops=e.toJson({type:"features",url:g.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":c.directionsOutputType="esriDOTComplete";break;case "complete-no-events":c.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":c.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":c.directionsOutputType="esriDOTStandard";break;case "summary-only":c.directionsOutputType="esriDOTSummaryOnly";break;default:c.directionsOutputType=this.directionsOutputType}g=function(b,
c){return!b?null:"esri.tasks.FeatureSet"===b.declaredClass?0<b.features.length?e.toJson({type:"features",features:v._encodeGraphics(b.features,f&&f[c])}):null:"esri.tasks.DataLayer"===b.declaredClass?b:"esri.tasks.DataFile"===b.declaredClass?e.toJson({type:"features",url:b.url}):e.toJson(b)};this.barriers&&(c.barriers=g(this.barriers,"barriers.features"));this.polygonBarriers&&(c.polygonBarriers=g(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(c.polylineBarriers=g(this.polylineBarriers,
"polylineBarriers.features"));return s.filter(c,function(b){if(null!==b)return!0})}});r("extend-esri")&&q.setObject("tasks.RouteParameters",g,t);return g})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(g,q,e){function r(e,c){return Math.abs(e-c)<=1E-6*(Math.abs(e)+Math.abs(c))}function t(e,c,g,b){if(isFinite(e)){if(!isFinite(g))return e}else return g;c=Math.abs(c);b=Math.abs(b);return(c*e+b*g)/(c+b)}function s(f){f=e.normalize(f);var c=-f.xx-f.yy,g=f.xx*
f.yy-f.xy*f.yx,b=Math.sqrt(c*c-4*g),c=-(c+(0>c?-b:b))/2,g=g/c,b=f.xy/(c-f.xx),k=1,a=f.xy/(g-f.xx),d=1;r(c,g)&&(b=1,a=k=0,d=1);isFinite(b)||(b=1,k=(c-f.xx)/f.xy,isFinite(k)||(b=(c-f.yy)/f.yx,k=1,isFinite(b)||(b=1,k=f.yx/(c-f.yy))));isFinite(a)||(a=1,d=(g-f.xx)/f.xy,isFinite(d)||(a=(g-f.yy)/f.yx,d=1,isFinite(a)||(a=1,d=f.yx/(g-f.yy))));f=Math.sqrt(b*b+k*k);var h=Math.sqrt(a*a+d*d);if(!isFinite(b/=f))b=0;if(!isFinite(k/=f))k=0;if(!isFinite(a/=h))a=0;if(!isFinite(d/=h))d=0;return{value1:c,value2:g,vector1:{x:b,
y:k},vector2:{x:a,y:d}}}function v(e,c){var g=0>e.xx*e.yy||0<e.xy*e.yx?-1:1,b=c.angle1=(Math.atan2(e.yx,e.yy)+Math.atan2(-g*e.xy,g*e.xx))/2,g=Math.cos(b),b=Math.sin(b);c.sx=t(e.xx/g,g,-e.xy/b,b);c.sy=t(e.yy/g,g,e.yx/b,b);return c}function m(e,c){var g=0>e.xx*e.yy||0<e.xy*e.yx?-1:1,b=c.angle2=(Math.atan2(g*e.yx,g*e.xx)+Math.atan2(-e.xy,e.yy))/2,g=Math.cos(b),b=Math.sin(b);c.sx=t(e.xx/g,g,e.yx/b,b);c.sy=t(e.yy/g,g,-e.xy/b,b);return c}return g.decompose=function(f){var c=e.normalize(f);f={dx:c.dx,dy:c.dy,
sx:1,sy:1,angle1:0,angle2:0};if(r(c.xy,0)&&r(c.yx,0))return q.mixin(f,{sx:c.xx,sy:c.yy});if(r(c.xx*c.yx,-c.xy*c.yy))return v(c,f);if(r(c.xx*c.xy,-c.yx*c.yy))return m(c,f);var g,b=new e.Matrix2D(c);g=q.mixin(b,{dx:0,dy:0,xy:b.yx,yx:b.xy});b=s([c,g]);g=s([g,c]);b=new e.Matrix2D({xx:b.vector1.x,xy:b.vector2.x,yx:b.vector1.y,yy:b.vector2.y});g=new e.Matrix2D({xx:g.vector1.x,xy:g.vector1.y,yx:g.vector2.x,yy:g.vector2.y});c=new e.Matrix2D([e.invert(b),c,e.invert(g)]);v(g,f);c.xx*=f.sx;c.yy*=f.sy;m(b,f);
c.xx*=f.sx;c.yy*=f.sy;return q.mixin(f,{sx:c.xx,sy:c.yy})}})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),function(g,q,e,r,t,s,v){g=g(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(g){var f=g.spatialReference,c=g.route;if(g.directions){var n=[],b=[];e.forEach(g.directions.features,function(a,d){b[d]=a.compressedGeometry;n[d]=a.strings});g.directions.strings=n;this.directions=
new v(g.directions,b)}this.routeName=g.routeName;c&&(c.geometry&&(c.geometry.spatialReference=f),this.route=new s(c));if(g.stops){var k=this.stops=[];e.forEach(g.stops,function(a,b){a.geometry&&(a.geometry.spatialReference=f);k[a.attributes.Sequence-1]=new s(a)})}},routeName:null,directions:null,route:null,stops:null});r("extend-esri")&&q.setObject("tasks.RouteResult",g,t);return g})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b){e.isAsync||m(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var k=q("dojo.dnd.Source",n,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){r.mixin(this,r.mixin({},b));var c=this.accept;if(c.length){this.accept={};for(var e=0;e<c.length;++e)this.accept[c[e]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;
this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&t.add(this.node,"dojoDndSource");this.targetState="";this.accept&&t.add(this.node,"dojoDndTarget");this.horizontal&&t.add(this.node,"dojoDndHorizontal");this.topics=[f.subscribe("/dnd/source/over",r.hitch(this,"onDndSourceOver")),f.subscribe("/dnd/start",r.hitch(this,"onDndStart")),f.subscribe("/dnd/drop",r.hitch(this,"onDndDrop")),f.subscribe("/dnd/cancel",r.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==
a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var e=a.getItem(b[c].id).type,f=!1,g=0;g<e.length;++g)if(e[g]in this.accept){f=!0;break}if(!f)return!1}return!0},copyState:function(a,d){if(a)return!0;2>arguments.length&&(d=this==b.manager().target);if(d){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){k.superclass.destroy.call(this);g.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!(this.isDragging&&
"Disabled"==this.targetState)){k.superclass.onMouseMove.call(this,a);var d=b.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var e=this.getSelectedNodes();e.length&&d.startDrag(this,e,this.copyState(c.getCopyKeyState(a),!0))}if(this.isDragging){e=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=s.position(this.current,!0);e=this.horizontal?a.pageX-this.targetBox.x<
this.targetBox.w/2==s.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||e!=this.before)this._markTargetAnchor(e),d.canDrop(!this.current||d.source!=this||!(this.current.id in this.selection))}}},onMouseDown:function(a){if(!this.mouseDown&&this._legalMouseDown(a)&&(!this.skipForm||!c.isFormElement(a)))this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,k.superclass.onMouseDown.call(this,a)},onMouseUp:function(a){this.mouseDown&&
(this.mouseDown=!1,k.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=b.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,d,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");d=this.accept&&this.checkAcceptance(a,d);this._changeState("Target",d?
"":"Disabled");this==a&&b.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,e){if(this==e)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,e){var f=this._normalizedCreator;
this._normalizedCreator=this.creator?function(b,d){return f.call(this,a.getItem(b.id).data,d)}:e?function(b){var d=a.getItem(b.id);b=b.cloneNode(!0);b.id=c.getUniqueId();return{node:b,data:d.data,type:d.type}}:function(b){var d=a.getItem(b.id);a.delItem(b.id);return{node:b,data:d.data,type:d.type}};this.selectNone();!e&&!this.creator&&a.selectNone();this.insertNodes(!0,b,this.before,this.current);!e&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=f},onDropInternal:function(a,b){var e=
this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return e.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=c.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=
e}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){k.superclass.onOverEvent.call(this);b.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){k.superclass.onOutEvent.call(this);b.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!v.isLeft(a))return!1;
if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(t.contains(a,"dojoDndHandle"))return!0;if(t.contains(a,"dojoDndItem")||t.contains(a,"dojoDndIgnore"))break}return!1}});return k})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),function(g,q,e,r,t,s,v,m,f,c){return q("dojox.gfx.Moveable",null,{constructor:function(c,b){this.shape=
c;this.delay=b&&0<b.delay?b.delay:0;this.mover=b&&b.mover?b.mover:f;this.leftButtonOnly=b&&b.leftButtonOnly;this.events=[this.shape.on(s.press,g.hitch(this,"onMouseDown"))]},destroy:function(){e.forEach(this.events,function(c){c.remove()});this.events=this.shape=null},onMouseDown:function(e){this.delay?(this.events.push(this.shape.on(s.move,g.hitch(this,"onMouseMove")),this.shape.on(s.release,g.hitch(this,"onMouseUp"))),this._lastX=e.clientX,this._lastY=e.clientY):(!this.leftButtonOnly||c.isLeft(e))&&
new this.mover(this.shape,e,this);r.stop(e)},onMouseMove:function(c){var b=c.clientY;if(Math.abs(c.clientX-this._lastX)>this.delay||Math.abs(b-this._lastY)>this.delay)this.onMouseUp(c),new this.mover(this.shape,c,this);r.stop(c)},onMouseUp:function(c){this.events.pop().remove()},onMoveStart:function(c){t.publish("/gfx/move/start",c);v.add(m.body(),"dojoMove")},onMoveStop:function(c){t.publish("/gfx/move/stop",c);v.remove(m.body(),"dojoMove")},onFirstMove:function(c){},onMove:function(c,b){this.onMoving(c,
b);this.shape.applyLeftTransform(b);this.onMoved(c,b)},onMoving:function(c,b){},onMoved:function(c,b){}})})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});e("extend-esri")&&q.setObject("tasks.PrintParameters",g,r);return g})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(g,q,e,r,t){g=g(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(e){q.mixin(this,e);this.location=new t(this.location)}});e("extend-esri")&&q.setObject("tasks.AddressCandidate",g,r);return g})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(g,q,e,r,t,
s,v,m,f,c){var n=g.shape={};n.Shape=e("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(t("gfxRegistry")){var b=n.register(this);this.getUID=function(){return b}}},destroy:function(){t("gfxRegistry")&&n.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},
getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b)return null;var e=this._getRealMatrix();return[c.multiplyPoint(e,b.x,b.y),c.multiplyPoint(e,b.x+b.width,b.y),c.multiplyPoint(e,b.x+b.width,b.y+b.height),c.multiplyPoint(e,b.x,b.y+b.height)]},getEventSource:function(){return this.rawNode},
setClip:function(b){this.clip=b},getClip:function(){return this.clip},setShape:function(b){this.shape=g.makeParameters(this.shape,b);this.bbox=null;return this},setFill:function(b){if(!b)return this.fillStyle=null,this;var c=null;if("object"==typeof b&&"type"in b)switch(b.type){case "linear":c=g.makeParameters(g.defaultLinearGradient,b);break;case "radial":c=g.makeParameters(g.defaultRadialGradient,b);break;case "pattern":c=g.makeParameters(g.defaultPattern,b)}else c=g.normalizeColor(b);this.fillStyle=
c;return this},setStroke:function(b){if(!b)return this.strokeStyle=null,this;if("string"==typeof b||q.isArray(b)||b instanceof f)b={color:b};b=this.strokeStyle=g.makeParameters(g.defaultStroke,b);b.color=g.normalizeColor(b.color);return this},setTransform:function(b){this.matrix=c.clone(b?c.normalize(b):c.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var b=this.getParent();b&&(b._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var b=
this.getParent();b&&(b._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(b){return b?this.setTransform([this.matrix,b]):this},applyLeftTransform:function(b){return b?this.setTransform([b,this.matrix]):this},applyTransform:function(b){return b?this.setTransform([this.matrix,b]):this},removeShape:function(b){this.parent&&this.parent.remove(this,b);return this},_setParent:function(b,c){this.parent=b;return this._updateParentMatrix(c)},
_updateParentMatrix:function(b){this.parentMatrix=b?c.clone(b):null;return this._applyTransform()},_getRealMatrix:function(){for(var b=this.matrix,e=this.parent;e;)e.matrix&&(b=c.multiply(e.matrix,b)),e=e.parent;return b}});n._eventsProcessing={on:function(b,c){return s(this.getEventSource(),b,n.fixCallback(this,g.fixTarget,c))},connect:function(b,c,a){"on"==b.substring(0,2)&&(b=b.substring(2));return this.on(b,a?q.hitch(c,a):c)},disconnect:function(b){return b.remove()}};n.fixCallback=function(b,
c,a,d){d||(d=a,a=null);if(q.isString(d)){a=a||r.global;if(!a[d])throw['dojox.gfx.shape.fixCallback: scope["',d,'"] is null (scope\x3d"',a,'")'].join("");return function(e){return c(e,b)?a[d].apply(a,arguments||[]):void 0}}return!a?function(e){return c(e,b)?d.apply(a,arguments):void 0}:function(e){return c(e,b)?d.apply(a,arguments||[]):void 0}};q.extend(n.Shape,n._eventsProcessing);n.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},
add:function(b){var c=b.getParent();c&&c.remove(b,!0);this.children.push(b);return b._setParent(this,this._getRealMatrix())},remove:function(b,c){for(var a=0;a<this.children.length;++a)if(this.children[a]==b){c||(b.parent=null,b.parentMatrix=null);this.children.splice(a,1);break}return this},clear:function(b){for(var c,a=0;a<this.children.length;++a)c=this.children[a],c.parent=null,c.parentMatrix=null,b&&c.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var b=null;
v.forEach(this.children,function(e){var a=e.getBoundingBox();a&&((e=e.getTransform())&&(a=c.multiplyRectangle(e,a)),b?(b.x=Math.min(b.x,a.x),b.y=Math.min(b.y,a.y),b.endX=Math.max(b.endX,a.x+a.width),b.endY=Math.max(b.endY,a.y+a.height)):b={x:a.x,y:a.y,endX:a.x+a.width,endY:a.y+a.height})});b&&(b.width=b.endX-b.x,b.height=b.endY-b.y);return b}return null},_moveChildToFront:function(b){for(var c=0;c<this.children.length;++c)if(this.children[c]==b){this.children.splice(c,1);this.children.push(b);break}return this},
_moveChildToBack:function(b){for(var c=0;c<this.children.length;++c)if(this.children[c]==b){this.children.splice(c,1);this.children.unshift(b);break}return this}};n.Surface=e("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){v.forEach(this._nodes,m.destroy);this._nodes=[];v.forEach(this._events,function(b){b&&b.remove()});this._events=[];this.rawNode=null;if(t("ie"))for(;this._parent.lastChild;)m.destroy(this._parent.lastChild);
else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(b){},whenLoaded:function(b,c){var a=q.hitch(b,c);if(this.isLoaded)a(this);else s.once(this,"load",function(b){a(b)})}});q.extend(n.Surface,n._eventsProcessing);n.Rect=e("dojox.gfx.shape.Rect",n.Shape,{constructor:function(b){this.shape=g.getDefault("Rect");this.rawNode=b},getBoundingBox:function(){return this.shape}});n.Ellipse=e("dojox.gfx.shape.Ellipse",
n.Shape,{constructor:function(b){this.shape=g.getDefault("Ellipse");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-b.rx,y:b.cy-b.ry,width:2*b.rx,height:2*b.ry}}return this.bbox}});n.Circle=e("dojox.gfx.shape.Circle",n.Shape,{constructor:function(b){this.shape=g.getDefault("Circle");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-b.r,y:b.cy-b.r,width:2*b.r,height:2*b.r}}return this.bbox}});n.Line=e("dojox.gfx.shape.Line",
n.Shape,{constructor:function(b){this.shape=g.getDefault("Line");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:Math.min(b.x1,b.x2),y:Math.min(b.y1,b.y2),width:Math.abs(b.x2-b.x1),height:Math.abs(b.y2-b.y1)}}return this.bbox}});n.Polyline=e("dojox.gfx.shape.Polyline",n.Shape,{constructor:function(b){this.shape=g.getDefault("Polyline");this.rawNode=b},setShape:function(b,c){b&&b instanceof Array?(this.inherited(arguments,[{points:b}]),c&&this.shape.points.length&&
this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[b]);return this},_normalizePoints:function(){var b=this.shape.points,c=b&&b.length;if(c&&"number"==typeof b[0]){for(var a=[],d=0;d<c;d+=2)a.push({x:b[d],y:b[d+1]});this.shape.points=a}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var b=this.shape.points,c=b.length,a=b[0],d=a.x,e=a.y,f=a.x,g=a.y,m=1;m<c;++m)a=b[m],d>a.x&&(d=a.x),f<a.x&&(f=a.x),e>a.y&&(e=a.y),g<a.y&&(g=a.y);this.bbox={x:d,y:e,width:f-
d,height:g-e}}return this.bbox}});n.Image=e("dojox.gfx.shape.Image",n.Shape,{constructor:function(b){this.shape=g.getDefault("Image");this.rawNode=b},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});n.Text=e(n.Shape,{constructor:function(b){this.fontStyle=null;this.shape=g.getDefault("Text");this.rawNode=b},getFont:function(){return this.fontStyle},setFont:function(b){this.fontStyle="string"==typeof b?g.splitFontString(b):g.makeParameters(g.defaultFont,
b);this._setFont();return this},getBoundingBox:function(){var b=null;this.getShape().text&&(b=g._base._computeTextBoundingBox(this));return b}});n.Creator={createShape:function(b){switch(b.type){case g.defaultPath.type:return this.createPath(b);case g.defaultRect.type:return this.createRect(b);case g.defaultCircle.type:return this.createCircle(b);case g.defaultEllipse.type:return this.createEllipse(b);case g.defaultLine.type:return this.createLine(b);case g.defaultPolyline.type:return this.createPolyline(b);
case g.defaultImage.type:return this.createImage(b);case g.defaultText.type:return this.createText(b);case g.defaultTextPath.type:return this.createTextPath(b)}return null},createGroup:function(){return this.createObject(g.Group)},createRect:function(b){return this.createObject(g.Rect,b)},createEllipse:function(b){return this.createObject(g.Ellipse,b)},createCircle:function(b){return this.createObject(g.Circle,b)},createLine:function(b){return this.createObject(g.Line,b)},createPolyline:function(b){return this.createObject(g.Polyline,
b)},createImage:function(b){return this.createObject(g.Image,b)},createText:function(b){return this.createObject(g.Text,b)},createPath:function(b){return this.createObject(g.Path,b)},createTextPath:function(b){return this.createObject(g.TextPath,{}).setText(b)},createObject:function(b,c){return null}};return n})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(g,q,e,r){g=g(null,{declaredClass:"esri.tasks.RasterData",constructor:function(e){e&&
q.mixin(this,e)},url:null,format:null,itemID:null,toJson:function(){var e={};this.url&&(e.url=this.url);this.format&&(e.format=this.format);this.itemID&&(e.itemID=this.itemID);return e}});e("extend-esri")&&q.setObject("tasks.RasterData",g,r);return g})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(g,q){return g("dijit._Contained",null,{_getSibling:function(e){var g=this.domNode;do g=g[e+"Sibling"];while(g&&1!=g.nodeType);return g&&q.byNode(g)},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return!e||!e.getIndexOfChild?-1:e.getIndexOfChild(this)}})})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(g,q,e,r,t,s,v,m,f,c,n,b,k,a){q=q("dojo.dnd.Container",f,{skipForm:!1,allowNested:!1,constructor:function(a,
b){this.node=s.byId(a);b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&s.byId(b.dropParent);this.map={};this.current=null;this.containerState="";v.add(this.node,"dojoDndContainer");(!b||!b._skipStartup)&&this.startup();this.events=[n(this.node,k.over,r.hitch(this,"onMouseOver")),n(this.node,k.out,r.hitch(this,"onMouseOut")),n(this.node,"dragstart",r.hitch(this,"onSelectStart")),n(this.node,"selectstart",r.hitch(this,"onSelectStart"))]},creator:function(){},
getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(b,c){c=c||e.global;var f=this.map,g=a._empty,k;for(k in f)k in g||b.call(c,f[k],k,this);return c},clearItems:function(){this.map={}},getAllNodes:function(){return b((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var b={};this.getAllNodes().forEach(function(c){if(c.id){var e=this.getItem(c.id);if(e){b[c.id]=e;return}}else c.id=a.getUniqueId();
var e=c.getAttribute("dndType"),f=c.getAttribute("dndData");b[c.id]={data:f||c.innerHTML,type:e?e.split(/\s*,\s*/):["text"]}},this);this.map=b;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var e;if(c)for(b=0;b<a.length;++b)e=this._normalizedCreator(a[b]),this.setItem(e.node.id,{data:e.data,type:e.type}),c.parentNode.insertBefore(e.node,c);else for(b=0;b<a.length;++b)e=this._normalizedCreator(a[b]),this.setItem(e.node.id,
{data:e.data,type:e.type}),this.parent.appendChild(e.node);return this},destroy:function(){g.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var b=this.parent.getElementsByTagName("tbody");b&&b.length&&(this.parent=b[0])}this.defaultCreator=a._defaultCreator(this.parent);this.sync()},
onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(c){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container",
"");this.onOutEvent()},onSelectStart:function(b){if(!this.skipForm||!a.isFormElement(b))b.stopPropagation(),b.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a,e=a.toLowerCase()+"State";v.replace(this.node,c+b,c+this[e]);this[e]=b},_addItemClass:function(a,b){v.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){v.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==
this.parent||this.allowNested)&&v.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(b,c){var e=(this.creator||this.defaultCreator).call(this,b,c);r.isArray(e.type)||(e.type=["text"]);e.node.id||(e.node.id=a.getUniqueId());v.add(e.node,"dojoDndItem");return e}});a._createNode=function(b){return!b?a._createSpan:function(a){return m.create(b,{innerHTML:a})}};a._createTrTd=function(a){var b=m.create("tr");m.create("td",{innerHTML:a},b);return b};a._createSpan=function(a){return m.create("span",
{innerHTML:a})};a._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};a._defaultCreator=function(b){b=b.tagName.toLowerCase();var c="tbody"==b||"thead"==b?a._createTrTd:a._createNode(a._defaultCreatorNodes[b]);return function(b,d){var e=b&&r.isObject(b),f,g;e&&b.tagName&&b.nodeType&&b.getAttribute?(f=b.getAttribute("dndData")||b.innerHTML,e=(e=b.getAttribute("dndType"))?e.split(/\s*,\s*/):["text"],g=b):(f=e&&b.data?b.data:b,e=e&&b.type?b.type:["text"],g=("avatar"==d?a._createSpan:c)(String(f)));
g.id||(g.id=a.getUniqueId());return{node:g,data:f,type:e}}};return q})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(g){g=g.bezierutils={};g.tAtLength=function(g,m){var f=0,c=6==g.length,n=0,b=0,k=c?r:s,a=function(d,h){for(var l=0,q=0;q<d.length-2;q+=2)l+=e(d[q],d[q+1],d[q+2],d[q+3]);q=c?e(g[0],g[1],g[4],g[5]):e(g[0],g[1],g[6],g[7]);l-q>h||n+l>m+h?(++b,l=k(d,0.5),a(l[0],h),Math.abs(n-m)<=h||a(l[1],h)):(n+=l,f+=1/(1<<b))};m&&a(g,0.5);return f};var q=g.computeLength=function(g){for(var m=
6==g.length,f=0,c=0;c<g.length-2;c+=2)f+=e(g[c],g[c+1],g[c+2],g[c+3]);c=m?e(g[0],g[1],g[4],g[5]):e(g[0],g[1],g[6],g[7]);0.1<f-c&&(g=m?r(g,0.5):t(g,0.5),f=q(g[0],m),f+=q(g[1],m));return f},e=g.distance=function(e,g,f,c){return Math.sqrt((f-e)*(f-e)+(c-g)*(c-g))},r=function(e,g){var f=1-g,c=f*f,n=g*g,b=e[0],k=e[1],a=e[2],d=e[3],h=e[4],l=e[5],q=c*b+2*f*g*a+n*h,c=c*k+2*f*g*d+n*l;return[[b,k,f*b+g*a,f*k+g*d,q,c],[q,c,f*a+g*h,f*d+g*l,h,l]]},t=function(e,g){var f=1-g,c=f*f,n=c*f,b=g*g,k=b*g,a=e[0],d=e[1],
h=e[2],l=e[3],q=e[4],r=e[5],s=e[6],t=e[7],z=n*a+3*c*g*h+3*f*b*q+k*s,n=n*d+3*c*g*l+3*f*b*r+k*t;return[[a,d,f*a+g*h,f*d+g*l,c*a+2*f*g*h+b*q,c*d+2*f*g*l+b*r,z,n],[z,n,c*h+2*f*g*q+b*s,c*l+2*f*g*r+b*t,f*q+g*s,f*r+g*t,s,t]]},s=g.splitBezierAtT=function(e,g){return 6==e.length?r(e,g):t(e,g)};return g})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(g,q,e,r,t,s,v,m){g=
g(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var f=e.map(this.geometries,function(c){return c.toJson()}),c={};c.outSR=this.outSR.wkid||r.toJson(this.outSR.toJson());c.inSR=this.geometries[0].spatialReference.wkid||r.toJson(this.geometries[0].spatialReference.toJson());c.geometries=r.toJson({geometryType:m.getJsonType(this.geometries[0]),geometries:f});this.transformation&&(c.transformation=this.transformation.wkid||
r.toJson(this.transformation));v.isDefined(this.transformForward)&&(c.transformForward=this.transformForward);return c}});t("extend-esri")&&q.setObject("tasks.ProjectParameters",g,s);return g})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(g,q,e,r,t,s,v,m,f,c,n,b,k,a){var d=q("dojo.dnd.Manager",[s],{constructor:function(){this.source=
this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:v("touch")?0:16,OFFSET_Y:v("touch")?-64:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=Boolean(this.target),this.avatar.update());c.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),c.publish("/dnd/source/over",null)):c.publish("/dnd/source/over",
null)},startDrag:function(a,b,d){function g(a){a.preventDefault();a.stopPropagation()}k.autoScrollStart(r.doc);this.source=a;this.nodes=b;this.copy=Boolean(d);this.avatar=this.makeAvatar();r.body().appendChild(this.avatar.node);c.publish("/dnd/start",a,b,this.copy);this.events=[f(r.doc,n.move,e.hitch(this,"onMouseMove")),f(r.doc,n.release,e.hitch(this,"onMouseUp")),f(r.doc,"keydown",e.hitch(this,"onKeyDown")),f(r.doc,"keyup",e.hitch(this,"onKeyUp")),f(r.doc,"dragstart",g),f(r.body(),"selectstart",
g)];t.add(r.body(),"dojoDnd"+(d?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){t.remove(r.body(),["dojoDndCopy","dojoDndMove"]);g.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new a(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var c=this.avatar;c&&
(k.autoScrollNodes(a),c=c.node.style,c.left=a.pageX+this.OFFSET_X+"px",c.top=a.pageY+this.OFFSET_Y+"px",c=Boolean(this.source.copyState(b.getCopyKeyState(a))),this.copy!=c&&this._setCopyStatus(c));v("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var d=Boolean(this.source.copyState(b.getCopyKeyState(a)));c.publish("/dnd/drop/before",this.source,this.nodes,d,this.target,a);c.publish("/dnd/drop",this.source,this.nodes,d,this.target,a)}else c.publish("/dnd/cancel");
this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case m.CTRL:a=Boolean(this.source.copyState(!0));this.copy!=a&&this._setCopyStatus(a);break;case m.ESCAPE:c.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==m.CTRL&&(a=Boolean(this.source.copyState(!1)),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();t.replace(r.body(),"dojoDnd"+(this.copy?"Copy":"Move"),
"dojoDnd"+(this.copy?"Move":"Copy"))}});b._manager=null;d.manager=b.manager=function(){b._manager||(b._manager=new d);return b._manager};return d})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(g,q,e,r,t,s,v,m){return g("dojo.dnd.Avatar",null,{constructor:function(e){this.manager=e;this.construct()},construct:function(){var e=s.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",
zIndex:"1999",margin:"0px"}}),c=this.manager.source,g,b=s.create("tbody",null,e),k=s.create("tr",null,b),a=s.create("td",null,k),d=Math.min(5,this.manager.nodes.length),h=0;v("highcontrast")&&s.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},a);s.create("span",{innerHTML:c.generateText?this._generateText():""},a);for(r.set(k,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});h<d;++h)c.creator?g=c._normalizedCreator(c.getItem(this.manager.nodes[h].id).data,"avatar").node:(g=
this.manager.nodes[h].cloneNode(!0),"tr"==g.tagName.toLowerCase()&&(k=s.create("table"),s.create("tbody",null,k).appendChild(g),g=k)),g.id="",k=s.create("tr",null,b),a=s.create("td",null,k),a.appendChild(g),r.set(k,{"class":"dojoDndAvatarItem",style:{opacity:(9-h)/10}});this.node=e},destroy:function(){s.destroy(this.node);this.node=!1},update:function(){t.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(v("highcontrast")){var f=e.byId("a11yIcon"),c="+";this.manager.canDropFlag&&
!this.manager.copy?c="\x3c ":!this.manager.canDropFlag&&!this.manager.copy?c="o":this.manager.canDropFlag||(c="x");f.innerHTML=c}m("tr.dojoDndAvatarHeader td span"+(v("highcontrast")?" span":""),this.node).forEach(function(c){c.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(g,
q,e,r){return g("dijit.DropDownMenu",r,{templateString:e,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},_onLeftArrow:function(e){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else e.stopPropagation(),e.preventDefault()}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(g,q,e,r,t,s,v,m,f,c,n,b){v=g("dijit.MenuItem"+(s("dojo-bidi")?"_NoBidi":""),[m,f,c,n],{templateString:b,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(b){this._set("label",b);var a="",c;c=b.search(/{\S}/);if(0<=c){var a=b.charAt(c+1),e=b.substr(0,c);b=b.substr(c+3);c=e+a+b;b=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+a+"\x3c/span\x3e"+b}else c=b;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=b;this._set("shortcutKey",a)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(b){b&&!("label"in this.params)&&this._set("label",b.innerHTML)},buildRendering:function(){this.inherited(arguments);e.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&e.set(this.accelKeyNode,"id",this.id+"_accel");q.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==s("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(b){}},_setSelected:function(b){r.toggle(this.domNode,
"dijitMenuItemSelected",b)},setLabel:function(b){t.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",b)},setDisabled:function(b){t.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",b)},_setDisabledAttr:function(b){this.focusNode.setAttribute("aria-disabled",b?"true":"false");this._set("disabled",b)},_setAccelKeyAttr:function(b){this.accelKeyNode&&(this.accelKeyNode.style.display=
b?"":"none",this.accelKeyNode.innerHTML=b,e.set(this.containerNode,"colSpan",b?"1":"2"));this._set("accelKey",b)}});s("dojo-bidi")&&(v=g("dijit.MenuItem",v,{_setLabelAttr:function(b){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return v})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(g,
q,e,r,t,s,v,m,f,c,n){g=g(c,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(b){this._geocodeHandler=q.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=q.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=q.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(b){this.outSpatialReference=b},_geocodeHandler:function(b,c,a,d,e){try{var f=b.candidates,g;c=[];var m,q=f.length,r=b.spatialReference,s;for(m=0;m<q;m++){g=f[m];if(s=g.location)s.spatialReference=r;c[m]=new n(g)}this._successHandler([c],"onAddressToLocationsComplete",a,e)}catch(t){this._errorHandler(t,d,e)}},_geocodeAddressesHandler:function(b,c,a,d,e){try{var f=b.locations;c=[];var g,m=f.length,q=b.spatialReference,r;for(g=0;g<m;g++){if(r=
f[g].location)r.spatialReference=q;c[g]=new n(f[g])}this._successHandler([c],"onAddressesToLocationsComplete",a,e)}catch(s){this._errorHandler(s,d,e)}},addressToLocations:function(b,c,a,d,e){var g,n,s,v,B,z,E;b.address&&(d=a,a=c,c=b.outFields,e=b.searchExtent,E=b.countryCode,g=b.magicKey,n=b.distance,z=b.categories,b.location&&this.normalization&&(s=b.location.normalize()),v=b.maxLocations,B=b.forStorage,b=b.address);e&&(e=e.shiftCentralMeridian());var y=this.outSpatialReference;b=this._encode(q.mixin({},
this._url.query,b,{f:"json",outSR:y&&t.toJson(y.toJson()),outFields:c&&c.join(",")||null,searchExtent:e&&t.toJson(e.toJson()),category:z&&z.join(",")||null,countryCode:E||null,magicKey:g||null,distance:n||null,location:s||null,maxLocations:v||null,forStorage:B||null}));var F=this._geocodeHandler,H=this._errorHandler,D=new r(f._dfdCanceller);D._pendingDfd=m({url:this._url.path+"/findAddressCandidates",content:b,callbackParamName:"callback",load:function(b,c){F(b,c,a,d,D)},error:function(a){H(a,d,D)}});
return D},suggestLocations:function(b){var c;c=new r;b.hasOwnProperty("location")&&this.normalization&&(b.location=b.location.normalize());b.searchExtent&&(b.searchExtent=b.searchExtent.shiftCentralMeridian());b=this._encode(q.mixin({},this._url.query,{f:"json",text:b.text,searchExtent:b.searchExtent&&t.toJson(b.searchExtent.toJson()),category:b.categories&&b.categories.join(",")||null,location:b.location||null,distance:b.distance||null},{f:"json"}));m({url:this._url.path+"/suggest",content:b,callbackParamName:"callback"}).then(q.hitch(this,
function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);c.resolve(a)}),q.hitch(this,function(a){this._errorHandler(a);c.reject(a)}));return c},addressesToLocations:function(b,c,a){var d=this.outSpatialReference,g=[];e.forEach(b.addresses,function(a,b){g.push({attributes:a})});b=this._encode(q.mixin({},this._url.query,{addresses:t.toJson({records:g})},{f:"json",outSR:d&&t.toJson(d.toJson())}));var l=this._geocodeAddressesHandler,n=this._errorHandler,s=new r(f._dfdCanceller);s._pendingDfd=
m({url:this._url.path+"/geocodeAddresses",content:b,callbackParamName:"callback",load:function(b,d){l(b,d,c,a,s)},error:function(b){n(b,a,s)}});return s},_reverseGeocodeHandler:function(b,c,a,d,e){try{var f=new n({address:b.address,location:b.location,score:100});this._successHandler([f],"onLocationToAddressComplete",a,e)}catch(g){this._errorHandler(g,d,e)}},locationToAddress:function(b,c,a,d){b&&this.normalization&&(b=b.normalize());var e=this.outSpatialReference;b=this._encode(q.mixin({},this._url.query,
{outSR:e&&t.toJson(e.toJson()),location:b&&t.toJson(b.toJson()),distance:c,f:"json"}));var g=this._reverseGeocodeHandler,n=this._errorHandler,s=new r(f._dfdCanceller);s._pendingDfd=m({url:this._url.path+"/reverseGeocode",content:b,callbackParamName:"callback",load:function(b,c){g(b,c,a,d,s)},error:function(a){n(a,d,s)}});return s},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});
s("extend-esri")&&q.setObject("tasks.Locator",g,v);return g})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(g,q,e,r,t){g=g(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(e){this.messages=[];q.mixin(this,e);e=this.messages;var g,m=e.length;for(g=0;g<m;g++)e[g]=new t(e[g])},jobId:"",jobStatus:""});q.mixin(g,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});e("extend-esri")&&q.setObject("tasks.JobInfo",g,r);return g})},"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\n    \t\x3c/div\x3e\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\n    \t\t\x3c/div\x3e\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\n    \t\x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\n\t\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\n\t\t\x3c/span\x3e\n\t\x3c/td\x3e\n\x3c/tr\x3e\n',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\n            \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButton" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}"\x3e\x3c/div\x3e\n                    \x3cdiv role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationClass}" data-dojo-attach-point\x3d"_addDestinationNode"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsTravelModeCarClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" travel-mode-key\x3d"Driving" data-dojo-attach-point\x3d"_useTravelModeCarNode"\x3e${_i18n.widgets.directions.travelMode.car}\x3c/div\x3e\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsTravelModeTruckClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" travel-mode-key\x3d"Trucking" data-dojo-attach-point\x3d"_useTravelModeTruckNode"\x3e${_i18n.widgets.directions.travelMode.truck}\x3c/div\x3e\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsTravelModeWalkingClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass}" travel-mode-key\x3d"Walking" data-dojo-attach-point\x3d"_useTravelModeWalkingNode"\x3e${_i18n.widgets.directions.travelMode.walking}\x3c/div\x3e\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n                \x3c/div\x3e\n                \x3cdiv role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\n                    \x3cul\x3e\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\x3c/li\x3e\n                    \x3c/ul\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_travelModeDistanceUnitsNode"\x3e\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-dojo-attach-point\x3d"_useMilesNode"\x3e${_i18n.widgets.directions.units.MILES.abbr}\x3c/div\x3e\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode"\x3e${_i18n.widgets.directions.units.KILOMETERS.abbr}\x3c/div\x3e\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n                    \x3c/div\x3e\n                    \x3cdiv class\x3d"${_css.stopsOptionsImpedanceContainerClass}" data-dojo-attach-point\x3d"_travelModeImpedanceNode"\x3e\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsImpedanceTimeClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" travel-mode-key\x3d"Time" data-dojo-attach-point\x3d"_useTravelModeTimeNode"\x3e${_i18n.widgets.directions.impedance.fastest}\x3c/div\x3e\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsImpedanceDistanceClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass}" travel-mode-key\x3d"Distance" data-dojo-attach-point\x3d"_useTravelModeDistanceNode"\x3e${_i18n.widgets.directions.impedance.shortest}\x3c/div\x3e\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n                    \x3c/div\x3e\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass}" data-dojo-attach-point\x3d"_getDirectionsButtonNode"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n    \t\x3c/div\x3e\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\n    \t\x3cdiv data-dojo-attach-point\x3d"_errorNode" role\x3d"presentation"\x3e\x3c/div\x3e\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\n    \t\x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\n\t   cellspacing\x3d"0"\x3e\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\n\x3c/table\x3e\n',"*noref":1}});
define("esri/dijit/Directions","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Geocoder dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source ../kernel ../graphic ../units ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/PictureMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../request ../config ../tasks/ProjectParameters dojo/uacss".split(" "),function(g,
q,e,r,t,s,v,m,f,c,n,b,k,a,d,h,l,u,w,C,B,z,E,y,F,H,D,A,G,x,J,M,I,L,R,K,O,S,N,T,U,V,W,P,X,Y,Z,Q,$,aa,ba){q=q("esri.dijit.Directions",[T,v],{templateString:C,basePath:g.toUrl("."),active:!0,_eventMap:{load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"]},_tmDrivingTime:"Driving Time",_tmTruckingTime:"Trucking Time",_tmWalkingTime:"Walking Time",_tmDrivingDistance:"Driving Distance",
_tmTruckingDistance:"Trucking Distance",_tmWalkingDistance:"Walking Distance",constructor:function(a,b){this._css={widgetContainerClass:"esriDirectionsContainer",stopsContainerClass:"esriStopsContainer",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",
stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",
stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",travelModesContainerClass:"esriTravelModesContainer",stopsTravelModeCarClass:"esriTravelModeCar",stopsTravelModeTruckClass:"esriTravelModeTruck",stopsTravelModeWalkingClass:"esriTravelModeWalking",stopClass:"esriStop",
stopOriginClass:"esriStopOrigin",stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSummaryClass:"esriResultsSummary",resultsViewFullRouteClass:"esriResultsViewFullRoute",resultsRouteNameClass:"esriResultsRouteName",resultsRouteButtonContainerClass:"esriResultsButtonsContainer",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routeClass:"esriRoute",
routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeLastClass:"esriDMTStopLast",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",
esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",
stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:location.protocol+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",
printTaskUrl:location.protocol+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",geometryTaskUrl:location.protocol+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],geocoderOptions:{autoComplete:!1,autoNavigate:!1},stopsInfoTemplate:new G("Location","${address}${error}"),segmentInfoTemplate:new G("Route",'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+
" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),textSymbolFont:new N("11px",N.STYLE_NORMAL,N.VARIANT_NORMAL,N.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new t([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new K({url:this.basePath+"/images/Directions/greenPoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new K({url:this.basePath+"/images/Directions/greenPointMove.png",
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new K({url:this.basePath+"/images/Directions/bluePoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new K({url:this.basePath+"/images/Directions/bluePointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new K({url:this.basePath+"/images/Directions/redPoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new K({url:this.basePath+
"/images/Directions/redPointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new K({url:this.basePath+"/images/Directions/grayPoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new K({url:this.basePath+"/images/Directions/grayPointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),routeSymbol:(new O).setColor(new t([0,69,117,1])).setWidth(4),segmentSymbol:(new O).setColor(new t([0,122,194,1])).setWidth(8),
printPage:"",printTemplate:"",autoCenterAtSegmentStart:!0,focusOnNewStop:!0,dragging:!0,canModifyStops:!0,directionsLengthUnits:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSegmentPopup:!0,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1};this.defaults=e.mixin({},this.options,a);this._sortId="_dndId_"+this.id;this._stopReference="_dndStop_"+this.id;this._i18n=w;
this.domNode=b},postCreate:function(){this.inherited(arguments);this.own(c(this._activateButton,s,e.hitch(this,function(){this._activate(!this.active)})));this.own(c(this._addDestinationNode,s,e.hitch(this,this._addStopButton)));this.own(c(this._optionsButtonNode,s,e.hitch(this,this._toggleOptionsMenu)));this.own(c(this._findOptimalOrderNode,s,e.hitch(this,this._toggleCheckbox)));this.own(c(this._returnToStartNode,s,e.hitch(this,this._toggleCheckbox)));this.own(c(this._useTrafficNode,s,e.hitch(this,
this._toggleCheckbox)));this.own(c(this._useMilesNode,s,e.hitch(this,this._toggleUnits)));this.own(c(this._useKilometersNode,s,e.hitch(this,this._toggleUnits)));this.own(c(this._useTravelModeTimeNode,s,e.hitch(this,this._toggleTravelModeImpedance)));this.own(c(this._useTravelModeDistanceNode,s,e.hitch(this,this._toggleTravelModeImpedance)));this.own(c(this._useTravelModeCarNode,s,e.hitch(this,this._toggleTravelMode)));this.own(c(this._useTravelModeTruckNode,s,e.hitch(this,this._toggleTravelMode)));
this.own(c(this._useTravelModeWalkingNode,s,e.hitch(this,this._toggleTravelMode)));this.own(c(this._getDirectionsButtonNode,s,e.hitch(this,this._solveAndZoom)));this.own(c(this._clearDirectionsButtonNode,s,e.hitch(this,function(){this.clearDirections();this.onDirectionsClear()})));this._setWidgetProperties();this._activate(this.active)},startup:function(){this.inherited(arguments);this._init()},destroy:function(){this._disconnectEvents();z.empty(this.domNode);this.inherited(arguments)},activate:function(){this._activate(!0)},
deactivate:function(){this._activate(!1)},_activate:function(a){this.active=a;this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();this.active?(this.map&&(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=c(this.map,"click",e.hitch(this,function(a){this.addStop(new D(a.mapPoint)).then(e.hitch(this,function(){1<this.stopGraphics.length&&this.getDirections()}))}))),
d.add(this._activateButton,this._css.stopsPressedButtonClass)):d.remove(this._activateButton,this._css.stopsPressedButtonClass)},_destroyGeocoders:function(){var a=this.get("geocoders");if(a&&a.length)for(var b=0;b<a.length;b++)a[b]&&a[b].destroy();this.set("geocoders",[])},_disconnectEvents:function(){this.clearDirections(!0);var a;if(this._watchEvents&&this._watchEvents.length)for(a=0;a<this._watchEvents.length;a++)this._watchEvents[a].unwatch();if(this._onEvents&&this._onEvents.length)for(a=0;a<
this._onEvents.length;a++)this._onEvents[a].remove();if(this._geocoderFindEvents&&this._geocoderFindEvents.length)for(a=0;a<this._geocoderFindEvents.length;a++)this._geocoderFindEvents[a].remove();if(this._geocoderWatchEvents&&this._geocoderWatchEvents.length)for(a=0;a<this._geocoderWatchEvents.length;a++)this._geocoderWatchEvents[a].unwatch();if(this._geocoderSelectEvents&&this._geocoderSelectEvents.length)for(a=0;a<this._geocoderSelectEvents.length;a++)this._geocoderSelectEvents[a].remove();this._onEvents=
[];this._watchEvents=[];this._geocoderSelectEvents=[];this._geocoderFindEvents=[];this._geocoderWatchEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD()},clearDirections:function(){this.get("routeParams")&&this.get("routeParams").stops&&(this.get("routeParams").stops.features.length?this.get("routeParams").stops.features=[]:arguments.length||this.reset());this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();
this._removeTrafficLayer()},reset:function(){this._setWidgetProperties();this._init()},onLoad:function(){},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0)},onDirectionsFinish:function(){this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},onError:function(){},removeStops:function(){return this._enqueue(function(){this.clearErrors();return this._removeStops()})},removeStop:function(a){return this._enqueue(function(){if(this.stops.length>
this.get("minStops"))return this.clearErrors(),this._removeStop(a);var b=new y;b.reject();return b.promise})},updateStops:function(a){return this._enqueue(function(){this.clearErrors();return this._updateStops(a)})},addStops:function(a,b){return this._enqueue(function(){this.clearErrors();return this._addStops(a,b)})},addStop:function(a,b){return this._enqueue(function(){this.clearErrors();return this._addStop(a,b)})},updateStop:function(a,b){return this._enqueue(function(){this.clearErrors();return this._updateStop(a,
b)})},clearErrors:function(){this.errors=[];this._errorNode&&(this._errorNode.innerHTML="")},getDirections:function(){return this._enqueue(function(){this._removeEmptyStops();this.clearErrors();var a=new y;this._calculateValidStops()>=this.get("minStops")?(this.onDirectionsStart(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.get("stops")).then(e.hitch(this,function(b){this.stops=b;this._setStops();var c=this._validateStops(b);c.error?(b=w.widgets.directions.error.locator,(c=this.get("geocoders")[c.index])&&
(b=w.widgets.directions.error.unknownStop.replace("\x3cname\x3e",c.get("value"))),this._resultError(b),this.set("directions",null),this._clearRouteGraphics(),a.reject(b),this.onDirectionsFinish(Error([b]))):this._configureRoute(a)}),e.hitch(this,function(b){this.set("directions",null);this._clearRouteGraphics();a.reject(b);this.onDirectionsFinish()}))):(this.clearDirections(!0),this.createRouteSymbols(),a.reject(w.widgets.directions.error.notEnoughStops));return a.promise})},unhighlightSegment:function(){this.get("map")&&
(this.get("map").graphics&&this.get("showSegmentHighlight"))&&(this.get("map").graphics.remove(this._segmentGraphic),this._segmentGraphic=null)},highlightSegment:function(a){"undefined"===typeof a&&(a=0);a=this.get("directions").features[a];var b=new L(a.geometry),c=b.getPoint(0,0),d=b.getPoint(0,1);R.getLength(c,d)||(b=c);this.unhighlightSegment();(this._segmentGraphic=new D(b,this.get("segmentSymbol"),a.attributes,this.get("segmentInfoTemplate")))&&this.get("map")&&this.get("map").graphics&&this.get("showSegmentHighlight")&&
this.get("map").graphics.add(this._segmentGraphic)},zoomToSegment:function(a){"undefined"===typeof a&&(a=0);if(this.get("map")){var b=this.get("directions").features[a],c=(new L(b.geometry)).getExtent(),c=this.get("map").setExtent(c,!0);c.then(e.hitch(this,function(){this._showSegmentPopup(b,a)}));return c.promise}return null},centerAtSegmentStart:function(a){"undefined"===typeof a&&(a=0);if(this.get("map")){var b=this.get("directions").features[a],c=b.geometry.getPoint(0,0);this.get("map").centerAt(c).then(e.hitch(this,
function(){this._showSegmentPopup(b,a)}))}},zoomToFullRoute:function(){return this.get("map")?(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0)):null},setListIcons:function(){var a,b=this._dnd.getAllNodes();for(a=0;a<b.length;a++){var c=l("."+this._css.stopIconClass,b[a])[0];c&&(c.innerHTML=this._getLetter(a));d.remove(b[a],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);
c=this.stopGraphics&&this.stopGraphics[a]&&this.stopGraphics[a].attributes?this.stopGraphics[a].attributes.Status:void 0;c=0<c&&6>c;0===a?d.add(b[a],c?this._css.stopUnreachedFirstOrLastClass:this._css.stopOriginClass):a===b.length-1&&!this._startReturn?d.add(b[a],c?this._css.stopUnreachedFirstOrLastClass:this._css.stopDestinationClass):c&&d.add(b[a],this._css.stopUnreachedClass)}a=l("[data-reverse-td]",this._dndNode)[0];z.destroy(a);this.get("showReverseStopsButton")&&z.create("td",{"data-reverse-td":"true",
rowspan:b.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+w.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(a){a.stopPropagation()},onmouseout:function(a){a.stopPropagation()}},b[0])},addRouteSymbols:function(){if(this.stopGraphics.length&&this.get("map")&&this.get("map").graphics)for(var a=0;a<this.stopGraphics.length;a++)if(this.stopGraphics[a]){this.get("map").graphics.add(this.stopGraphics[a]);
var b=this.stopGraphics[a].getDojoShape();b&&b.moveToFront();this.get("map").graphics.add(this.textGraphics[a]);(b=this.textGraphics[a].getDojoShape())&&b.moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var a=this.get("stops"),b=0;b<a.length;b++){var c=a[b];if(c&&c.feature){var d=c.feature.attributes?c.feature.attributes.Status:void 0,e=this._setStopSymbol(b,a.length+(this._startReturn?1:0),!1,d),f=this._defaultSR;this.get("map")&&(f=this.get("map").spatialReference);var f=
new M(c.feature.geometry.x,c.feature.geometry.y,f),g=this._getLetter(b),g=new S(g,this.get("textSymbolFont"),this.get("textSymbolColor"));this.get("textSymbolOffset")&&g.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y);g=new D(f,g);g._textGraphic=!0;g._index=b;var h=c.feature.attributes,c=new D(f,e,{address:c.name,Status:d,SourceID:h&&h.SourceID?h.SourceID:null,SourceOID:h&&h.SourceOID?h.SourceOID:null,PosAlong:h&&h.PosAlong?h.PosAlong:null,SideOfEdge:h&&h.SideOfEdge?h.SideOfEdge:
null},this.get("stopsInfoTemplate"));c._drag=!0;c._index=b;this.stopGraphics[b]=c;this.textGraphics[b]=g}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this.addRouteSymbols();this.setListIcons()},setTravelMode:function(a){var b=new y,d=this.serviceDescription;if(d&&d.supportedTravelModes&&d.supportedTravelModes.length){for(var d=d.supportedTravelModes,e=!1,g=!1,f=0;f<d.length;f++)if(d[f].name===a&&d[f]._nodeTravelMode&&d[f]._nodeImpedance){g=!0;if(e=this.travelModeName!==
a)this.set("travelModeName",d[f].name),this.routeParams.travelMode=d[f].itemId,c.emit(d[f]._nodeTravelMode,"click",{bubbles:!1,cancelable:!0}),c.emit(d[f]._nodeImpedance,"click",{bubbles:!1,cancelable:!0});break}g?e?this._solveAndZoom().always(function(){b.resolve(a)}):b.resolve(a):b.reject(a);this._useTrafficNode&&(d=a===this._tmDrivingTime,this._useTrafficNode.disabled=!d,!d&&this._useTrafficNode.checked&&this._removeTrafficLayer())}else b.reject(a);return b.promise},getSupportedTravelModeNames:function(){var a=
[],b=this.serviceDescription;if(b&&b.supportedTravelModes&&b.supportedTravelModes.length)for(var b=b.supportedTravelModes,c=0;c<b.length;c++)a.push(b[c].name);return a},setDirectionsLengthUnits:function(a){var b=new y;d.remove(this._useMilesNode,this._css.stopsPressedButtonClass);d.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);a===A.KILOMETERS?d.add(this._useKilometersNode,this._css.stopsPressedButtonClass):a===A.MILES&&d.add(this._useMilesNode,this._css.stopsPressedButtonClass);
this.directionsLengthUnits!==a?a===A.KILOMETERS||a===A.METERS||a===A.MILES||a===A.NAUTICAL_MILES?(this.directionsLengthUnits=a,this.autoSolve?this.getDirections().always(function(){b.resolve(a)}):b.resolve(a)):b.reject(a):b.resolve(a);return b.promise},_showLoadingSpinner:function(a){void 0===a&&(a=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()&&this.loaded);a?d.add(this._widgetContainer,this._css.resultsLoadingClass):d.remove(this._widgetContainer,this._css.resultsLoadingClass)},_enqueue:function(){var a=
new y,b=arguments;this._requestQueueTail||(this._requestQueueTail=new y,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(e.hitch(this,function(){var c=b[0];try{var d=c.call(this);d&&"object"===typeof d&&d.hasOwnProperty("isFulfilled")?d.then(e.hitch(this,function(b){a.resolve(b);this._showLoadingSpinner()}),e.hitch(this,function(b){a.reject(b);this._showLoadingSpinner()})):(a.resolve(d),this._showLoadingSpinner())}catch(f){a.reject(f),this._showLoadingSpinner()}}));this._requestQueueTail=
a;this._showLoadingSpinner();return a.promise},_createDnD:function(){this._dnd=new F(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){z.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_usingAGOL:function(){return-1<this.get("routeTaskUrl").search(/^https?:\/\/route[^.]*\.arcgis\.com.*$/i)},_setGeocoderOptions:function(){var a={theme:this.get("theme")};this.defaults.geocoderOptions.autoComplete||(a.maxLocations=1);var b={map:this.get("map")};this.geocoderOptions=
e.mixin(a,this.defaults.geocoderOptions,b)},_setDefaultUnits:function(){if(this.get("directionsLengthUnits"))this.setDirectionsLengthUnits(this.directionsLengthUnits);else{var a=A.KILOMETERS;this.defaults.routeParams.directionsLengthUnits?a=this.defaults.routeParams.directionsLengthUnits:this.defaults.routeParams.directionsLanguage&&(a="en"===this.defaults.routeParams.directionsLanguage?A.MILES:A.KILOMETERS);this.set("directionsLengthUnits",a)}},_setTrafficOptions:function(){this.defaults.hasOwnProperty("showTrafficOption")?
this.set("showTrafficOption",this.defaults.showTrafficOption):this._usingAGOL()&&this.set("showTrafficOption",!0);this._usingAGOL()&&(this.get("trafficLayer")||this.set("trafficLayer",new J(location.protocol+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:0.4})))},_updateCanModifyStops:function(){this.get("canModifyStops")?this._showAddDestination():this._hideAddDestination()},_setWidgetProperties:function(){this._stopsReady=!1;this._disconnectEvents();this.set("loaded",
!1);this.set("map",this.defaults.map);this.set("alphabet",this.defaults.alphabet);this.set("directions",this.defaults.directions);this.set("directionsLanguage",this.defaults.directionsLanguage);this.set("routeTaskUrl",this.defaults.routeTaskUrl);this.set("printTaskUrl",this.defaults.printTaskUrl);this.set("geometryTaskUrl",this.defaults.geometryTaskUrl);this.set("stops",[]);this.set("textSymbolFont",this.defaults.textSymbolFont);this.set("textSymbolColor",this.defaults.textSymbolColor);this.set("textSymbolOffset",
this.defaults.textSymbolOffset);this.set("fromSymbol",this.defaults.fromSymbol);this.set("fromSymbolDrag",this.defaults.fromSymbolDrag);this.set("stopSymbol",this.defaults.stopSymbol);this.set("stopSymbolDrag",this.defaults.stopSymbolDrag);this.set("toSymbol",this.defaults.toSymbol);this.set("toSymbolDrag",this.defaults.toSymbolDrag);this.set("unreachedSymbol",this.defaults.unreachedSymbol);this.set("unreachedSymbolDrag",this.defaults.unreachedSymbolDrag);this.set("routeSymbol",this.defaults.routeSymbol);
this.set("segmentSymbol",this.defaults.segmentSymbol);this.set("showPrintPage",this.defaults.showPrintPage);this.set("showSegmentPopup",this.defaults.showSegmentPopup);this.set("showSegmentHighlight",this.defaults.showSegmentHighlight);this.set("autoCenterAtSegmentStart",this.defaults.autoCenterAtSegmentStart);this.set("showReverseStopsButton",this.defaults.showReverseStopsButton);this.set("focusOnNewStop",this.defaults.focusOnNewStop);this.set("dragging",this.defaults.dragging);this.set("canModifyStops",
this.defaults.canModifyStops);this.set("theme",this.defaults.theme);this.set("showReturnToStartOption",this.defaults.showReturnToStartOption);this.set("showOptimalRouteOption",this.defaults.showOptimalRouteOption);this.set("optimalRoute",this.defaults.optimalRoute);this.set("returnToStart",this.defaults.returnToStart);this.set("traffic",this.defaults.traffic);this.set("trafficLayer",this.defaults.trafficLayer);this.set("minStops",this.defaults.minStops);this.set("maxStops",this.defaults.maxStops);
this.set("printPage",this.defaults.printPage);this.set("autoSolve",this.defaults.autoSolve);this.set("directionsLengthUnits",this.defaults.directionsLengthUnits);this.set("stopsInfoTemplate",this.defaults.stopsInfoTemplate);this.set("segmentInfoTemplate",this.defaults.segmentInfoTemplate);this.set("geocoders",[]);this.set("showTravelModesOption",this.defaults.showTravelModesOption);this.set("showMilesKilometersOption",this.defaults.showMilesKilometersOption);this.set("showClearButton",this.defaults.showClearButton);
this._defaultSR=new x(4326);this._updateCanModifyStops()},_setStopsAttr:function(a){this._stopsReady?(a||(a=[]),this._updateStops(a),this._setStops()):this._set("stops",a)},_updateStops:function(a){this.stops||(this.stops=[]);a||(a=[]);var b=this.stops.length;return a&&a.length?this._getCandidates(a).then(e.hitch(this,function(a){var c=a.length,d=0,d=0;if(c===b)for(d=0;d<c;d++)this._updateStopInsert(a[d],d);else if(c>b){if(b)for(d;d<b;d++)this._updateStopInsert(a[d],d);for(d;d<c;d++)this._insertStop(a[d],
d)}else{for(var e=b-c,d=0;d<e;d++)this._removeStop();for(d=0;d<c;d++)this._updateStopInsert(a[d],d)}this._setStops()})):this._removeStops()},_removeStops:function(){var a=e.clone(this.get("stops")),b=new y;if(this.stops.length){for(;this.stops.length;)this._removeStop();b.resolve(a)}else b.reject("no stops to remove");return b.promise},_removeStop:function(a){var b=new y;if(this.stops.length){"undefined"===typeof a&&(a=this.stops.length-1);var c=this.stops.splice(a,1);this._setStops();var d=this._dnd.getAllNodes()[a],
e=this.get("geocoders");e[a].destroy();e.splice(a,1);this.set("geocoders",e);this._geocoderSelectEvents[d.id].remove();this._geocoderFindEvents[d.id].remove();this._geocoderWatchEvents[d.id].unwatch();z.destroy(d);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders();b.resolve(c,a)}else b.reject(w.widgets.directions.error.cantRemoveStop);return b.promise},_removeTrafficLayer:function(){var a=this.get("trafficLayer"),b=this.get("map");
a&&b&&b.removeLayer(a);this._trafficLayerAdded=!1},_addStops:function(a,b){for(var c=0;c<Math.min(a.length,this.maxStops-this.stopGraphics.length);c++)this.addStop(a[c],void 0===b?b:b+c)},_addStop:function(a,b){var c=new y;this._checkMaxStops();this.maxStopsReached?(this._resultError(w.widgets.directions.error.maximumStops),c.reject(w.widgets.directions.error.maximumStops)):this._getCandidate(a).then(e.hitch(this,function(a){b=this._insertStop(a,b);this._setStops();c.resolve(a,b)}),e.hitch(this,function(a){c.reject(a)}));
return c.promise},_removeEmptyStops:function(){if(this.stops.length>this.get("minStops"))for(var a=this.stops.length-1;this.stops.length>this.get("minStops")&&-1<a;a--){var b=this.stops[a];(!b||!b.name)&&this._removeStop(a)}},_setReverseGeocode:function(a,b,c){if(a.feature.geometry&&-1<c){var d={address:a.name};this.stopGraphics[c]&&(this.stopGraphics[c].setAttributes(d),this.stopGraphics[c].setGeometry(b));this.textGraphics[c]&&(this.textGraphics[c].setAttributes(d),this.textGraphics[c].setGeometry(b));
this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._moveInProgress||this._unsetDraggableObject(this._dragGraphic);this.get("geocoders")[c]&&this.get("geocoders")[c].set("value",a.name);this.stops[c]=a;this.stops[c].feature.setGeometry(b);this._setStops();this.get("autoSolve")&&this.getDirections()}},_insertStop:function(a,b){var c,d;if(void 0===b)for(c=0;c<this.geocoders.length;c++){if(!this.geocoders[c].get("value")){d=this.geocoders[c];break}}else c=b,this.geocoders[c]&&
!this.geocoders[c].get("value")&&(d=this.geocoders[c]);d&&(void 0===b||b===c)?(d.set("value",a.name),this.stops[c]=a,d[this._stopReference]=a):(void 0===b&&(b=this.geocoders.length),this._createGeocoder(a,b))},_createGeocoder:function(a,b){var c=this._dnd.getAllNodes(),f=!1,g=!1,h=c.length;c[b]?(g=c[b],f=!0):f=g=!1;var k=e.hitch(this,function(a,b){var c=b?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,e=b?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;d.replace(a.children[0],
c,e);2<this.geocoders.length&&(c=b?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,e=b?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,d.replace(a.children[3].children[0],c,e))}),l=z.create("tr",{className:this._css.stopClass,onmouseover:function(){k(this,!0)},onmouseout:function(){k(this,!1)}});z.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},l);c=z.create("td",{className:this._css.stopIconColumnClass},l);z.create("div",{className:this._css.stopIconClass+
" dojoDndHandle",innerHTML:this._getLetter(h),"data-center-at":"true"},c);h=z.create("td",{className:this._css.esriStopGeocoderColumnClass},l);h=z.create("div",{},h);this.get("canModifyStops")&&(c=z.create("td",{className:this._css.stopIconRemoveColumnClass},l),z.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},c));this._dnd.insertNodes(!1,[l],f,g);this.stops.splice(b,0,a);f=e.mixin({},this.get("geocoderOptions"),{value:a.name});f=new B(f,h);f[this._sortId]=
l.id;f[this._stopReference]=a;g=this.get("geocoders");g.splice(b,0,f);f.startup();this.set("geocoders",g);g=e.hitch(this,function(a){if(a&&(a.results||a.result)){var b=this._dnd.getAllNodes(),b=r.indexOf(b,l),c=!0;a.results&&a.results.results&&a.results.results.length?(this._setStops(),this.stops[b]=a.results.results[0]):a.result?(this._setStops(),this.stops[b]=a.result):(this._removeStopButton(b),this.set("directions",null),this._resultError(w.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
a.target.get("value"))),this._clearRouteGraphics(),c=!1);c&&this._solveAndZoom()}});h=f.on("select",g);this._geocoderSelectEvents[l.id]=h;g=f.on("find-results",g);this._geocoderFindEvents[l.id]=g;g=f.watch("value",e.hitch(this,function(a,b,c){a=this._dnd.getAllNodes();a=r.indexOf(a,l);this.stops[a]&&c!==this.stops[a].name&&(this.stops[a]={name:c},this._setStops())}));this._geocoderWatchEvents[l.id]=g;this._checkMaxStops();this.setListIcons();this.get("focusOnNewStop")&&f.focus();this._stopsRemovable();
this._optionsMenu();this._sortGeocoders()},_validateStops:function(a){if(a)for(var b=0;b<a.length;b++)if(!a[b]||!a[b].feature)return{error:!0,index:b};return{error:!1}},_sortStops:function(){this.stops.length&&(this.stops.sort(e.hitch(this,function(a,b){for(var c,d,e=0;e<this.get("geocoders").length;e++)this.geocoders[e][this._stopReference]===a?c=e:this.geocoders[e][this._stopReference]===b&&(d=e);return c>d?1:d>c?-1:0})),this._setStops())},_getCandidate:function(a){var b=new y,c=typeof a,d={name:""};
a?"object"===c&&a.hasOwnProperty("feature")&&a.hasOwnProperty("name")?b.resolve(a):"object"===c&&a.hasOwnProperty("address")&&a.hasOwnProperty("location")?(c=this._globalGeocoder._hydrateResult(a),b.resolve(c)):"object"===c&&a.hasOwnProperty("name")&&!a.name?b.resolve(d):("object"===c&&a.hasOwnProperty("name")&&(a=a.name),this._globalGeocoder?this._globalGeocoder.find(a).then(e.hitch(this,function(c){c.results&&c.results.length?a.geometry&&!isNaN(a.geometry.x)&&!isNaN(a.geometry.y)&&this.map.spatialReference.wkid===
a.geometry.spatialReference.wkid?(c.results[0].feature.geometry=a.geometry,b.resolve(c.results[0])):!c.results[0].feature.geometry||isNaN(c.results[0].feature.geometry.x)||isNaN(c.results[0].feature.geometry.y)?(this._resultError(w.widgets.directions.error.locator),b.reject(w.widgets.directions.error.locator)):b.resolve(c.results[0]):(this._resultError(w.widgets.directions.error.locator),b.reject(w.widgets.directions.error.locator))}),e.hitch(this,function(){this._decorateUngeocodedStop(a).then(b.resolve,
b.reject)})):(this._resultError(w.widgets.directions.error.locatorUndefined),b.reject(w.widgets.directions.error.locatorUndefined))):b.resolve(d);return b.promise},_updateStopInsert:function(a,b){this.get("geocoders")[b]&&(this.get("geocoders")[b].set("value",a.name),this.stops[b]=a,this._setStops())},_updateStop:function(a,b){var c=new y;this.stops?("undefined"===typeof b&&(b=this.stops.length-1),this._getCandidate(a).then(e.hitch(this,function(a){this._updateStopInsert(a,b);c.resolve(a)}),e.hitch(this,
function(a){c.reject(a)}))):c.reject("could not update stop");return c.promise},_renderDirections:function(){var a=this.get("directions"),b="";if(this._resultsNode){b+='\x3cdiv class\x3d"'+this._css.resultsRouteNameClass+'"\x3e';b+=a.routeName;b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';if(a.totalLength||a.totalTime){var d=this._formatDistance(a.totalLength,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].name),f=this._formatTime(a.totalTime),
b=b+('\x3cdiv class\x3d"'+this._css.resultsSummaryClass+'"\x3e');d&&(b+=d);d&&f&&(b+=" \x26middot; ");f&&(b+=f);b+="\x3c/div\x3e"}b+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';b+='\x3cdiv class\x3d"'+this._css.resultsRouteButtonContainerClass+'"\x3e';b+='\x3cdiv role\x3d"button" class\x3d"'+this._css.linkButtonClass+" "+this._css.resultsViewFullRouteClass+'" data-full-route\x3d"true"\x3e'+w.widgets.directions.viewFullRoute+"\x3c/div\x3e";this.get("showPrintPage")&&(b+='\x3cdiv tabindex\x3d"0" role\x3d"button" title\x3d"'+
w.widgets.directions.print+'" class\x3d"'+this._css.resultsPrintClass+'" data-print-directions\x3d"true"\x3e\x3c/div\x3e');var b=b+('\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e'),b=b+"\x3c/div\x3e",b=b+('\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e'),b=b+('\x3ctable summary\x3d"'+a.routeName+'"\x3e'),b=b+'\x3ctbody role\x3d"menu"\x3e',g=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d].feature.attributes;if(e&&e.Sequence===b)return 0===e.Status||6===e.Status?b:g(a,b+1)}return c?
1:g(a,1,!0)},k=g(this.stops,1);r.forEach(a.features,e.hitch(this,function(c,d){var e=this._css.routeClass;c.attributes&&(c.attributes.step=d+1);c.attributes.maneuverType&&(e+=" "+c.attributes.maneuverType);0===d&&1===k?e+=" "+this._css.routeOriginClass:d===a.features.length-1&&(e+=" "+this._css.routeDestinationClass);d===a.features.length-1&&(e+=" "+this._css.routeLastClass);b+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+e+" "+this._css.routeZoomClass+'" data-segment\x3d"'+d+'"\x3e';b+=
'\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';"esriDMTDepart"===c.attributes.maneuverType?(k=g(this.stops,k),b+=this._getLetter(k-1),k++):"esriDMTStop"===c.attributes.maneuverType&&(k=g(this.stops,k),b+=this._getLetter(k-1));b+="\x3c/div\x3e";b+="\x3c/td\x3e";b+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';
var e=a.strings[d],f;if(e){var h=c.attributes.text;for(f=0;f<e.length;f++)h=this._boldText(h,e[f].string);c.attributes.formattedText=h}else c.attributes.formattedText=c.attributes.text;b+="\x3cstrong\x3e"+u.format(c.attributes.step)+".\x3c/strong\x3e "+c.attributes.formattedText;b+="\x3c/div\x3e";e=this._formatDistance(c.attributes.length,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].abbr);f=this._formatTime(c.attributes.time);e&&(b+='\x3cdiv class\x3d"'+this._css.routeLengthClass+
'"\x3e',b+=e,f&&(b+=" "+f),b+="\x3c/div\x3e");b+="\x3c/div\x3e";b+="\x3c/td\x3e";b+="\x3c/tr\x3e"}));b+="\x3c/tbody\x3e";b+="\x3c/table\x3e";b+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=b);this._disconnectResults();(d=l("[data-segment]",this._resultsNode))&&d.length&&r.forEach(d,e.hitch(this,function(b){var d=c(b,n.enter,e.hitch(this,function(){var c=parseInt(h.get(b,"data-segment"),10);this.highlightSegment(c);this.onSegmentHighlight(a.features[c])}));this._resultEvents.push(d);
d=c(b,"focusin",e.hitch(this,function(){var c=parseInt(h.get(b,"data-segment"),10);this.highlightSegment(c);this.onSegmentHighlight(a.features[c])}));this._resultEvents.push(d);d=c(b,"focusout",e.hitch(this,function(){this.unhighlightSegment()}));this._resultEvents.push(d);d=c(b,n.leave,e.hitch(this,function(){this.unhighlightSegment()}));this._resultEvents.push(d);this.get("autoCenterAtSegmentStart")&&(d=c(b,"click, keydown",e.hitch(this,function(c){if(c&&("click"===c.type||"keydown"===c.type&&c.keyCode===
m.ENTER))c=parseInt(h.get(b,"data-segment"),10),this.centerAtSegmentStart(c),this.onSegmentSelect(a.features[c])})),this._resultEvents.push(d))}))}},_showRoute:function(a){if(!this._moveInProgress){this.editToolbar.deactivate();this._clearDisplayAfterSolve();this.set("solveResult",a);var b=a.routeResults[0].directions;this.set("directions",b);var c=a.routeResults[0].stops;if(c&&c.length){var d=[],f,g=c.length;this._startReturn&&g--;for(f=0;f<g;f++){var h=c[f],h={extent:new I({xmin:h.geometry.x-0.25,
ymin:h.geometry.y-0.25,xmax:h.geometry.x+0.25,ymax:h.geometry.y+0.25,spatialReference:h.geometry.spatialReference}),feature:h,name:h.attributes.Name};d.push(h)}this.stops=d;for(f=0;f<this.stops.length;f++)this._updateStop(this.stops[f],f);this._setStops()}this.set("mergedRouteGraphic",new D(b.mergedGeometry,this.get("routeSymbol")));if(this.get("map")&&this.get("map").graphics){var k=[];r.forEach(b.features,e.hitch(this,function(a){a.setSymbol(this.get("routeSymbol"));this.get("map").graphics.add(a);
k.push(a);(a=a.getDojoShape())&&a.moveToBack()}));this.set("displayedRouteGraphics",k)}this.createRouteSymbols();this._renderDirections();this.onDirectionsFinish(a)}},_setGeocodersStopReference:function(){if(this.geocoders)for(var a=0;a<this.geocoders.length;a++)this.geocoders[a]&&this.stops[a]&&(this.geocoders[a][this._stopReference]=this.stops[a])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(a){var b=
[];if(a&&a.length){for(var c=0;c<a.length;c++)b.push(this._getCandidate(a[c]));return E(b)}a=new y;a.resolve([]);return a.promise},_clearResultsHTML:function(){this._resultsNode&&(this._resultsNode.innerHTML="")},_showSegmentPopup:function(a){if(a&&this.get("showSegmentPopup")&&this.get("map")&&this.get("map").infoWindow){var b=a.geometry.getPoint(0,0);a=new D(b,null,a.attributes,this.get("segmentInfoTemplate"));this.get("map").infoWindow.setFeatures([a]);this.get("map").infoWindow.show(b)}},_removeStopButton:function(a){this.stops.length>
this.get("minStops")?this.removeStop(a):(this._setStops(),this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve())},_addStopButton:function(){this.addStop(void 0,this.stops.length)},_sortGeocoders:function(){var a=this._dnd.getAllNodes();this.geocoders.sort(e.hitch(this,function(b,c){return this._sortGeocodersToNodes(b,c,a,this._sortId)}));this._sortStops()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var a=0;a<this._resultEvents.length;a++)this._resultEvents[a]&&
this._resultEvents[a].remove();this._resultEvents=[]},_formatTime:function(a){var b,c="";b=Math.round(a);a=Math.floor(b/60);b=Math.floor(b%60);a&&(c+=a+" ",c=1<a?c+w.widgets.directions.time.hours:c+w.widgets.directions.time.hour);a&&b&&(c+=" ");b&&(c+=b+" ",c=1<b?c+w.widgets.directions.time.minutes:c+w.widgets.directions.time.minute);return c},_formatDistance:function(a,b){var c=Math.round(100*a)/100;return 0===c?"":u.format(c)+" "+b},_setMoveSymbol:function(a){this._moveSymbolSet=!0;var b=this._setStopSymbol(a._index,
this.stopGraphics.length,!0,a.attributes.Status);a.setSymbol(b)},_unsetMoveSymbol:function(a){var b=this._setStopSymbol(a._index,this.stopGraphics.length,!1,a.attributes.Status);a.setSymbol(b);this._moveSymbolSet=!1},_removeTextGraphic:function(a){a=this.textGraphics[a];this.get("map").graphics.remove(a)},_setDraggableObject:function(a){a._drag&&(this.get("map")&&this.get("map").graphics)&&(this.get("map")._directionsWidgetDragging=!0,this._removeTextGraphic(a._index),this._dragGraphic=a,this._dragGeometry=
a.geometry,this.editToolbar.activate(Q.MOVE,a))},_setTextGraphic:function(a){if(a._drag&&this.get("map")&&this.get("map").graphics){var b=this.textGraphics[a._index];b.setGeometry(a.geometry);this.get("map").graphics.add(b);(a=b.getDojoShape())&&a.moveToFront()}},_unsetDraggableObject:function(a){a._drag&&(this.get("map")._directionsWidgetDragging=!1,this._moveSymbolSet&&this._unsetMoveSymbol(a),this._setTextGraphic(a),this.editToolbar.deactivate())},_isMyStopGraphic:function(a){return-1<r.indexOf(this.get("stopGraphics"),
a)||-1<r.indexOf(this.get("textGraphics"),a)},_editToolbar:function(){this.get("map")?this.set("editToolbar",new Q(this.get("map"))):this.set("editToolbar",null)},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var a=new y;this._globalGeocoder=new B(this.get("geocoderOptions"),z.create("div"));c.once(this._globalGeocoder,"load",e.hitch(this,function(){a.resolve()},function(b){a.reject(b)}));this._globalGeocoder.startup();
return a.promise},_init:function(){if(this.get("map"))if(this.get("map").loaded)this._configure();else c.once(this.get("map"),"load",e.hitch(this,function(){this._configure()}));else this._configure()},_setDefaultStops:function(){var a=new y;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(e.hitch(this,function(){this.get("focusOnNewStop")&&(this.get("geocoders")&&this.get("geocoders").length)&&this.get("geocoders")[0].focus();this._removeEmptyStops();a.resolve()}),
a.reject):a.resolve();return a.promise},_configure:function(){this._createDnD();this._setGeocoderOptions();this._createGlobalGeocoder().then(e.hitch(this,function(){this._editToolbar();this._enqueue(e.hitch(this,function(){this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();var a=new y,b=[this._createRouteTask(),this._setDefaultStops()];E(b).then(e.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();
this._setupEvents();this._stopsReady=!0;this.set("loaded",!0);this.onLoad();a.resolve(!0)}),function(b){a.reject(b)});return a.promise}))}))},_calculateValidStops:function(){for(var a=0,b=this.stops,c=0;c<b.length;c++)b[c]&&b[c].name&&a++;return a},_setStopSymbol:function(a,b,c,d){return void 0===d||0===d||6===d?0===a?this.get(c?"fromSymbolDrag":"fromSymbol"):a===b-1?this.get(c?"toSymbolDrag":"toSymbol"):this.get(c?"stopSymbolDrag":"stopSymbol"):this.get(c?"unreachedSymbolDrag":"unreachedSymbol")},
_addTrafficLayer:function(){var a=this.get("trafficLayer"),b=this.get("map");b&&(a&&!this._trafficLayerAdded)&&(b.addLayer(a),a.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(a){a.target===this._useMilesNode?this.setDirectionsLengthUnits(A.MILES):a.target===this._useKilometersNode&&this.setDirectionsLengthUnits(A.KILOMETERS)},_toggleTravelModeImpedance:function(a){d.add(a.target,this._css.stopsPressedButtonClass);a.target===this._useTravelModeTimeNode?d.remove(this._useTravelModeDistanceNode,
this._css.stopsPressedButtonClass):a.target===this._useTravelModeDistanceNode&&d.remove(this._useTravelModeTimeNode,this._css.stopsPressedButtonClass);this._travelModeImpedanceKey=a.target.attributes["travel-mode-key"].value;this.setTravelMode(this._travelModeKey+" "+this._travelModeImpedanceKey)},_toggleTravelMode:function(a){d.add(a.target,this._css.stopsPressedButtonClass);a.target===this._useTravelModeCarNode?(d.remove(this._useTravelModeTruckNode,this._css.stopsPressedButtonClass),d.remove(this._useTravelModeWalkingNode,
this._css.stopsPressedButtonClass)):a.target===this._useTravelModeTruckNode?(d.remove(this._useTravelModeCarNode,this._css.stopsPressedButtonClass),d.remove(this._useTravelModeWalkingNode,this._css.stopsPressedButtonClass)):a.target===this._useTravelModeWalkingNode&&(d.remove(this._useTravelModeCarNode,this._css.stopsPressedButtonClass),d.remove(this._useTravelModeTruckNode,this._css.stopsPressedButtonClass));this._travelModeKey=a.target.attributes["travel-mode-key"].value;this.setTravelMode(this._travelModeKey+
" "+this._travelModeImpedanceKey)},_toggleCheckbox:function(a){var b=h.get(a.target,"checked");a.target===this._findOptimalOrderNode?this.set("optimalRoute",b):a.target===this._useTrafficNode?this.set("traffic",b):a.target===this._returnToStartNode&&this.set("returnToStart",b)},_configureRouteOptions:function(){var a=this.get("routeParams");a.directionsLengthUnits=this.get("directionsLengthUnits");a.findBestSequence=this.get("optimalRoute");a.returnStops=!0;this.get("traffic")?(a.startTime=new Date,
a.startTimeIsUTC=!0,this._addTrafficLayer()):(a.startTime=null,a.startTimeIsUTC=null,this._removeTrafficLayer());if(this.get("returnToStart")&&this.stopGraphics.length){var b=new D(this.stopGraphics[0].geometry,null,this.stopGraphics[0].attributes),c=this.stopGraphics.slice(0);this._startReturn=b;c.push(b);a.stops.features=c}else this._startReturn=null,a.stops.features=this.stopGraphics;this.set("routeParams",a)},_configureRoute:function(a){this.createRouteSymbols();this._configureRouteOptions();
this.routeTask.solve(this.routeParams,e.hitch(this,function(b){this._showRoute(b);a.resolve(b)}),e.hitch(this,function(b){for(var c=0;c<this.stops.length;c++)this.stops[c].feature.attributes=e.mixin(this.stops[c].feature.attributes,{Status:5});this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(b);a.reject(b)}))},_boldText:function(a,b){return a.replace(RegExp("(^|\\s)("+b+")(\\s|$)","ig"),"$1\x3cstrong\x3e$2\x3c/strong\x3e$3")},_clearStopGraphics:function(){if(this.stopGraphics&&
this.stopGraphics.length&&this.get("map")&&this.get("map").graphics)for(var a=0;a<this.stopGraphics.length;a++)this.get("map").graphics.remove(this.stopGraphics[a]),this.get("map").graphics.remove(this.textGraphics[a]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_clearRouteGraphics:function(){var a=this.get("displayedRouteGraphics"),b=this.get("map");a&&(a.length&&b&&b.graphics)&&(r.forEach(a,function(a){b.graphics.remove(a)}),this.set("displayedRouteGraphics",[]));this.unhighlightSegment()},
_clearInfoWindow:function(){this.get("map")&&this.get("map").infoWindow&&(this.get("map").infoWindow.hide(),this.get("map").infoWindow.features&&this.get("map").infoWindow.clearFeatures())},_clearDisplayBeforeSolve:function(){this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this.clearErrors()},_getLetter:function(a){var b=this.get("alphabet"),c="";b&&b.length&&(a=a||0,a>=b.length&&(c=this._getLetter(Math.floor(a/
this.alphabet.length)-1),a%=this.alphabet.length),"string"===typeof b?c+=b.substr(a,1):b instanceof Array&&(c+=b[a]));return c},_solveAndZoom:function(){if(this.get("autoSolve"))return this.getDirections().then(e.hitch(this,function(){this.zoomToFullRoute()}));var a=new y;a.resolve();return a.promise},_setupEvents:function(){var a=c(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",e.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)&&this._reverseStops()}));
this._onEvents.push(a);a=c(this._resultsNode,"[data-print-directions]:click, [data-print-directions]:keydown",e.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)&&this._printDirections()}));this._onEvents.push(a);a=c(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",e.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)&&this.zoomToFullRoute()}));this._onEvents.push(a);a=c(this._dndNode,"[data-remove]:click, [data-remove]:keydown",
e.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)){var b=l("[data-remove]",this._dndNode);a=r.indexOf(b,a.target);this._removeStopButton(a)}}));this._onEvents.push(a);this._onEvents.push(c(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",e.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)){var b=l("[data-center-at]",this._dndNode);a=r.indexOf(b,a.target);this.stops[a]&&(this.stops[a].feature&&this.stops[a].feature.geometry)&&
this.map.centerAndZoom(this.stops[a].feature.geometry)}})));a=c(this._dnd,"Drop",e.hitch(this,function(){this._dnd.sync();this._sortGeocoders();this.setListIcons();this._calculateValidStops()===this.get("geocoders").length&&this.get("routeParams").stops.features.length&&this._solveAndZoom()}));this._onEvents.push(a);a=c(this._dnd,"DndStart",e.hitch(this,function(){var a=l("body")[0];d.add(a,this._css.dndDragBodyClass)}));this._onEvents.push(a);a=c(this._dnd,"DndDrop, DndCancel",e.hitch(this,function(){var a=
l("body")[0];d.remove(a,this._css.dndDragBodyClass)}));this._onEvents.push(a);this.get("map")&&this.get("map").graphics&&(a=this.get("map").graphics.on("mouse-over",e.hitch(this,function(a){if(this.get("dragging")&&!this.get("map")._directionsWidgetDragging){var b;this._isMyStopGraphic(a.graphic)&&(a.graphic._drag?(b=this.editToolbar.getCurrentState(),b.graphic||this._setDraggableObject(a.graphic),this._moveSymbolSet||this._setMoveSymbol(a.graphic)):a.graphic._textGraphic&&(b=this.editToolbar.getCurrentState(),
this.stopGraphics[a.graphic._index]&&(b.graphic||this._setDraggableObject(this.stopGraphics[a.graphic._index]),this._moveSymbolSet||this._setMoveSymbol(this.stopGraphics[a.graphic._index]))))}})),this._onEvents.push(a),a=this.get("map").graphics.on("mouse-out",e.hitch(this,function(a){this.get("dragging")&&this._isMyStopGraphic(a.graphic)&&!this._moveInProgress&&a.graphic._drag&&this._unsetDraggableObject(a.graphic)})),this._onEvents.push(a),this._editToolbarEvents());a=this.watch("theme",this._updateThemeWatch);
this._watchEvents.push(a);a=this.watch("canModifyStops",this._updateCanModifyStops);this._watchEvents.push(a);a=this.watch("showReturnToStartOption",this._optionsMenu);this._watchEvents.push(a);a=this.watch("showOptimalRouteOption",this._optionsMenu);this._watchEvents.push(a);a=this.watch("returnToStart",this._setMenuNodeValues);this._watchEvents.push(a);a=this.watch("optimalRoute",this._setMenuNodeValues);this._watchEvents.push(a);a=this.watch("routeTaskUrl",e.hitch(this,function(){this._createRouteTask();
this._setTrafficOptions()}));this._watchEvents.push(a);this._watchEvents.push(this.watch("printTaskUrl",e.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",e.hitch(this,function(){this._createGeometryTask()})));a=this.watch("routeParams",e.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()}));this._watchEvents.push(a);a=this.watch("geocoderOptions",e.hitch(this,function(){this._setGeocoderOptions();this._createGlobalGeocoder()}));
this._watchEvents.push(a);a=this.watch("showReverseStopsButton",this.setListIcons);this._watchEvents.push(a);a=this.watch("showPrintPage",this._renderDirections);this._watchEvents.push(a);a=this.watch("trafficLayer",this._trafficLayerUpdate);this._watchEvents.push(a);a=this.watch("editToolbar",this._editToolbarEvents);this._watchEvents.push(a);a=this.watch("showTravelModesOption",this._showTravelModesOption);this._watchEvents.push(a);a=this.watch("showMilesKilometersOption",this._showMilesKilometersOption);
this._watchEvents.push(a);a=this.watch("showClearButton",this._showClearButton);this._watchEvents.push(a);a=this.watch("directionsLengthUnits",this.setDirectionsLengthUnits);this._watchEvents.push(a)},_editToolbarEvents:function(){var a=c(this.editToolbar,"graphic-click",e.hitch(this,function(a){this.get("map")&&this.get("map").infoWindow&&(this.get("map").infoWindow.setFeatures([a.graphic]),this.get("map").infoWindow.show(a.graphic.geometry))}));this._onEvents.push(a);a=c(this.editToolbar,"graphic-first-move",
e.hitch(this,function(){this._moveInProgress=!0}));this._onEvents.push(a);a=c(this.editToolbar,"graphic-move-stop",e.hitch(this,function(a){this._moveInProgress=!1;this._unsetDraggableObject(a.graphic);if(this._dragGeometry!==a.graphic.geometry){this._currentEditableGraphic=a.graphic;if(this.get("autoSolve"))this.onDirectionsStart();this._globalGeocoder.find(a.graphic.geometry).then(e.hitch(this,function(b){b&&b.results.length?this._setReverseGeocode(b.results[0],b.geometry,r.indexOf(this.stopGraphics,
a.graphic)):this._reverseGeocodeError(Error(w.widgets.directions.error.locator))}),e.hitch(this,function(){this._decorateUngeocodedStop(a.graphic).then(e.hitch(this,function(b){this._setReverseGeocode(b,b.feature.geometry,r.indexOf(this.stopGraphics,a.graphic))}))}))}}));this._onEvents.push(a)},_decorateUngeocodedStop:function(a){var b=new y,c=function(c,d){b.resolve({name:void 0===c?w.widgets.directions.unlocatedStop:c.toFixed(6)+" "+d.toFixed(6),feature:a})};if(a.geometry)if(a.geometry.spatialReference&&
4326!==a.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator())g(["../geometry/webMercatorUtils"],function(b){b=b.xyToLngLat(a.geometry.x,a.geometry.y);c(b[0],b[1])});else if(this._geometryService){var d=new ba;d.outSR=new x(4326);d.geometries=[a.geometry];this._geometryService.project(d).then(e.hitch(this,function(b){b&&b.length?c(b[0].x,b[0].y):c(a.geometry.x,a.geometry.y)}),e.hitch(this,function(){c()}))}else c(a.geometry.x,a.geometry.y);
else c(a.geometry.x,a.geometry.y);else c();return b.promise},_trafficLayerUpdate:function(a,b,c){a=this.get("map");b&&(a&&this._trafficLayerAdded)&&(a.removeLayer(b),this._trafficLayerAdded=!1);c&&(a&&this.get("traffic")&&!this._trafficLayerAdded)&&(a.addLayer(c),c.show(),this._trafficLayerAdded=!0)},_reverseGeocodeError:function(a){this.onDirectionsFinish(a);a=w.widgets.directions.error.locator;this._resultError(a);this._clearRouteGraphics();this._currentEditableGraphic.setAttributes({error:a});
this._updateStop({name:""},this._currentEditableGraphic._index)},_routeTaskError:function(a){var b=w.widgets.directions.error.routeTask,c=a.details;c&&1===c.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===c[0]?b=w.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===c[0]&&(b=w.widgets.directions.error.nonNAmTruckingMode));this._resultError(b);this.onDirectionsFinish(a)},
_resultError:function(a){var b="";this.errors.push(a);b+='\x3cdiv class\x3d"'+this._css.routesErrorClass+'"\x3e';if(this.errors.length){for(var b=b+"\x3cul\x3e",c=0;c<this.errors.length;c++)b+="\x3cli\x3e"+this.errors[c]+"\x3c/li\x3e";b+="\x3c/ul\x3e"}b+="\x3c/div\x3e";this._errorNode&&(this._errorNode.innerHTML=b);this.onError(a)},_getUnits:function(a){switch(a){case A.KILOMETERS:return"KILOMETERS";case A.METERS:return"METERS";case A.NAUTICAL_MILES:return"NAUTICAL_MILES";default:return"MILES"}},
_createRouteTask:function(){var a=new y;this.set("routeTask",new V(this.get("routeTaskUrl")));this._usingAGOL()&&this._setTravelModeComponentsVisibility(!0);this._createRouteParams();$({url:this.get("routeTask").url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,function(b){if(b.networkDataset){this.set("serviceDescription",b);this._showTravelModesOption();if(this._hasAGOLTravelModes){var c=this.getSupportedTravelModeNames(),c=this.travelModeName&&c.length&&-1<
r.indexOf(c,this.travelModeName)?this.travelModeName:this._tmDrivingTime,d=c.split(" ");this._travelModeKey=d[0];this._travelModeImpedanceKey=d[1];this.setTravelMode(c)}b.serviceLimits&&b.serviceLimits.Route_MaxStops&&this.set("maxStops",b.serviceLimits.Route_MaxStops);a.resolve()}else this._resultError(w.widgets.directions.error.cantFindRouteServiceDescription),a.reject(w.widgets.directions.error.cantFindRouteServiceDescription)}),e.hitch(this,function(){this._resultError(w.widgets.directions.error.cantFindRouteServiceDescription);
a.reject(w.widgets.directions.error.cantFindRouteServiceDescription)}));return a.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new X(this.printTaskUrl,{async:!1}):null;var a=new Z;a.exportOptions={width:670,height:750,dpi:96};a.format="PNG32";a.layout="MAP_ONLY";a.preserveScale=!1;a.showAttribution=!1;var b=new Y;b.map=this.map;b.outSpatialReference=this.map.spatialReference;b.template=a;this._printParams=
b},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new P(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new P(this.defaults.geometryTaskUrl):aa.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var a=this.get("serviceDescription"),b=!this.showTravelModesOption||!a;if(a){this._hasAGOLTravelModes=(a=a.supportedTravelModes)&&a.length?!0:!1;var c={};c[this._tmDrivingTime]=
null;c[this._tmTruckingTime]=null;c[this._tmWalkingTime]=null;c[this._tmDrivingDistance]=null;c[this._tmTruckingDistance]=null;c[this._tmWalkingDistance]=null;if(this._hasAGOLTravelModes)for(var d in c)if(c.hasOwnProperty(d)){for(var e=!1,f=0;f<a.length;f++)if(a[f].name===d){c[d]=a[f].itemId;a[f]._nodeTravelMode=-1<d.indexOf("Driving")?this._useTravelModeCarNode:-1<d.indexOf("Trucking")?this._useTravelModeTruckNode:this._useTravelModeWalkingNode;a[f]._nodeImpedance=-1<d.indexOf("Time")?this._useTravelModeTimeNode:
this._useTravelModeDistanceNode;e=!0;break}if(!e){this._hasAGOLTravelModes=!1;break}}b=b||!this._hasAGOLTravelModes;this.showTravelModesOption=this.showTravelModesOption&&this._hasAGOLTravelModes}this._setTravelModeComponentsVisibility(!b)},_setTravelModeComponentsVisibility:function(b){a.set(this._travelModeContainerNode,"display",b?"inline-block":"none");a.set(this._travelModeImpedanceNode,"display",b?"inline-block":"none");a.set(this._useTravelModeTruckNode,"display",this.hideTruckingMode?"none":
"inline-block");a.set(this._travelModeImpedanceNode,"display",this.hideFastestShortestOption?"none":"inline-block")},_showMilesKilometersOption:function(){a.set(this._travelModeDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){a.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_createRouteParams:function(){var a={directionsOutputType:"complete",stops:new U,returnDirections:!0,doNotLocateOnRestrictedElements:!0};
this.get("map")?a.outSpatialReference=this.get("map").spatialReference:a.outSpatialReference=this._defaultSR;this.get("routeParams")||(this.routeParams={});var b=new W;this.routeParams=e.mixin(b,{returnRoutes:!1,preserveFirstStop:!0,preserveLastStop:!0},this.get("routeParams"),a)},_reverseStops:function(){var a=this._dnd.getAllNodes();a.length&&(a.reverse(),this._dnd.clearItems(),this._dnd.insertNodes(!1,a),this._dnd.sync(),this._stopsRemovable(),this._optionsMenu(),this._checkMaxStops(),this.setListIcons(),
this._sortGeocoders(),this._solveAndZoom())},_sortGeocodersToNodes:function(a,c,d,e){c=c[e];a=b.byId(a[e]);e=b.byId(c);a=r.indexOf(d,a);e=r.indexOf(d,e);for(c=0;c<d.length;c++){if(c===a)return-1;if(c===e)return 1}},_setMenuNodeValues:function(){var a=this.get("optimalRoute");this._findOptimalOrderNode&&h.set(this._findOptimalOrderNode,"checked",a);a=this.get("returnToStart");this._returnToStartNode&&h.set(this._returnToStartNode,"checked",a);a=this.get("traffic");this._useTrafficNode&&h.set(this._useTrafficNode,
"checked",a);switch(this.get("directionsLengthUnits")){case A.KILOMETERS:h.set(this._useKilometersNode,"checked",!0);h.set(this._useMilesNode,"checked",!1);break;case A.MILES:h.set(this._useKilometersNode,"checked",!1),h.set(this._useMilesNode,"checked",!0)}this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&(this.get("showTrafficOption")?a.set(this._useTrafficItemNode,"display","block"):a.set(this._useTrafficItemNode,"display","none"));this._returnToStartItemNode&&
(this.get("showReturnToStartOption")?a.set(this._returnToStartItemNode,"display","block"):a.set(this._returnToStartItemNode,"display","none"));this._findOptimalOrderItemNode&&(this.get("showOptimalRouteOption")&&4<=this.stops.length?a.set(this._findOptimalOrderItemNode,"display","block"):a.set(this._findOptimalOrderItemNode,"display","none"));this.stops.length>=this.get("minStops")?d.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(d.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),
this._optionsMenuNode&&"block"===a.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu(),this._configureRouteOptions())},_stopsRemovable:function(){this.get("geocoders").length>this.get("minStops")?d.add(this._widgetContainer,this._css.stopsRemovableClass):d.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.stops.length<this.get("maxStops")?(this._showAddDestination(),this.set("maxStopsReached",!1)):(this._hideAddDestination(),this.set("maxStopsReached",
!0))},_updateThemeWatch:function(a,b,c){d.remove(this.domNode,b);d.add(this.domNode,c)},_toggleOptionsMenu:function(){this._optionsMenuNode&&("block"===a.get(this._optionsMenuNode,"display")?(a.set(this._optionsMenuNode,"display","none"),this._optionsButtonNode.innerHTML=w.widgets.directions.showOptions):(a.set(this._optionsMenuNode,"display","block"),this._optionsButtonNode.innerHTML=w.widgets.directions.hideOptions))},_hideAddDestination:function(){d.remove(this._widgetContainer,this._css.addStopsClass)},
_showAddDestination:function(){d.add(this._widgetContainer,this._css.addStopsClass)},_getAbsoluteUrl:function(){var a=g.toUrl(".");if(/^https?\:/i.test(a))return a;if(/^\/\//i.test(a))return window.location.protocol+a;if(/^\//i.test(a))return window.location.protocol+"//"+window.location.host+a},_getManeuverImage:function(a){if(a){var b=this._getAbsoluteUrl()+"/images/Directions/maneuvers/";return"esriDMTStop"===a||"esriDMTDepart"===a?"":b+a+".png"}return""},_loadPrintDirections:function(a){var b=
this.get("printTemplate");if(!b){var c=this._getAbsoluteUrl()+"/css/Directions.css",d=this._getAbsoluteUrl()+"/css/DirectionsPrint.css",f=this._getAbsoluteUrl()+"/images/Directions/print-logo.png",g;g=k.isBodyLtr()?"ltr":"rtl";b="";b+="\x3c!DOCTYPE HTML\x3e";b+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+g+'"\x3e';b+="\x3chead\x3e";b+='\x3cmeta charset\x3d"utf-8"\x3e';b+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';b+="\x3ctitle\x3e"+this.get("directions").routeName+
"\x3c/title\x3e";b+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+c+'" /\x3e';b+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+d+'" /\x3e';b+="\x3c/head\x3e";b+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+w.common.close+'" onclick\x3d"window.close();"\x3e'+w.common.close+"\x3c/div\x3e";b+='\x3cdiv id\x3d"printButton" class\x3d"'+
this._css.esriPrintButtonClass+'" title\x3d"'+w.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+w.widgets.directions.print+"\x3c/div\x3e";b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';b+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+f+'" /\x3e';b+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+this.get("directions").routeName+"\x3c/div\x3e";b+='\x3cdiv class\x3d"'+
this._css.esriPrintLengthClass+'"\x3e'+this._formatDistance(this.get("directions").totalLength,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].name)+". "+this._formatTime(this.get("directions").totalTime)+"\x3c/div\x3e";a&&(b+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',b+='\x3chr class\x3d"esriNoPrint"/\x3e');var b=b+'\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e',b=b+('\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+
this._css.esriPrintNotesClass+'" placeholder\x3d"'+w.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e'),b=b+('\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e'),b=b+"\x3c/div\x3e",b=b+('\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e'),b=b+"\x3ctable\x3e",b=b+"\x3ctbody\x3e",h=0;r.forEach(this.get("directions").features,e.hitch(this,function(a,c){var d=this.get("directions").strings[c],e;if(d){var f=a.attributes.text;for(e=0;e<d.length;e++)f=this._boldText(f,d[e].string);
a.attributes.formattedText=f}else a.attributes.formattedText=a.attributes.text;d="";this.get("directions").features.length===c+1&&(d=this._css.routeLastClass);a.attributes&&(a.attributes.step=c+1);b+='\x3ctr class\x3d"'+d+'"\x3e';b+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';var d=this._getManeuverImage(a.attributes.maneuverType),g;0===c?(g=this._getLetter(h),h++):"esriDMTStop"===a.attributes.maneuverType?g=this._getLetter(h):"esriDMTDepart"===a.attributes.maneuverType&&(g=this._getLetter(h),
h++);d?b+='\x3cimg src\x3d"'+d+'" /\x3e':g&&(b+='\x3cdiv class\x3d"'+this._css.esriPrintStopLabelClass+'"\x3e',b+=g,b+="\x3c/div\x3e");b+="\x3c/td\x3e";b+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';b+="\x3cdiv\x3e\x3cstrong\x3e"+u.format(a.attributes.step)+".\x3c/strong\x3e "+a.attributes.formattedText+"\x3c/div\x3e";b+="\x3c/td\x3e";b+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._formatDistance(a.attributes.length,
w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].abbr)+"\x3c/div\x3e";b+="\x3c/td\x3e";b+="\x3c/tr\x3e"}));b+="\x3c/tbody\x3e";b+="\x3c/table\x3e";b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';b+="\x3cp\x3e"+w.widgets.directions.printDisclaimer+"\x3c/p\x3e";b+="\x3c/div\x3e";b+="\x3c/div\x3e";b+="\x3c/body\x3e";b+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(b);this._printWindow.document.close()},
_printDirections:function(){var a=screen.width/2,c=screen.height/1.5,a="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+a+", height\x3d"+c+", top\x3d"+(screen.height/2-c/2)+", left\x3d"+(screen.width/2-a/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",a,!0)):(this._printWindow=window.open("","directions_widget_print",a,!0),this._loadPrintDirections(!!this._printService),
this._printService&&g(["dojo/_base/window"],e.hitch(this,function(a){this.zoomToFullRoute().then(e.hitch(this,function(c){this._printService.execute(this._printParams,e.hitch(this,function(c){a.withDoc(this._printWindow.document,function(){var a=b.byId("divMap");a&&(d.remove(a,"esriPrintWait"),d.add(a,"esriPageBreak"),z.create("img",{src:c.url,"class":"esriPrintMapImg"},a))})}),e.hitch(this,function(c){a.withDoc(this._printWindow.document,function(){var a=b.byId("divMap");a&&d.remove(a,"esriPrintWait")});
console.log("Error while calling print service:\n "+c)}))}))})))}});f("extend-esri")&&e.setObject("dijit.Directions",q,H);return q});